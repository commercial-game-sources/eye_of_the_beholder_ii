!function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{configurable:!1,enumerable:!0,get:getter})},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="/assets/",__webpack_require__(__webpack_require__.s=2)}([function(module,exports){module.exports=angular},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuSearch=function(){function MenuSearch(listenersManager,config,$window,seekerFactory){this.config=config,this.$window=$window,this.seekerFactory=seekerFactory,this.selectedResultIndex=-1,this.totalMovies=0,this.totalGames=0,this.displayedMoviesCount=0,this.displayedGamesCount=0,this.resultsCount=0,this.searchCount=0,this.selectedCategory="games",this.results={},this.gameSeeker=this.seekerFactory.getMenuProductsSeeker(this.config.urls.search.filtering),this.resultsReadyListenersManager=listenersManager.getManager(),this.selectedResultListenersManager=listenersManager.getManager(),this.categoryChangedListenersManager=listenersManager.getManager(),this.afterResetListenersManager=listenersManager.getManager(),this.reset()}return MenuSearch.prototype.registerResultsReadyListener=function(callback){this.resultsReadyListenersManager.addListener(callback)},MenuSearch.prototype.registerSelectedResultListener=function(callback){this.selectedResultListenersManager.addListener(callback)},MenuSearch.prototype.registerCategoryChangedListener=function(callback){this.categoryChangedListenersManager.addListener(callback)},MenuSearch.prototype.registerAfterResetListener=function(callback){this.afterResetListenersManager.addListener(callback)},MenuSearch.prototype.search=function(searchTerm){this.searchCount++,this.gameSeeker.call({search:searchTerm,limit:MenuSearch.MAX_RESULTS}).then(this.resultsReady.bind(this))},MenuSearch.prototype.searchMovies=function(searchTerm){this.searchCount++,this.gameSeeker.call({mediaType:"movie",search:searchTerm,limit:MenuSearch.MAX_RESULTS}).then(this.movieResultsReady.bind(this))},MenuSearch.prototype.getResults=function(){return this.results[this.selectedCategory]},MenuSearch.prototype.getCategory=function(){return this.selectedCategory},MenuSearch.prototype.selectCategory=function(category){this.selectedCategory=category,this.categoryChangedListenersManager.callListeners()},MenuSearch.prototype.selectResult=function(index){this.selectedResultIndex=index,this.selectedResultListenersManager.callListeners()},MenuSearch.prototype.openSelected=function(){0!=this.getResults().length&&(-1==this.selectedResultIndex&&this.selectResult(0),this.$window.location.href=this.results[this.selectedCategory][this.selectedResultIndex].url)},MenuSearch.prototype.reset=function(){this.totalMovies=0,this.totalGames=0,this.displayedGamesCount=0,this.displayedMoviesCount=0,this.searchCount=0,this.selectedResultIndex=-1,this.results={movies:[],games:[]},this.resultsReadyListenersManager.callListeners(),this.afterResetListenersManager.callListeners()},MenuSearch.prototype.resultsReady=function(data){this.totalMovies=parseInt(data.totalMoviesFound),this.totalGames=parseInt(data.totalGamesFound),this.splitResults(data.products),this.totalGames?this.selectCategory("games"):this.totalMovies?this.selectCategory("movies"):this.selectCategory("games"),this.resultsCount=this.results[this.selectedCategory].length,this.resultsReadyListenersManager.callListeners()},MenuSearch.prototype.movieResultsReady=function(data){for(var _i=0,_a=data.products;_i<_a.length;_i++){var product=_a[_i];this.results.movies.push(product)}this.displayedMoviesCount=this.results.movies.length,this.selectCategory("movies"),this.resultsReadyListenersManager.callListeners()},MenuSearch.prototype.splitResults=function(products){this.results={movies:[],games:[]},this.displayedGamesCount=0,this.displayedMoviesCount=0;for(var _i=0,products_1=products;_i<products_1.length;_i++){var product=products_1[_i];product.isGame&&(this.displayedGamesCount++,this.results.games.push(product))}},MenuSearch.$inject=["listenersManager","config","$window","seekerFactory"],MenuSearch.SEND_EVENT_DELAY=1e3,MenuSearch.MAX_RESULTS=20,MenuSearch}();exports.MenuSearch=MenuSearch},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var angular=__webpack_require__(0);__webpack_require__(3),__webpack_require__(4),__webpack_require__(5);var GogMenu_1=__webpack_require__(6),GogMenuOverlay_1=__webpack_require__(7),GogMenuSearch_1=__webpack_require__(8),GogMenuFeaturesSlider_1=__webpack_require__(9),GogMenuLangAndCurrency_1=__webpack_require__(10),GogMenuSwipe_1=__webpack_require__(11),GogMenuScrollbar_1=__webpack_require__(12),GogMenuCartItemSwipe_1=__webpack_require__(13),MenuDropdown_1=__webpack_require__(14),MenuCartCtrl_1=__webpack_require__(15),MenuAccount_1=__webpack_require__(16),MenuAnonymousCtrl_1=__webpack_require__(17),MenuInternetConnectionStatus_1=__webpack_require__(18),MenuInternetConnectivityStateProvider_1=__webpack_require__(19),MenuAccountCtrl_1=__webpack_require__(20),MenuSearchCtrl_1=__webpack_require__(21),MenuGamesCtrl_1=__webpack_require__(22),MenuFriendsCtrl_1=__webpack_require__(23),MenuGames_1=__webpack_require__(24),MenuNow_1=__webpack_require__(25),MenuScrollWidth_1=__webpack_require__(26),MenuSearch_1=__webpack_require__(1),MenuAimFactory_1=__webpack_require__(27),MenuDataClientFactory_1=__webpack_require__(28),MenuDataClientPerUserFactory_1=__webpack_require__(29),highlight_1=__webpack_require__(30),MenuConfigProvider_1=__webpack_require__(31),MenuLogout_1=__webpack_require__(33),MenuFriends_1=__webpack_require__(34),MenuRedirect_1=__webpack_require__(35),MenuFriendsPresence_1=__webpack_require__(36),MenuBasicUserData_1=__webpack_require__(37),MenuAccessTokenProvider_1=__webpack_require__(38),MenuContainerAppClientIdProvider_1=__webpack_require__(39),MenuUserStorageProvider_1=__webpack_require__(40),MenuGalaxyAccountsProvider_1=__webpack_require__(41),MenuBasicUserDataEndpointSource_1=__webpack_require__(42),MenuAccessTokenEndpointSource_1=__webpack_require__(43),MenuContainerAppClientIdEndpointSource_1=__webpack_require__(44),MenuNotificationsPusher_1=__webpack_require__(45);__webpack_require__(46),__webpack_require__(50),__webpack_require__(53),__webpack_require__(56),__webpack_require__(59),__webpack_require__(62),__webpack_require__(64);var MenuNotificationsModule_1=__webpack_require__(67),menuModule=angular.module("gogMenuModule",["ngTouchstart","gogModulePusherClient","gogModuleTopicParsers","menuNotificationsComponent","menuNotificationsRepositoryComponent","menuNotificationFactoryComponent","menuPendingNotificationsComponent","menuBellNotificationsComponent","menuAnalyticsComponent","menuAccordionComponent"]).directive("gogMenu",function(){return{restrict:"A",controller:GogMenu_1.GogMenu,controllerAs:"menu"}}).directive("gogMenuOverlay",function(){return{restrict:"A",controller:GogMenuOverlay_1.GogMenuOverlay,controllerAs:"menuOverlay"}}).directive("gogMenuSwipe",function(){return{restrict:"A",controller:GogMenuSwipe_1.GogMenuSwipe,controllerAs:"menuSwipe"}}).directive("gogMenuCartItemSwipe",function(){return{restrict:"A",controller:GogMenuCartItemSwipe_1.GogMenuCartItemSwipe}}).directive("gogMenuSearch",function(){return{restrict:"A",controller:GogMenuSearch_1.GogMenuSearch}}).directive("gogMenuFeaturesSlider",function(){return{restrict:"A",controller:GogMenuFeaturesSlider_1.GogMenuFeaturesSlider,controllerAs:"slider"}}).directive("gogMenuScrollbar",function(){return{restrict:"A",controller:GogMenuScrollbar_1.GogMenuScrollbar,controllerAs:"scrollbar"}}).directive("gogMenuLangAndCurrency",function(){return{restrict:"A",controller:GogMenuLangAndCurrency_1.GogMenuLangAndCurrency,controllerAs:"langAndCurrency"}}).service("menuDropdown",MenuDropdown_1.MenuDropdown).service("menuAccount",MenuAccount_1.MenuAccount).service("menuSearch",MenuSearch_1.MenuSearch).service("menuNow",MenuNow_1.MenuNow).service("menuRedirect",MenuRedirect_1.MenuRedirect).service("menuScrollWidth",MenuScrollWidth_1.MenuScrollWidth).service("menuInternetConnectionStatus",MenuInternetConnectionStatus_1.MenuInternetConnectionStatus).controller("menuAnonymousCtrl",MenuAnonymousCtrl_1.MenuAnonymousCtrl).service("menuGames",MenuGames_1.MenuGames).controller("menuGamesCtrl",MenuGamesCtrl_1.MenuGamesCtrl).controller("menuSearchCtrl",MenuSearchCtrl_1.MenuSearchCtrl).controller("menuCartCtrl",MenuCartCtrl_1.MenuCartCtrl).controller("menuAccountCtrl",MenuAccountCtrl_1.MenuAccountCtrl).factory("menuAimFactory",MenuAimFactory_1.MenuAimFactory).factory("menuDataClientFactory",MenuDataClientFactory_1.MenuDataClientFactory).factory("menuDataClientPerUserFactory",MenuDataClientPerUserFactory_1.MenuDataClientPerUserFactory).filter("highlight",highlight_1.highlight).provider("menuInternetConnectivityState",MenuInternetConnectivityStateProvider_1.MenuInternetConnectivityStateProvider).provider("menuConfig",MenuConfigProvider_1.MenuConfigProvider).config(["menuInternetConnectivityStateProvider",function(menuInternetConnectivityStateProvider){menuInternetConnectivityStateProvider.setInternetConnectivityProvider("menuInternetConnectionStatus")}]).provider("menuLogout",MenuLogout_1.MenuLogoutProvider).provider("menuBasicUserData",MenuBasicUserData_1.MenuBasicUserDataProvider).provider("menuUserStorage",MenuUserStorageProvider_1.MenuUserStorageProvider).provider("menuGalaxyAccounts",MenuGalaxyAccountsProvider_1.MenuGalaxyAccountsProvider).provider("menuAccessToken",MenuAccessTokenProvider_1.MenuAccessTokenProvider).provider("menuContainerAppClientId",MenuContainerAppClientIdProvider_1.MenuContainerAppClientIdProvider).config(["menuLogoutProvider","menuConfigProvider","menuUserStorageProvider","menuGalaxyAccountsProvider",function(menuLogoutProvider,menuConfigProvider,menuUserStorage,menuGalaxyAccountsProvider){if(menuLogoutProvider.setLogoutServiceName("logout"),menuUserStorage.setUserStorageProvider("userStorage"),menuGalaxyAccountsProvider.setMenuGalaxyAccountsName("galaxyAccounts"),window.hasOwnProperty("gogMicroservices")&&window.gogMicroservices.hasOwnProperty("menu")){if(window.gogMicroservices.menu.hasOwnProperty("env"))switch(window.gogMicroservices.menu.env){case"dev":menuConfigProvider.setEnvironmentAsDev();break;case"staging":menuConfigProvider.setEnvironmentAsStaging();break;case"prod":menuConfigProvider.setEnvironmentAsProd();break;case"preprod":menuConfigProvider.setEnvironmentAsPreprod();break;default:menuConfigProvider.setEnvironmentAsProd()}window.gogMicroservices.menu.hasOwnProperty("currentLanguageCode")&&menuConfigProvider.setLocale(window.gogMicroservices.menu.currentLanguageCode),window.gogMicroservices.menu.hasOwnProperty("currentCurrencyCode")&&menuConfigProvider.setCurrency(window.gogMicroservices.menu.currentCurrencyCode),window.gogMicroservices.menu.hasOwnProperty("country")&&menuConfigProvider.setCountry(window.gogMicroservices.menu.country),-1!=navigator.appVersion.indexOf("Win")&&menuConfigProvider.setOsAsWindows(),-1!=navigator.appVersion.indexOf("Mac")&&menuConfigProvider.setOsAsOSX(),-1!=navigator.appVersion.indexOf("Linux")&&menuConfigProvider.setOsAsLinux()}}]).service("menuBasicUserDataEndpointSource",MenuBasicUserDataEndpointSource_1.MenuBasicUserDataEndpointSource).service("menuAccessTokenEndpointSource",MenuAccessTokenEndpointSource_1.MenuAccessTokenEndpointSource).service("menuContainerAppClientIdEndpointSource",MenuContainerAppClientIdEndpointSource_1.MenuContainerAppClientIdEndpointSource).config(["menuBasicUserDataProvider","menuAccessTokenProvider","menuContainerAppClientIdProvider",function(menuBasicUserDataProvider,menuAccessTokenProvider,menuContainerAppClientIdProvider){menuBasicUserDataProvider.setUserBasicDataSourceName("menuBasicUserDataEndpointSource"),menuAccessTokenProvider.setAccessTokenSourceName("menuAccessTokenEndpointSource"),menuContainerAppClientIdProvider.setClientIdSourceName("menuContainerAppClientIdEndpointSource")}]);window.gogMicroservices&&window.gogMicroservices.hasOwnProperty("menu")&&window.gogMicroservices.menu.hasOwnProperty("features")&&window.gogMicroservices.menu.features.hasOwnProperty("notifications")&&window.gogMicroservices.menu.features.notifications&&menuModule.service("menuNotificationsPusher",MenuNotificationsPusher_1.MenuNotificationsPusher).service("menuChatTopicParser",MenuNotificationsModule_1.MenuChatTopicParser).service("menuChatTopicMediator",MenuNotificationsModule_1.MenuChatTopicMediator).service("menuNotificationsClient",MenuNotificationsModule_1.MenuNotificationsClient).service("menuNotificationListLoad",MenuNotificationsModule_1.MenuNotificationListLoad).service("menuCustomTopicMediator",MenuNotificationsModule_1.MenuCustomTopicMediator).service("menuFriendsTopicParser",MenuNotificationsModule_1.MenuFriendsTopicParser).service("menuNotificationExpiration",MenuNotificationsModule_1.MenuNotificationExpiration).service("menuFriendsTopicMediator",MenuNotificationsModule_1.MenuFriendsTopicMediator).service("menuNotificationRelatedPageEnter",MenuNotificationsModule_1.MenuNotificationRelatedPageEnter).factory("menuNotificationSafeDate",MenuNotificationsModule_1.MenuNotificationSafeDate).provider("menuChat",MenuNotificationsModule_1.MenuChatProvider).provider("menuNotificationAction",MenuNotificationsModule_1.MenuNotificationActionProvider).config(["menuNotificationActionProvider","menuChatProvider",function(menuNotificationActionProvider,menuChatProvider){menuNotificationActionProvider.setActionsCollectionAsWebsite(),menuChatProvider.setChatServiceName("chatMonitor"),menuChatProvider.setDisplayPredicateMethod("shouldShowChatNotificationForUser")}]).run(["menuChatTopicMediator","menuFriendsTopicMediator","menuCustomTopicMediator","menuNotificationsPusher","menuNotificationExpiration","menuNotificationListLoad",angular.noop]),window.gogMicroservices&&window.gogMicroservices.hasOwnProperty("menu")&&window.gogMicroservices.menu.hasOwnProperty("features")&&window.gogMicroservices.menu.features.hasOwnProperty("list_of_friends_enabled")&&window.gogMicroservices.menu.features.list_of_friends_enabled&&menuModule.controller("menuFriendsCtrl",MenuFriendsCtrl_1.MenuFriendsCtrl).service("menuFriends",MenuFriends_1.MenuFriends).service("menuFriendsPresence",MenuFriendsPresence_1.MenuFriendsPresence)},function(module,exports,__webpack_require__){var require,f;f=function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){if(!u&&("function"==typeof require&&require))return require(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){return s(t[o][1][e]||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){},{}],2:[function(_dereq_,module,exports){var global,factory;global=this,factory=function(Long){"use strict";function stringSource(s){var i=0;return function(){return i<s.length?s.charCodeAt(i++):null}}function stringDestination(){var cs=[],ps=[];return function(){if(0===arguments.length)return ps.join("")+stringFromCharCode.apply(String,cs);cs.length+arguments.length>1024&&(ps.push(stringFromCharCode.apply(String,cs)),cs.length=0),Array.prototype.push.apply(cs,arguments)}}function ieee754_read(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)}function ieee754_write(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),(value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias))*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}var ByteBuffer=function(capacity,littleEndian,noAssert){if(void 0===capacity&&(capacity=ByteBuffer.DEFAULT_CAPACITY),void 0===littleEndian&&(littleEndian=ByteBuffer.DEFAULT_ENDIAN),void 0===noAssert&&(noAssert=ByteBuffer.DEFAULT_NOASSERT),!noAssert){if((capacity|=0)<0)throw RangeError("Illegal capacity");littleEndian=!!littleEndian,noAssert=!!noAssert}this.buffer=0===capacity?EMPTY_BUFFER:new ArrayBuffer(capacity),this.view=0===capacity?null:new Uint8Array(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=capacity,this.littleEndian=littleEndian,this.noAssert=noAssert};ByteBuffer.VERSION="5.0.1",ByteBuffer.LITTLE_ENDIAN=!0,ByteBuffer.BIG_ENDIAN=!1,ByteBuffer.DEFAULT_CAPACITY=16,ByteBuffer.DEFAULT_ENDIAN=ByteBuffer.BIG_ENDIAN,ByteBuffer.DEFAULT_NOASSERT=!1,ByteBuffer.Long=Long||null;var ByteBufferPrototype=ByteBuffer.prototype;ByteBufferPrototype.__isByteBuffer__,Object.defineProperty(ByteBufferPrototype,"__isByteBuffer__",{value:!0,enumerable:!1,configurable:!1});var EMPTY_BUFFER=new ArrayBuffer(0),stringFromCharCode=String.fromCharCode;ByteBuffer.accessor=function(){return Uint8Array},ByteBuffer.allocate=function(capacity,littleEndian,noAssert){return new ByteBuffer(capacity,littleEndian,noAssert)},ByteBuffer.concat=function(buffers,encoding,littleEndian,noAssert){"boolean"!=typeof encoding&&"string"==typeof encoding||(noAssert=littleEndian,littleEndian=encoding,encoding=void 0);for(var length,capacity=0,i=0,k=buffers.length;i<k;++i)ByteBuffer.isByteBuffer(buffers[i])||(buffers[i]=ByteBuffer.wrap(buffers[i],encoding)),(length=buffers[i].limit-buffers[i].offset)>0&&(capacity+=length);if(0===capacity)return new ByteBuffer(0,littleEndian,noAssert);var bi,bb=new ByteBuffer(capacity,littleEndian,noAssert);for(i=0;i<k;)(length=(bi=buffers[i++]).limit-bi.offset)<=0||(bb.view.set(bi.view.subarray(bi.offset,bi.limit),bb.offset),bb.offset+=length);return bb.limit=bb.offset,bb.offset=0,bb},ByteBuffer.isByteBuffer=function(bb){return!0===(bb&&bb.__isByteBuffer__)},ByteBuffer.type=function(){return ArrayBuffer},ByteBuffer.wrap=function(buffer,encoding,littleEndian,noAssert){if("string"!=typeof encoding&&(noAssert=littleEndian,littleEndian=encoding,encoding=void 0),"string"==typeof buffer)switch(void 0===encoding&&(encoding="utf8"),encoding){case"base64":return ByteBuffer.fromBase64(buffer,littleEndian);case"hex":return ByteBuffer.fromHex(buffer,littleEndian);case"binary":return ByteBuffer.fromBinary(buffer,littleEndian);case"utf8":return ByteBuffer.fromUTF8(buffer,littleEndian);case"debug":return ByteBuffer.fromDebug(buffer,littleEndian);default:throw Error("Unsupported encoding: "+encoding)}if(null===buffer||"object"!=typeof buffer)throw TypeError("Illegal buffer");var bb;if(ByteBuffer.isByteBuffer(buffer))return(bb=ByteBufferPrototype.clone.call(buffer)).markedOffset=-1,bb;if(buffer instanceof Uint8Array)bb=new ByteBuffer(0,littleEndian,noAssert),buffer.length>0&&(bb.buffer=buffer.buffer,bb.offset=buffer.byteOffset,bb.limit=buffer.byteOffset+buffer.byteLength,bb.view=new Uint8Array(buffer.buffer));else if(buffer instanceof ArrayBuffer)bb=new ByteBuffer(0,littleEndian,noAssert),buffer.byteLength>0&&(bb.buffer=buffer,bb.offset=0,bb.limit=buffer.byteLength,bb.view=buffer.byteLength>0?new Uint8Array(buffer):null);else{if("[object Array]"!==Object.prototype.toString.call(buffer))throw TypeError("Illegal buffer");(bb=new ByteBuffer(buffer.length,littleEndian,noAssert)).limit=buffer.length;for(var i=0;i<buffer.length;++i)bb.view[i]=buffer[i]}return bb},ByteBufferPrototype.writeBitSet=function(value,offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if(!(value instanceof Array))throw TypeError("Illegal BitSet: Not an array");if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+0) <= "+this.buffer.byteLength)}var k,start=offset,bits=value.length,bytes=bits>>3,bit=0;for(offset+=this.writeVarint32(bits,offset);bytes--;)k=1&!!value[bit++]|(1&!!value[bit++])<<1|(1&!!value[bit++])<<2|(1&!!value[bit++])<<3|(1&!!value[bit++])<<4|(1&!!value[bit++])<<5|(1&!!value[bit++])<<6|(1&!!value[bit++])<<7,this.writeByte(k,offset++);if(bit<bits){var m=0;for(k=0;bit<bits;)k|=(1&!!value[bit++])<<m++;this.writeByte(k,offset++)}return relative?(this.offset=offset,this):offset-start},ByteBufferPrototype.readBitSet=function(offset){var relative=void 0===offset;relative&&(offset=this.offset);var k,ret=this.readVarint32(offset),bits=ret.value,bytes=bits>>3,bit=0,value=[];for(offset+=ret.length;bytes--;)k=this.readByte(offset++),value[bit++]=!!(1&k),value[bit++]=!!(2&k),value[bit++]=!!(4&k),value[bit++]=!!(8&k),value[bit++]=!!(16&k),value[bit++]=!!(32&k),value[bit++]=!!(64&k),value[bit++]=!!(128&k);if(bit<bits){var m=0;for(k=this.readByte(offset++);bit<bits;)value[bit++]=!!(k>>m++&1)}return relative&&(this.offset=offset),value},ByteBufferPrototype.readBytes=function(length,offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+length>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+length+") <= "+this.buffer.byteLength)}var slice=this.slice(offset,offset+length);return relative&&(this.offset+=length),slice},ByteBufferPrototype.writeBytes=ByteBufferPrototype.append,ByteBufferPrototype.writeInt8=function(value,offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"!=typeof value||value%1!=0)throw TypeError("Illegal value: "+value+" (not an integer)");if(value|=0,"number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+0) <= "+this.buffer.byteLength)}offset+=1;var capacity0=this.buffer.byteLength;return offset>capacity0&&this.resize((capacity0*=2)>offset?capacity0:offset),offset-=1,this.view[offset]=value,relative&&(this.offset+=1),this},ByteBufferPrototype.writeByte=ByteBufferPrototype.writeInt8,ByteBufferPrototype.readInt8=function(offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+1) <= "+this.buffer.byteLength)}var value=this.view[offset];return 128==(128&value)&&(value=-(255-value+1)),relative&&(this.offset+=1),value},ByteBufferPrototype.readByte=ByteBufferPrototype.readInt8,ByteBufferPrototype.writeUint8=function(value,offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"!=typeof value||value%1!=0)throw TypeError("Illegal value: "+value+" (not an integer)");if(value>>>=0,"number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+0) <= "+this.buffer.byteLength)}offset+=1;var capacity1=this.buffer.byteLength;return offset>capacity1&&this.resize((capacity1*=2)>offset?capacity1:offset),offset-=1,this.view[offset]=value,relative&&(this.offset+=1),this},ByteBufferPrototype.writeUInt8=ByteBufferPrototype.writeUint8,ByteBufferPrototype.readUint8=function(offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+1) <= "+this.buffer.byteLength)}var value=this.view[offset];return relative&&(this.offset+=1),value},ByteBufferPrototype.readUInt8=ByteBufferPrototype.readUint8,ByteBufferPrototype.writeInt16=function(value,offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"!=typeof value||value%1!=0)throw TypeError("Illegal value: "+value+" (not an integer)");if(value|=0,"number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+0) <= "+this.buffer.byteLength)}offset+=2;var capacity2=this.buffer.byteLength;return offset>capacity2&&this.resize((capacity2*=2)>offset?capacity2:offset),offset-=2,this.littleEndian?(this.view[offset+1]=(65280&value)>>>8,this.view[offset]=255&value):(this.view[offset]=(65280&value)>>>8,this.view[offset+1]=255&value),relative&&(this.offset+=2),this},ByteBufferPrototype.writeShort=ByteBufferPrototype.writeInt16,ByteBufferPrototype.readInt16=function(offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+2) <= "+this.buffer.byteLength)}var value=0;return this.littleEndian?(value=this.view[offset],value|=this.view[offset+1]<<8):(value=this.view[offset]<<8,value|=this.view[offset+1]),32768==(32768&value)&&(value=-(65535-value+1)),relative&&(this.offset+=2),value},ByteBufferPrototype.readShort=ByteBufferPrototype.readInt16,ByteBufferPrototype.writeUint16=function(value,offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"!=typeof value||value%1!=0)throw TypeError("Illegal value: "+value+" (not an integer)");if(value>>>=0,"number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+0) <= "+this.buffer.byteLength)}offset+=2;var capacity3=this.buffer.byteLength;return offset>capacity3&&this.resize((capacity3*=2)>offset?capacity3:offset),offset-=2,this.littleEndian?(this.view[offset+1]=(65280&value)>>>8,this.view[offset]=255&value):(this.view[offset]=(65280&value)>>>8,this.view[offset+1]=255&value),relative&&(this.offset+=2),this},ByteBufferPrototype.writeUInt16=ByteBufferPrototype.writeUint16,ByteBufferPrototype.readUint16=function(offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+2) <= "+this.buffer.byteLength)}var value=0;return this.littleEndian?(value=this.view[offset],value|=this.view[offset+1]<<8):(value=this.view[offset]<<8,value|=this.view[offset+1]),relative&&(this.offset+=2),value},ByteBufferPrototype.readUInt16=ByteBufferPrototype.readUint16,ByteBufferPrototype.writeInt32=function(value,offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"!=typeof value||value%1!=0)throw TypeError("Illegal value: "+value+" (not an integer)");if(value|=0,"number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+0) <= "+this.buffer.byteLength)}offset+=4;var capacity4=this.buffer.byteLength;return offset>capacity4&&this.resize((capacity4*=2)>offset?capacity4:offset),offset-=4,this.littleEndian?(this.view[offset+3]=value>>>24&255,this.view[offset+2]=value>>>16&255,this.view[offset+1]=value>>>8&255,this.view[offset]=255&value):(this.view[offset]=value>>>24&255,this.view[offset+1]=value>>>16&255,this.view[offset+2]=value>>>8&255,this.view[offset+3]=255&value),relative&&(this.offset+=4),this},ByteBufferPrototype.writeInt=ByteBufferPrototype.writeInt32,ByteBufferPrototype.readInt32=function(offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+4) <= "+this.buffer.byteLength)}var value=0;return this.littleEndian?(value=this.view[offset+2]<<16,value|=this.view[offset+1]<<8,value|=this.view[offset],value+=this.view[offset+3]<<24>>>0):(value=this.view[offset+1]<<16,value|=this.view[offset+2]<<8,value|=this.view[offset+3],value+=this.view[offset]<<24>>>0),value|=0,relative&&(this.offset+=4),value},ByteBufferPrototype.readInt=ByteBufferPrototype.readInt32,ByteBufferPrototype.writeUint32=function(value,offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"!=typeof value||value%1!=0)throw TypeError("Illegal value: "+value+" (not an integer)");if(value>>>=0,"number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+0) <= "+this.buffer.byteLength)}offset+=4;var capacity5=this.buffer.byteLength;return offset>capacity5&&this.resize((capacity5*=2)>offset?capacity5:offset),offset-=4,this.littleEndian?(this.view[offset+3]=value>>>24&255,this.view[offset+2]=value>>>16&255,this.view[offset+1]=value>>>8&255,this.view[offset]=255&value):(this.view[offset]=value>>>24&255,this.view[offset+1]=value>>>16&255,this.view[offset+2]=value>>>8&255,this.view[offset+3]=255&value),relative&&(this.offset+=4),this},ByteBufferPrototype.writeUInt32=ByteBufferPrototype.writeUint32,ByteBufferPrototype.readUint32=function(offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+4) <= "+this.buffer.byteLength)}var value=0;return this.littleEndian?(value=this.view[offset+2]<<16,value|=this.view[offset+1]<<8,value|=this.view[offset],value+=this.view[offset+3]<<24>>>0):(value=this.view[offset+1]<<16,value|=this.view[offset+2]<<8,value|=this.view[offset+3],value+=this.view[offset]<<24>>>0),relative&&(this.offset+=4),value},ByteBufferPrototype.readUInt32=ByteBufferPrototype.readUint32,Long&&(ByteBufferPrototype.writeInt64=function(value,offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"==typeof value)value=Long.fromNumber(value);else if("string"==typeof value)value=Long.fromString(value);else if(!(value&&value instanceof Long))throw TypeError("Illegal value: "+value+" (not an integer or Long)");if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+0) <= "+this.buffer.byteLength)}"number"==typeof value?value=Long.fromNumber(value):"string"==typeof value&&(value=Long.fromString(value)),offset+=8;var capacity6=this.buffer.byteLength;offset>capacity6&&this.resize((capacity6*=2)>offset?capacity6:offset),offset-=8;var lo=value.low,hi=value.high;return this.littleEndian?(this.view[offset+3]=lo>>>24&255,this.view[offset+2]=lo>>>16&255,this.view[offset+1]=lo>>>8&255,this.view[offset]=255&lo,offset+=4,this.view[offset+3]=hi>>>24&255,this.view[offset+2]=hi>>>16&255,this.view[offset+1]=hi>>>8&255,this.view[offset]=255&hi):(this.view[offset]=hi>>>24&255,this.view[offset+1]=hi>>>16&255,this.view[offset+2]=hi>>>8&255,this.view[offset+3]=255&hi,offset+=4,this.view[offset]=lo>>>24&255,this.view[offset+1]=lo>>>16&255,this.view[offset+2]=lo>>>8&255,this.view[offset+3]=255&lo),relative&&(this.offset+=8),this},ByteBufferPrototype.writeLong=ByteBufferPrototype.writeInt64,ByteBufferPrototype.readInt64=function(offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+8) <= "+this.buffer.byteLength)}var lo=0,hi=0;this.littleEndian?(lo=this.view[offset+2]<<16,lo|=this.view[offset+1]<<8,lo|=this.view[offset],lo+=this.view[offset+3]<<24>>>0,offset+=4,hi=this.view[offset+2]<<16,hi|=this.view[offset+1]<<8,hi|=this.view[offset],hi+=this.view[offset+3]<<24>>>0):(hi=this.view[offset+1]<<16,hi|=this.view[offset+2]<<8,hi|=this.view[offset+3],hi+=this.view[offset]<<24>>>0,offset+=4,lo=this.view[offset+1]<<16,lo|=this.view[offset+2]<<8,lo|=this.view[offset+3],lo+=this.view[offset]<<24>>>0);var value=new Long(lo,hi,!1);return relative&&(this.offset+=8),value},ByteBufferPrototype.readLong=ByteBufferPrototype.readInt64,ByteBufferPrototype.writeUint64=function(value,offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"==typeof value)value=Long.fromNumber(value);else if("string"==typeof value)value=Long.fromString(value);else if(!(value&&value instanceof Long))throw TypeError("Illegal value: "+value+" (not an integer or Long)");if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+0) <= "+this.buffer.byteLength)}"number"==typeof value?value=Long.fromNumber(value):"string"==typeof value&&(value=Long.fromString(value)),offset+=8;var capacity7=this.buffer.byteLength;offset>capacity7&&this.resize((capacity7*=2)>offset?capacity7:offset),offset-=8;var lo=value.low,hi=value.high;return this.littleEndian?(this.view[offset+3]=lo>>>24&255,this.view[offset+2]=lo>>>16&255,this.view[offset+1]=lo>>>8&255,this.view[offset]=255&lo,offset+=4,this.view[offset+3]=hi>>>24&255,this.view[offset+2]=hi>>>16&255,this.view[offset+1]=hi>>>8&255,this.view[offset]=255&hi):(this.view[offset]=hi>>>24&255,this.view[offset+1]=hi>>>16&255,this.view[offset+2]=hi>>>8&255,this.view[offset+3]=255&hi,offset+=4,this.view[offset]=lo>>>24&255,this.view[offset+1]=lo>>>16&255,this.view[offset+2]=lo>>>8&255,this.view[offset+3]=255&lo),relative&&(this.offset+=8),this},ByteBufferPrototype.writeUInt64=ByteBufferPrototype.writeUint64,ByteBufferPrototype.readUint64=function(offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+8) <= "+this.buffer.byteLength)}var lo=0,hi=0;this.littleEndian?(lo=this.view[offset+2]<<16,lo|=this.view[offset+1]<<8,lo|=this.view[offset],lo+=this.view[offset+3]<<24>>>0,offset+=4,hi=this.view[offset+2]<<16,hi|=this.view[offset+1]<<8,hi|=this.view[offset],hi+=this.view[offset+3]<<24>>>0):(hi=this.view[offset+1]<<16,hi|=this.view[offset+2]<<8,hi|=this.view[offset+3],hi+=this.view[offset]<<24>>>0,offset+=4,lo=this.view[offset+1]<<16,lo|=this.view[offset+2]<<8,lo|=this.view[offset+3],lo+=this.view[offset]<<24>>>0);var value=new Long(lo,hi,!0);return relative&&(this.offset+=8),value},ByteBufferPrototype.readUInt64=ByteBufferPrototype.readUint64),ByteBufferPrototype.writeFloat32=function(value,offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"!=typeof value)throw TypeError("Illegal value: "+value+" (not a number)");if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+0) <= "+this.buffer.byteLength)}offset+=4;var capacity8=this.buffer.byteLength;return offset>capacity8&&this.resize((capacity8*=2)>offset?capacity8:offset),offset-=4,ieee754_write(this.view,value,offset,this.littleEndian,23,4),relative&&(this.offset+=4),this},ByteBufferPrototype.writeFloat=ByteBufferPrototype.writeFloat32,ByteBufferPrototype.readFloat32=function(offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+4) <= "+this.buffer.byteLength)}var value=ieee754_read(this.view,offset,this.littleEndian,23,4);return relative&&(this.offset+=4),value},ByteBufferPrototype.readFloat=ByteBufferPrototype.readFloat32,ByteBufferPrototype.writeFloat64=function(value,offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"!=typeof value)throw TypeError("Illegal value: "+value+" (not a number)");if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+0) <= "+this.buffer.byteLength)}offset+=8;var capacity9=this.buffer.byteLength;return offset>capacity9&&this.resize((capacity9*=2)>offset?capacity9:offset),offset-=8,ieee754_write(this.view,value,offset,this.littleEndian,52,8),relative&&(this.offset+=8),this},ByteBufferPrototype.writeDouble=ByteBufferPrototype.writeFloat64,ByteBufferPrototype.readFloat64=function(offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+8) <= "+this.buffer.byteLength)}var value=ieee754_read(this.view,offset,this.littleEndian,52,8);return relative&&(this.offset+=8),value},ByteBufferPrototype.readDouble=ByteBufferPrototype.readFloat64,ByteBuffer.MAX_VARINT32_BYTES=5,ByteBuffer.calculateVarint32=function(value){return(value>>>=0)<128?1:value<16384?2:value<1<<21?3:value<1<<28?4:5},ByteBuffer.zigZagEncode32=function(n){return((n|=0)<<1^n>>31)>>>0},ByteBuffer.zigZagDecode32=function(n){return n>>>1^-(1&n)|0},ByteBufferPrototype.writeVarint32=function(value,offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"!=typeof value||value%1!=0)throw TypeError("Illegal value: "+value+" (not an integer)");if(value|=0,"number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+0) <= "+this.buffer.byteLength)}var b,size=ByteBuffer.calculateVarint32(value);offset+=size;var capacity10=this.buffer.byteLength;for(offset>capacity10&&this.resize((capacity10*=2)>offset?capacity10:offset),offset-=size,value>>>=0;value>=128;)b=127&value|128,this.view[offset++]=b,value>>>=7;return this.view[offset++]=value,relative?(this.offset=offset,this):size},ByteBufferPrototype.writeVarint32ZigZag=function(value,offset){return this.writeVarint32(ByteBuffer.zigZagEncode32(value),offset)},ByteBufferPrototype.readVarint32=function(offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+1) <= "+this.buffer.byteLength)}var b,c=0,value=0;do{if(!this.noAssert&&offset>this.limit){var err=Error("Truncated");throw err.truncated=!0,err}b=this.view[offset++],c<5&&(value|=(127&b)<<7*c),++c}while(0!=(128&b));return value|=0,relative?(this.offset=offset,value):{value:value,length:c}},ByteBufferPrototype.readVarint32ZigZag=function(offset){var val=this.readVarint32(offset);return"object"==typeof val?val.value=ByteBuffer.zigZagDecode32(val.value):val=ByteBuffer.zigZagDecode32(val),val},Long&&(ByteBuffer.MAX_VARINT64_BYTES=10,ByteBuffer.calculateVarint64=function(value){"number"==typeof value?value=Long.fromNumber(value):"string"==typeof value&&(value=Long.fromString(value));var part0=value.toInt()>>>0,part1=value.shiftRightUnsigned(28).toInt()>>>0,part2=value.shiftRightUnsigned(56).toInt()>>>0;return 0==part2?0==part1?part0<16384?part0<128?1:2:part0<1<<21?3:4:part1<16384?part1<128?5:6:part1<1<<21?7:8:part2<128?9:10},ByteBuffer.zigZagEncode64=function(value){return"number"==typeof value?value=Long.fromNumber(value,!1):"string"==typeof value?value=Long.fromString(value,!1):!1!==value.unsigned&&(value=value.toSigned()),value.shiftLeft(1).xor(value.shiftRight(63)).toUnsigned()},ByteBuffer.zigZagDecode64=function(value){return"number"==typeof value?value=Long.fromNumber(value,!1):"string"==typeof value?value=Long.fromString(value,!1):!1!==value.unsigned&&(value=value.toSigned()),value.shiftRightUnsigned(1).xor(value.and(Long.ONE).toSigned().negate()).toSigned()},ByteBufferPrototype.writeVarint64=function(value,offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"==typeof value)value=Long.fromNumber(value);else if("string"==typeof value)value=Long.fromString(value);else if(!(value&&value instanceof Long))throw TypeError("Illegal value: "+value+" (not an integer or Long)");if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+0) <= "+this.buffer.byteLength)}"number"==typeof value?value=Long.fromNumber(value,!1):"string"==typeof value?value=Long.fromString(value,!1):!1!==value.unsigned&&(value=value.toSigned());var size=ByteBuffer.calculateVarint64(value),part0=value.toInt()>>>0,part1=value.shiftRightUnsigned(28).toInt()>>>0,part2=value.shiftRightUnsigned(56).toInt()>>>0;offset+=size;var capacity11=this.buffer.byteLength;switch(offset>capacity11&&this.resize((capacity11*=2)>offset?capacity11:offset),offset-=size,size){case 10:this.view[offset+9]=part2>>>7&1;case 9:this.view[offset+8]=9!==size?128|part2:127&part2;case 8:this.view[offset+7]=8!==size?part1>>>21|128:part1>>>21&127;case 7:this.view[offset+6]=7!==size?part1>>>14|128:part1>>>14&127;case 6:this.view[offset+5]=6!==size?part1>>>7|128:part1>>>7&127;case 5:this.view[offset+4]=5!==size?128|part1:127&part1;case 4:this.view[offset+3]=4!==size?part0>>>21|128:part0>>>21&127;case 3:this.view[offset+2]=3!==size?part0>>>14|128:part0>>>14&127;case 2:this.view[offset+1]=2!==size?part0>>>7|128:part0>>>7&127;case 1:this.view[offset]=1!==size?128|part0:127&part0}return relative?(this.offset+=size,this):size},ByteBufferPrototype.writeVarint64ZigZag=function(value,offset){return this.writeVarint64(ByteBuffer.zigZagEncode64(value),offset)},ByteBufferPrototype.readVarint64=function(offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+1) <= "+this.buffer.byteLength)}var start=offset,part0=0,part1=0,part2=0,b=0;if(part0=127&(b=this.view[offset++]),128&b&&(part0|=(127&(b=this.view[offset++]))<<7,(128&b||this.noAssert&&void 0===b)&&(part0|=(127&(b=this.view[offset++]))<<14,(128&b||this.noAssert&&void 0===b)&&(part0|=(127&(b=this.view[offset++]))<<21,(128&b||this.noAssert&&void 0===b)&&(part1=127&(b=this.view[offset++]),(128&b||this.noAssert&&void 0===b)&&(part1|=(127&(b=this.view[offset++]))<<7,(128&b||this.noAssert&&void 0===b)&&(part1|=(127&(b=this.view[offset++]))<<14,(128&b||this.noAssert&&void 0===b)&&(part1|=(127&(b=this.view[offset++]))<<21,(128&b||this.noAssert&&void 0===b)&&(part2=127&(b=this.view[offset++]),(128&b||this.noAssert&&void 0===b)&&(part2|=(127&(b=this.view[offset++]))<<7,128&b||this.noAssert&&void 0===b))))))))))throw Error("Buffer overrun");var value=Long.fromBits(part0|part1<<28,part1>>>4|part2<<24,!1);return relative?(this.offset=offset,value):{value:value,length:offset-start}},ByteBufferPrototype.readVarint64ZigZag=function(offset){var val=this.readVarint64(offset);return val&&val.value instanceof Long?val.value=ByteBuffer.zigZagDecode64(val.value):val=ByteBuffer.zigZagDecode64(val),val}),ByteBufferPrototype.writeCString=function(str,offset){var relative=void 0===offset;relative&&(offset=this.offset);var i,k=str.length;if(!this.noAssert){if("string"!=typeof str)throw TypeError("Illegal str: Not a string");for(i=0;i<k;++i)if(0===str.charCodeAt(i))throw RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+0) <= "+this.buffer.byteLength)}k=utfx.calculateUTF16asUTF8(stringSource(str))[1],offset+=k+1;var capacity12=this.buffer.byteLength;return offset>capacity12&&this.resize((capacity12*=2)>offset?capacity12:offset),offset-=k+1,utfx.encodeUTF16toUTF8(stringSource(str),function(b){this.view[offset++]=b}.bind(this)),this.view[offset++]=0,relative?(this.offset=offset,this):k},ByteBufferPrototype.readCString=function(offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+1) <= "+this.buffer.byteLength)}var sd,start=offset,b=-1;return utfx.decodeUTF8toUTF16(function(){if(0===b)return null;if(offset>=this.limit)throw RangeError("Illegal range: Truncated data, "+offset+" < "+this.limit);return 0===(b=this.view[offset++])?null:b}.bind(this),sd=stringDestination(),!0),relative?(this.offset=offset,sd()):{string:sd(),length:offset-start}},ByteBufferPrototype.writeIString=function(str,offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("string"!=typeof str)throw TypeError("Illegal str: Not a string");if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+0) <= "+this.buffer.byteLength)}var k,start=offset;k=utfx.calculateUTF16asUTF8(stringSource(str),this.noAssert)[1],offset+=4+k;var capacity13=this.buffer.byteLength;if(offset>capacity13&&this.resize((capacity13*=2)>offset?capacity13:offset),offset-=4+k,this.littleEndian?(this.view[offset+3]=k>>>24&255,this.view[offset+2]=k>>>16&255,this.view[offset+1]=k>>>8&255,this.view[offset]=255&k):(this.view[offset]=k>>>24&255,this.view[offset+1]=k>>>16&255,this.view[offset+2]=k>>>8&255,this.view[offset+3]=255&k),offset+=4,utfx.encodeUTF16toUTF8(stringSource(str),function(b){this.view[offset++]=b}.bind(this)),offset!==start+4+k)throw RangeError("Illegal range: Truncated data, "+offset+" == "+(offset+4+k));return relative?(this.offset=offset,this):offset-start},ByteBufferPrototype.readIString=function(offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+4) <= "+this.buffer.byteLength)}var start=offset,len=this.readUint32(offset),str=this.readUTF8String(len,ByteBuffer.METRICS_BYTES,offset+=4);return offset+=str.length,relative?(this.offset=offset,str.string):{string:str.string,length:offset-start}},ByteBuffer.METRICS_CHARS="c",ByteBuffer.METRICS_BYTES="b",ByteBufferPrototype.writeUTF8String=function(str,offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+0) <= "+this.buffer.byteLength)}var k,start=offset;k=utfx.calculateUTF16asUTF8(stringSource(str))[1],offset+=k;var capacity14=this.buffer.byteLength;return offset>capacity14&&this.resize((capacity14*=2)>offset?capacity14:offset),offset-=k,utfx.encodeUTF16toUTF8(stringSource(str),function(b){this.view[offset++]=b}.bind(this)),relative?(this.offset=offset,this):offset-start},ByteBufferPrototype.writeString=ByteBufferPrototype.writeUTF8String,ByteBuffer.calculateUTF8Chars=function(str){return utfx.calculateUTF16asUTF8(stringSource(str))[0]},ByteBuffer.calculateUTF8Bytes=function(str){return utfx.calculateUTF16asUTF8(stringSource(str))[1]},ByteBuffer.calculateString=ByteBuffer.calculateUTF8Bytes,ByteBufferPrototype.readUTF8String=function(length,metrics,offset){"number"==typeof metrics&&(offset=metrics,metrics=void 0);var relative=void 0===offset;if(relative&&(offset=this.offset),void 0===metrics&&(metrics=ByteBuffer.METRICS_CHARS),!this.noAssert){if("number"!=typeof length||length%1!=0)throw TypeError("Illegal length: "+length+" (not an integer)");if(length|=0,"number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+0) <= "+this.buffer.byteLength)}var sd,i=0,start=offset;if(metrics===ByteBuffer.METRICS_CHARS){if(sd=stringDestination(),utfx.decodeUTF8(function(){return i<length&&offset<this.limit?this.view[offset++]:null}.bind(this),function(cp){++i,utfx.UTF8toUTF16(cp,sd)}),i!==length)throw RangeError("Illegal range: Truncated data, "+i+" == "+length);return relative?(this.offset=offset,sd()):{string:sd(),length:offset-start}}if(metrics===ByteBuffer.METRICS_BYTES){if(!this.noAssert){if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+length>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+length+") <= "+this.buffer.byteLength)}var k=offset+length;if(utfx.decodeUTF8toUTF16(function(){return offset<k?this.view[offset++]:null}.bind(this),sd=stringDestination(),this.noAssert),offset!==k)throw RangeError("Illegal range: Truncated data, "+offset+" == "+k);return relative?(this.offset=offset,sd()):{string:sd(),length:offset-start}}throw TypeError("Unsupported metrics: "+metrics)},ByteBufferPrototype.readString=ByteBufferPrototype.readUTF8String,ByteBufferPrototype.writeVString=function(str,offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("string"!=typeof str)throw TypeError("Illegal str: Not a string");if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+0) <= "+this.buffer.byteLength)}var k,l,start=offset;k=utfx.calculateUTF16asUTF8(stringSource(str),this.noAssert)[1],l=ByteBuffer.calculateVarint32(k),offset+=l+k;var capacity15=this.buffer.byteLength;if(offset>capacity15&&this.resize((capacity15*=2)>offset?capacity15:offset),offset-=l+k,offset+=this.writeVarint32(k,offset),utfx.encodeUTF16toUTF8(stringSource(str),function(b){this.view[offset++]=b}.bind(this)),offset!==start+k+l)throw RangeError("Illegal range: Truncated data, "+offset+" == "+(offset+k+l));return relative?(this.offset=offset,this):offset-start},ByteBufferPrototype.readVString=function(offset){var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+1) <= "+this.buffer.byteLength)}var start=offset,len=this.readVarint32(offset),str=this.readUTF8String(len.value,ByteBuffer.METRICS_BYTES,offset+=len.length);return offset+=str.length,relative?(this.offset=offset,str.string):{string:str.string,length:offset-start}},ByteBufferPrototype.append=function(source,encoding,offset){"number"!=typeof encoding&&"string"==typeof encoding||(offset=encoding,encoding=void 0);var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+0) <= "+this.buffer.byteLength)}source instanceof ByteBuffer||(source=ByteBuffer.wrap(source,encoding));var length=source.limit-source.offset;if(length<=0)return this;offset+=length;var capacity16=this.buffer.byteLength;return offset>capacity16&&this.resize((capacity16*=2)>offset?capacity16:offset),offset-=length,this.view.set(source.view.subarray(source.offset,source.limit),offset),source.offset+=length,relative&&(this.offset+=length),this},ByteBufferPrototype.appendTo=function(target,offset){return target.append(this,offset),this},ByteBufferPrototype.assert=function(assert){return this.noAssert=!assert,this},ByteBufferPrototype.capacity=function(){return this.buffer.byteLength},ByteBufferPrototype.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},ByteBufferPrototype.clone=function(copy){var bb=new ByteBuffer(0,this.littleEndian,this.noAssert);return copy?(bb.buffer=new ArrayBuffer(this.buffer.byteLength),bb.view=new Uint8Array(bb.buffer)):(bb.buffer=this.buffer,bb.view=this.view),bb.offset=this.offset,bb.markedOffset=this.markedOffset,bb.limit=this.limit,bb},ByteBufferPrototype.compact=function(begin,end){if(void 0===begin&&(begin=this.offset),void 0===end&&(end=this.limit),!this.noAssert){if("number"!=typeof begin||begin%1!=0)throw TypeError("Illegal begin: Not an integer");if(begin>>>=0,"number"!=typeof end||end%1!=0)throw TypeError("Illegal end: Not an integer");if(end>>>=0,begin<0||begin>end||end>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+begin+" <= "+end+" <= "+this.buffer.byteLength)}if(0===begin&&end===this.buffer.byteLength)return this;var len=end-begin;if(0===len)return this.buffer=EMPTY_BUFFER,this.view=null,this.markedOffset>=0&&(this.markedOffset-=begin),this.offset=0,this.limit=0,this;var buffer=new ArrayBuffer(len),view=new Uint8Array(buffer);return view.set(this.view.subarray(begin,end)),this.buffer=buffer,this.view=view,this.markedOffset>=0&&(this.markedOffset-=begin),this.offset=0,this.limit=len,this},ByteBufferPrototype.copy=function(begin,end){if(void 0===begin&&(begin=this.offset),void 0===end&&(end=this.limit),!this.noAssert){if("number"!=typeof begin||begin%1!=0)throw TypeError("Illegal begin: Not an integer");if(begin>>>=0,"number"!=typeof end||end%1!=0)throw TypeError("Illegal end: Not an integer");if(end>>>=0,begin<0||begin>end||end>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+begin+" <= "+end+" <= "+this.buffer.byteLength)}if(begin===end)return new ByteBuffer(0,this.littleEndian,this.noAssert);var capacity=end-begin,bb=new ByteBuffer(capacity,this.littleEndian,this.noAssert);return bb.offset=0,bb.limit=capacity,bb.markedOffset>=0&&(bb.markedOffset-=begin),this.copyTo(bb,0,begin,end),bb},ByteBufferPrototype.copyTo=function(target,targetOffset,sourceOffset,sourceLimit){var relative,targetRelative;if(!this.noAssert&&!ByteBuffer.isByteBuffer(target))throw TypeError("Illegal target: Not a ByteBuffer");if(targetOffset=(targetRelative=void 0===targetOffset)?target.offset:0|targetOffset,sourceOffset=(relative=void 0===sourceOffset)?this.offset:0|sourceOffset,sourceLimit=void 0===sourceLimit?this.limit:0|sourceLimit,targetOffset<0||targetOffset>target.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+targetOffset+" <= "+target.buffer.byteLength);if(sourceOffset<0||sourceLimit>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+sourceOffset+" <= "+this.buffer.byteLength);var len=sourceLimit-sourceOffset;return 0===len?target:(target.ensureCapacity(targetOffset+len),target.view.set(this.view.subarray(sourceOffset,sourceLimit),targetOffset),relative&&(this.offset+=len),targetRelative&&(target.offset+=len),this)},ByteBufferPrototype.ensureCapacity=function(capacity){var current=this.buffer.byteLength;return current<capacity?this.resize((current*=2)>capacity?current:capacity):this},ByteBufferPrototype.fill=function(value,begin,end){var relative=void 0===begin;if(relative&&(begin=this.offset),"string"==typeof value&&value.length>0&&(value=value.charCodeAt(0)),void 0===begin&&(begin=this.offset),void 0===end&&(end=this.limit),!this.noAssert){if("number"!=typeof value||value%1!=0)throw TypeError("Illegal value: "+value+" (not an integer)");if(value|=0,"number"!=typeof begin||begin%1!=0)throw TypeError("Illegal begin: Not an integer");if(begin>>>=0,"number"!=typeof end||end%1!=0)throw TypeError("Illegal end: Not an integer");if(end>>>=0,begin<0||begin>end||end>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+begin+" <= "+end+" <= "+this.buffer.byteLength)}if(begin>=end)return this;for(;begin<end;)this.view[begin++]=value;return relative&&(this.offset=begin),this},ByteBufferPrototype.flip=function(){return this.limit=this.offset,this.offset=0,this},ByteBufferPrototype.mark=function(offset){if(offset=void 0===offset?this.offset:offset,!this.noAssert){if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=offset,this},ByteBufferPrototype.order=function(littleEndian){if(!this.noAssert&&"boolean"!=typeof littleEndian)throw TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!littleEndian,this},ByteBufferPrototype.LE=function(littleEndian){return this.littleEndian=void 0===littleEndian||!!littleEndian,this},ByteBufferPrototype.BE=function(bigEndian){return this.littleEndian=void 0!==bigEndian&&!bigEndian,this},ByteBufferPrototype.prepend=function(source,encoding,offset){"number"!=typeof encoding&&"string"==typeof encoding||(offset=encoding,encoding=void 0);var relative=void 0===offset;if(relative&&(offset=this.offset),!this.noAssert){if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: "+offset+" (not an integer)");if((offset>>>=0)<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+0) <= "+this.buffer.byteLength)}source instanceof ByteBuffer||(source=ByteBuffer.wrap(source,encoding));var len=source.limit-source.offset;if(len<=0)return this;var diff=len-offset;if(diff>0){var buffer=new ArrayBuffer(this.buffer.byteLength+diff),view=new Uint8Array(buffer);view.set(this.view.subarray(offset,this.buffer.byteLength),len),this.buffer=buffer,this.view=view,this.offset+=diff,this.markedOffset>=0&&(this.markedOffset+=diff),this.limit+=diff,offset+=diff}else new Uint8Array(this.buffer);return this.view.set(source.view.subarray(source.offset,source.limit),offset-len),source.offset=source.limit,relative&&(this.offset-=len),this},ByteBufferPrototype.prependTo=function(target,offset){return target.prepend(this,offset),this},ByteBufferPrototype.printDebug=function(out){"function"!=typeof out&&(out=console.log.bind(console)),out(this.toString()+"\n-------------------------------------------------------------------\n"+this.toDebug(!0))},ByteBufferPrototype.remaining=function(){return this.limit-this.offset},ByteBufferPrototype.reset=function(){return this.markedOffset>=0?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},ByteBufferPrototype.resize=function(capacity){if(!this.noAssert){if("number"!=typeof capacity||capacity%1!=0)throw TypeError("Illegal capacity: "+capacity+" (not an integer)");if((capacity|=0)<0)throw RangeError("Illegal capacity: 0 <= "+capacity)}if(this.buffer.byteLength<capacity){var buffer=new ArrayBuffer(capacity),view=new Uint8Array(buffer);view.set(this.view),this.buffer=buffer,this.view=view}return this},ByteBufferPrototype.reverse=function(begin,end){if(void 0===begin&&(begin=this.offset),void 0===end&&(end=this.limit),!this.noAssert){if("number"!=typeof begin||begin%1!=0)throw TypeError("Illegal begin: Not an integer");if(begin>>>=0,"number"!=typeof end||end%1!=0)throw TypeError("Illegal end: Not an integer");if(end>>>=0,begin<0||begin>end||end>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+begin+" <= "+end+" <= "+this.buffer.byteLength)}return begin===end?this:(Array.prototype.reverse.call(this.view.subarray(begin,end)),this)},ByteBufferPrototype.skip=function(length){if(!this.noAssert){if("number"!=typeof length||length%1!=0)throw TypeError("Illegal length: "+length+" (not an integer)");length|=0}var offset=this.offset+length;if(!this.noAssert&&(offset<0||offset>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+length+" <= "+this.buffer.byteLength);return this.offset=offset,this},ByteBufferPrototype.slice=function(begin,end){if(void 0===begin&&(begin=this.offset),void 0===end&&(end=this.limit),!this.noAssert){if("number"!=typeof begin||begin%1!=0)throw TypeError("Illegal begin: Not an integer");if(begin>>>=0,"number"!=typeof end||end%1!=0)throw TypeError("Illegal end: Not an integer");if(end>>>=0,begin<0||begin>end||end>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+begin+" <= "+end+" <= "+this.buffer.byteLength)}var bb=this.clone();return bb.offset=begin,bb.limit=end,bb},ByteBufferPrototype.toBuffer=function(forceCopy){var offset=this.offset,limit=this.limit;if(!this.noAssert){if("number"!=typeof offset||offset%1!=0)throw TypeError("Illegal offset: Not an integer");if(offset>>>=0,"number"!=typeof limit||limit%1!=0)throw TypeError("Illegal limit: Not an integer");if(limit>>>=0,offset<0||offset>limit||limit>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+offset+" <= "+limit+" <= "+this.buffer.byteLength)}if(!forceCopy&&0===offset&&limit===this.buffer.byteLength)return this.buffer;if(offset===limit)return EMPTY_BUFFER;var buffer=new ArrayBuffer(limit-offset);return new Uint8Array(buffer).set(new Uint8Array(this.buffer).subarray(offset,limit),0),buffer},ByteBufferPrototype.toArrayBuffer=ByteBufferPrototype.toBuffer,ByteBufferPrototype.toString=function(encoding,begin,end){if(void 0===encoding)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch("number"==typeof encoding&&(end=begin=encoding="utf8"),encoding){case"utf8":return this.toUTF8(begin,end);case"base64":return this.toBase64(begin,end);case"hex":return this.toHex(begin,end);case"binary":return this.toBinary(begin,end);case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw Error("Unsupported encoding: "+encoding)}};var lxiv=function(){for(var lxiv={},aout=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],ain=[],i=0,k=aout.length;i<k;++i)ain[aout[i]]=i;return lxiv.encode=function(src,dst){for(var b,t;null!==(b=src());)dst(aout[b>>2&63]),t=(3&b)<<4,null!==(b=src())?(dst(aout[63&((t|=b>>4&15)|b>>4&15)]),t=(15&b)<<2,null!==(b=src())?(dst(aout[63&(t|b>>6&3)]),dst(aout[63&b])):(dst(aout[63&t]),dst(61))):(dst(aout[63&t]),dst(61),dst(61))},lxiv.decode=function(src,dst){function fail(c){throw Error("Illegal character code: "+c)}for(var c,t1,t2;null!==(c=src());)if(void 0===(t1=ain[c])&&fail(c),null!==(c=src())&&(void 0===(t2=ain[c])&&fail(c),dst(t1<<2>>>0|(48&t2)>>4),null!==(c=src()))){if(void 0===(t1=ain[c])){if(61===c)break;fail(c)}if(dst((15&t2)<<4>>>0|(60&t1)>>2),null!==(c=src())){if(void 0===(t2=ain[c])){if(61===c)break;fail(c)}dst((3&t1)<<6>>>0|t2)}}},lxiv.test=function(str){return/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(str)},lxiv}();ByteBufferPrototype.toBase64=function(begin,end){if(void 0===begin&&(begin=this.offset),void 0===end&&(end=this.limit),end|=0,(begin|=0)<0||end>this.capacity||begin>end)throw RangeError("begin, end");var sd;return lxiv.encode(function(){return begin<end?this.view[begin++]:null}.bind(this),sd=stringDestination()),sd()},ByteBuffer.fromBase64=function(str,littleEndian){if("string"!=typeof str)throw TypeError("str");var bb=new ByteBuffer(str.length/4*3,littleEndian),i=0;return lxiv.decode(stringSource(str),function(b){bb.view[i++]=b}),bb.limit=i,bb},ByteBuffer.btoa=function(str){return ByteBuffer.fromBinary(str).toBase64()},ByteBuffer.atob=function(b64){return ByteBuffer.fromBase64(b64).toBinary()},ByteBufferPrototype.toBinary=function(begin,end){if(void 0===begin&&(begin=this.offset),void 0===end&&(end=this.limit),end|=0,(begin|=0)<0||end>this.capacity()||begin>end)throw RangeError("begin, end");if(begin===end)return"";for(var chars=[],parts=[];begin<end;)chars.push(this.view[begin++]),chars.length>=1024&&(parts.push(String.fromCharCode.apply(String,chars)),chars=[]);return parts.join("")+String.fromCharCode.apply(String,chars)},ByteBuffer.fromBinary=function(str,littleEndian){if("string"!=typeof str)throw TypeError("str");for(var charCode,i=0,k=str.length,bb=new ByteBuffer(k,littleEndian);i<k;){if((charCode=str.charCodeAt(i))>255)throw RangeError("illegal char code: "+charCode);bb.view[i++]=charCode}return bb.limit=k,bb},ByteBufferPrototype.toDebug=function(columns){for(var b,i=-1,k=this.buffer.byteLength,hex="",asc="",out="";i<k;){if(-1!==i&&(hex+=(b=this.view[i])<16?"0"+b.toString(16).toUpperCase():b.toString(16).toUpperCase(),columns&&(asc+=b>32&&b<127?String.fromCharCode(b):".")),++i,columns&&i>0&&i%16==0&&i!==k){for(;hex.length<51;)hex+=" ";out+=hex+asc+"\n",hex=asc=""}i===this.offset&&i===this.limit?hex+=i===this.markedOffset?"!":"|":i===this.offset?hex+=i===this.markedOffset?"[":"<":i===this.limit?hex+=i===this.markedOffset?"]":">":hex+=i===this.markedOffset?"'":columns||0!==i&&i!==k?" ":""}if(columns&&" "!==hex){for(;hex.length<51;)hex+=" ";out+=hex+asc+"\n"}return columns?out:hex},ByteBuffer.fromDebug=function(str,littleEndian,noAssert){for(var ch,b,k=str.length,bb=new ByteBuffer((k+1)/3|0,littleEndian,noAssert),i=0,j=0,rs=!1,ho=!1,hm=!1,hl=!1,fail=!1;i<k;){switch(ch=str.charAt(i++)){case"!":if(!noAssert){if(ho||hm||hl){fail=!0;break}ho=hm=hl=!0}bb.offset=bb.markedOffset=bb.limit=j,rs=!1;break;case"|":if(!noAssert){if(ho||hl){fail=!0;break}ho=hl=!0}bb.offset=bb.limit=j,rs=!1;break;case"[":if(!noAssert){if(ho||hm){fail=!0;break}ho=hm=!0}bb.offset=bb.markedOffset=j,rs=!1;break;case"<":if(!noAssert){if(ho){fail=!0;break}ho=!0}bb.offset=j,rs=!1;break;case"]":if(!noAssert){if(hl||hm){fail=!0;break}hl=hm=!0}bb.limit=bb.markedOffset=j,rs=!1;break;case">":if(!noAssert){if(hl){fail=!0;break}hl=!0}bb.limit=j,rs=!1;break;case"'":if(!noAssert){if(hm){fail=!0;break}hm=!0}bb.markedOffset=j,rs=!1;break;case" ":rs=!1;break;default:if(!noAssert&&rs){fail=!0;break}if(b=parseInt(ch+str.charAt(i++),16),!noAssert&&(isNaN(b)||b<0||b>255))throw TypeError("Illegal str: Not a debug encoded string");bb.view[j++]=b,rs=!0}if(fail)throw TypeError("Illegal str: Invalid symbol at "+i)}if(!noAssert){if(!ho||!hl)throw TypeError("Illegal str: Missing offset or limit");if(j<bb.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+j+" < "+k)}return bb},ByteBufferPrototype.toHex=function(begin,end){if(begin=void 0===begin?this.offset:begin,end=void 0===end?this.limit:end,!this.noAssert){if("number"!=typeof begin||begin%1!=0)throw TypeError("Illegal begin: Not an integer");if(begin>>>=0,"number"!=typeof end||end%1!=0)throw TypeError("Illegal end: Not an integer");if(end>>>=0,begin<0||begin>end||end>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+begin+" <= "+end+" <= "+this.buffer.byteLength)}for(var b,out=new Array(end-begin);begin<end;)(b=this.view[begin++])<16?out.push("0",b.toString(16)):out.push(b.toString(16));return out.join("")},ByteBuffer.fromHex=function(str,littleEndian,noAssert){if(!noAssert){if("string"!=typeof str)throw TypeError("Illegal str: Not a string");if(str.length%2!=0)throw TypeError("Illegal str: Length not a multiple of 2")}for(var b,k=str.length,bb=new ByteBuffer(k/2|0,littleEndian),i=0,j=0;i<k;i+=2){if(b=parseInt(str.substring(i,i+2),16),!noAssert&&(!isFinite(b)||b<0||b>255))throw TypeError("Illegal str: Contains non-hex characters");bb.view[j++]=b}return bb.limit=j,bb};var utfx=function(){var utfx={MAX_CODEPOINT:1114111,encodeUTF8:function(src,dst){var cp=null;for("number"==typeof src&&(cp=src,src=function(){return null});null!==cp||null!==(cp=src());)cp<128?dst(127&cp):cp<2048?(dst(cp>>6&31|192),dst(63&cp|128)):cp<65536?(dst(cp>>12&15|224),dst(cp>>6&63|128),dst(63&cp|128)):(dst(cp>>18&7|240),dst(cp>>12&63|128),dst(cp>>6&63|128),dst(63&cp|128)),cp=null},decodeUTF8:function(src,dst){for(var a,b,c,d,fail=function(b){b=b.slice(0,b.indexOf(null));var err=Error(b.toString());throw err.name="TruncatedError",err.bytes=b,err};null!==(a=src());)if(0==(128&a))dst(a);else if(192==(224&a))null===(b=src())&&fail([a,b]),dst((31&a)<<6|63&b);else if(224==(240&a))(null===(b=src())||null===(c=src()))&&fail([a,b,c]),dst((15&a)<<12|(63&b)<<6|63&c);else{if(240!=(248&a))throw RangeError("Illegal starting byte: "+a);(null===(b=src())||null===(c=src())||null===(d=src()))&&fail([a,b,c,d]),dst((7&a)<<18|(63&b)<<12|(63&c)<<6|63&d)}},UTF16toUTF8:function(src,dst){for(var c1,c2=null;null!==(c1=null!==c2?c2:src());)c1>=55296&&c1<=57343&&null!==(c2=src())&&c2>=56320&&c2<=57343?(dst(1024*(c1-55296)+c2-56320+65536),c2=null):dst(c1);null!==c2&&dst(c2)},UTF8toUTF16:function(src,dst){var cp=null;for("number"==typeof src&&(cp=src,src=function(){return null});null!==cp||null!==(cp=src());)cp<=65535?dst(cp):(dst(55296+((cp-=65536)>>10)),dst(cp%1024+56320)),cp=null},encodeUTF16toUTF8:function(src,dst){utfx.UTF16toUTF8(src,function(cp){utfx.encodeUTF8(cp,dst)})},decodeUTF8toUTF16:function(src,dst){utfx.decodeUTF8(src,function(cp){utfx.UTF8toUTF16(cp,dst)})},calculateCodePoint:function(cp){return cp<128?1:cp<2048?2:cp<65536?3:4},calculateUTF8:function(src){for(var cp,l=0;null!==(cp=src());)l+=cp<128?1:cp<2048?2:cp<65536?3:4;return l},calculateUTF16asUTF8:function(src){var n=0,l=0;return utfx.UTF16toUTF8(src,function(cp){++n,l+=cp<128?1:cp<2048?2:cp<65536?3:4}),[n,l]}};return utfx}();return ByteBufferPrototype.toUTF8=function(begin,end){if(void 0===begin&&(begin=this.offset),void 0===end&&(end=this.limit),!this.noAssert){if("number"!=typeof begin||begin%1!=0)throw TypeError("Illegal begin: Not an integer");if(begin>>>=0,"number"!=typeof end||end%1!=0)throw TypeError("Illegal end: Not an integer");if(end>>>=0,begin<0||begin>end||end>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+begin+" <= "+end+" <= "+this.buffer.byteLength)}var sd;try{utfx.decodeUTF8toUTF16(function(){return begin<end?this.view[begin++]:null}.bind(this),sd=stringDestination())}catch(e){if(begin!==end)throw RangeError("Illegal range: Truncated data, "+begin+" != "+end)}return sd()},ByteBuffer.fromUTF8=function(str,littleEndian,noAssert){if(!noAssert&&"string"!=typeof str)throw TypeError("Illegal str: Not a string");var bb=new ByteBuffer(utfx.calculateUTF16asUTF8(stringSource(str),!0)[1],littleEndian,noAssert),i=0;return utfx.encodeUTF16toUTF8(stringSource(str),function(b){bb.view[i++]=b}),bb.limit=i,bb},ByteBuffer},"function"==typeof _dereq_&&"object"==typeof module&&module&&module.exports?module.exports=function(){var Long;try{Long=_dereq_("long")}catch(e){}return factory(Long)}():(global.dcodeIO=global.dcodeIO||{}).ByteBuffer=factory(global.dcodeIO.Long)},{long:3}],3:[function(_dereq_,module,exports){var global,factory;global=this,factory=function(){"use strict";function Long(low,high,unsigned){this.low=0|low,this.high=0|high,this.unsigned=!!unsigned}function isLong(obj){return!0===(obj&&obj.__isLong__)}function fromInt(value,unsigned){var obj,cachedObj,cache;return unsigned?(cache=0<=(value>>>=0)&&value<256)&&(cachedObj=UINT_CACHE[value])?cachedObj:(obj=fromBits(value,(0|value)<0?-1:0,!0),cache&&(UINT_CACHE[value]=obj),obj):(cache=-128<=(value|=0)&&value<128)&&(cachedObj=INT_CACHE[value])?cachedObj:(obj=fromBits(value,value<0?-1:0,!1),cache&&(INT_CACHE[value]=obj),obj)}function fromNumber(value,unsigned){if(isNaN(value)||!isFinite(value))return unsigned?UZERO:ZERO;if(unsigned){if(value<0)return UZERO;if(value>=TWO_PWR_64_DBL)return MAX_UNSIGNED_VALUE}else{if(value<=-TWO_PWR_63_DBL)return MIN_VALUE;if(value+1>=TWO_PWR_63_DBL)return MAX_VALUE}return value<0?fromNumber(-value,unsigned).neg():fromBits(value%TWO_PWR_32_DBL|0,value/TWO_PWR_32_DBL|0,unsigned)}function fromBits(lowBits,highBits,unsigned){return new Long(lowBits,highBits,unsigned)}function fromString(str,unsigned,radix){if(0===str.length)throw Error("empty string");if("NaN"===str||"Infinity"===str||"+Infinity"===str||"-Infinity"===str)return ZERO;if("number"==typeof unsigned?(radix=unsigned,unsigned=!1):unsigned=!!unsigned,(radix=radix||10)<2||36<radix)throw RangeError("radix");var p;if((p=str.indexOf("-"))>0)throw Error("interior hyphen");if(0===p)return fromString(str.substring(1),unsigned,radix).neg();for(var radixToPower=fromNumber(pow_dbl(radix,8)),result=ZERO,i=0;i<str.length;i+=8){var size=Math.min(8,str.length-i),value=parseInt(str.substring(i,i+size),radix);if(size<8){var power=fromNumber(pow_dbl(radix,size));result=result.mul(power).add(fromNumber(value))}else result=(result=result.mul(radixToPower)).add(fromNumber(value))}return result.unsigned=unsigned,result}function fromValue(val){return val instanceof Long?val:"number"==typeof val?fromNumber(val):"string"==typeof val?fromString(val):fromBits(val.low,val.high,val.unsigned)}Long.prototype.__isLong__,Object.defineProperty(Long.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),Long.isLong=isLong;var INT_CACHE={},UINT_CACHE={};Long.fromInt=fromInt,Long.fromNumber=fromNumber,Long.fromBits=fromBits;var pow_dbl=Math.pow;Long.fromString=fromString,Long.fromValue=fromValue;var TWO_PWR_32_DBL=4294967296,TWO_PWR_64_DBL=TWO_PWR_32_DBL*TWO_PWR_32_DBL,TWO_PWR_63_DBL=TWO_PWR_64_DBL/2,TWO_PWR_24=fromInt(1<<24),ZERO=fromInt(0);Long.ZERO=ZERO;var UZERO=fromInt(0,!0);Long.UZERO=UZERO;var ONE=fromInt(1);Long.ONE=ONE;var UONE=fromInt(1,!0);Long.UONE=UONE;var NEG_ONE=fromInt(-1);Long.NEG_ONE=NEG_ONE;var MAX_VALUE=fromBits(-1,2147483647,!1);Long.MAX_VALUE=MAX_VALUE;var MAX_UNSIGNED_VALUE=fromBits(-1,-1,!0);Long.MAX_UNSIGNED_VALUE=MAX_UNSIGNED_VALUE;var MIN_VALUE=fromBits(0,-2147483648,!1);Long.MIN_VALUE=MIN_VALUE;var LongPrototype=Long.prototype;return LongPrototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},LongPrototype.toNumber=function(){return this.unsigned?(this.high>>>0)*TWO_PWR_32_DBL+(this.low>>>0):this.high*TWO_PWR_32_DBL+(this.low>>>0)},LongPrototype.toString=function(radix){if((radix=radix||10)<2||36<radix)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(MIN_VALUE)){var radixLong=fromNumber(radix),div=this.div(radixLong),rem1=div.mul(radixLong).sub(this);return div.toString(radix)+rem1.toInt().toString(radix)}return"-"+this.neg().toString(radix)}for(var radixToPower=fromNumber(pow_dbl(radix,6),this.unsigned),rem=this,result="";;){var remDiv=rem.div(radixToPower),digits=(rem.sub(remDiv.mul(radixToPower)).toInt()>>>0).toString(radix);if((rem=remDiv).isZero())return digits+result;for(;digits.length<6;)digits="0"+digits;result=""+digits+result}},LongPrototype.getHighBits=function(){return this.high},LongPrototype.getHighBitsUnsigned=function(){return this.high>>>0},LongPrototype.getLowBits=function(){return this.low},LongPrototype.getLowBitsUnsigned=function(){return this.low>>>0},LongPrototype.getNumBitsAbs=function(){if(this.isNegative())return this.eq(MIN_VALUE)?64:this.neg().getNumBitsAbs();for(var val=0!=this.high?this.high:this.low,bit=31;bit>0&&0==(val&1<<bit);bit--);return 0!=this.high?bit+33:bit+1},LongPrototype.isZero=function(){return 0===this.high&&0===this.low},LongPrototype.isNegative=function(){return!this.unsigned&&this.high<0},LongPrototype.isPositive=function(){return this.unsigned||this.high>=0},LongPrototype.isOdd=function(){return 1==(1&this.low)},LongPrototype.isEven=function(){return 0==(1&this.low)},LongPrototype.equals=function(other){return isLong(other)||(other=fromValue(other)),(this.unsigned===other.unsigned||this.high>>>31!=1||other.high>>>31!=1)&&this.high===other.high&&this.low===other.low},LongPrototype.eq=LongPrototype.equals,LongPrototype.notEquals=function(other){return!this.eq(other)},LongPrototype.neq=LongPrototype.notEquals,LongPrototype.lessThan=function(other){return this.comp(other)<0},LongPrototype.lt=LongPrototype.lessThan,LongPrototype.lessThanOrEqual=function(other){return this.comp(other)<=0},LongPrototype.lte=LongPrototype.lessThanOrEqual,LongPrototype.greaterThan=function(other){return this.comp(other)>0},LongPrototype.gt=LongPrototype.greaterThan,LongPrototype.greaterThanOrEqual=function(other){return this.comp(other)>=0},LongPrototype.gte=LongPrototype.greaterThanOrEqual,LongPrototype.compare=function(other){if(isLong(other)||(other=fromValue(other)),this.eq(other))return 0;var thisNeg=this.isNegative(),otherNeg=other.isNegative();return thisNeg&&!otherNeg?-1:!thisNeg&&otherNeg?1:this.unsigned?other.high>>>0>this.high>>>0||other.high===this.high&&other.low>>>0>this.low>>>0?-1:1:this.sub(other).isNegative()?-1:1},LongPrototype.comp=LongPrototype.compare,LongPrototype.negate=function(){return!this.unsigned&&this.eq(MIN_VALUE)?MIN_VALUE:this.not().add(ONE)},LongPrototype.neg=LongPrototype.negate,LongPrototype.add=function(addend){isLong(addend)||(addend=fromValue(addend));var a48=this.high>>>16,a32=65535&this.high,a16=this.low>>>16,a00=65535&this.low,b48=addend.high>>>16,b32=65535&addend.high,b16=addend.low>>>16,c48=0,c32=0,c16=0,c00=0;return c16+=(c00+=a00+(65535&addend.low))>>>16,c32+=(c16+=a16+b16)>>>16,c48+=(c32+=a32+b32)>>>16,c48+=a48+b48,fromBits((c16&=65535)<<16|(c00&=65535),(c48&=65535)<<16|(c32&=65535),this.unsigned)},LongPrototype.subtract=function(subtrahend){return isLong(subtrahend)||(subtrahend=fromValue(subtrahend)),this.add(subtrahend.neg())},LongPrototype.sub=LongPrototype.subtract,LongPrototype.multiply=function(multiplier){if(this.isZero())return ZERO;if(isLong(multiplier)||(multiplier=fromValue(multiplier)),multiplier.isZero())return ZERO;if(this.eq(MIN_VALUE))return multiplier.isOdd()?MIN_VALUE:ZERO;if(multiplier.eq(MIN_VALUE))return this.isOdd()?MIN_VALUE:ZERO;if(this.isNegative())return multiplier.isNegative()?this.neg().mul(multiplier.neg()):this.neg().mul(multiplier).neg();if(multiplier.isNegative())return this.mul(multiplier.neg()).neg();if(this.lt(TWO_PWR_24)&&multiplier.lt(TWO_PWR_24))return fromNumber(this.toNumber()*multiplier.toNumber(),this.unsigned);var a48=this.high>>>16,a32=65535&this.high,a16=this.low>>>16,a00=65535&this.low,b48=multiplier.high>>>16,b32=65535&multiplier.high,b16=multiplier.low>>>16,b00=65535&multiplier.low,c48=0,c32=0,c16=0,c00=0;return c16+=(c00+=a00*b00)>>>16,c32+=(c16+=a16*b00)>>>16,c16&=65535,c32+=(c16+=a00*b16)>>>16,c48+=(c32+=a32*b00)>>>16,c32&=65535,c48+=(c32+=a16*b16)>>>16,c32&=65535,c48+=(c32+=a00*b32)>>>16,c48+=a48*b00+a32*b16+a16*b32+a00*b48,fromBits((c16&=65535)<<16|(c00&=65535),(c48&=65535)<<16|(c32&=65535),this.unsigned)},LongPrototype.mul=LongPrototype.multiply,LongPrototype.divide=function(divisor){if(isLong(divisor)||(divisor=fromValue(divisor)),divisor.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?UZERO:ZERO;var approx,rem,res;if(this.unsigned){if(divisor.unsigned||(divisor=divisor.toUnsigned()),divisor.gt(this))return UZERO;if(divisor.gt(this.shru(1)))return UONE;res=UZERO}else{if(this.eq(MIN_VALUE))return divisor.eq(ONE)||divisor.eq(NEG_ONE)?MIN_VALUE:divisor.eq(MIN_VALUE)?ONE:(approx=this.shr(1).div(divisor).shl(1)).eq(ZERO)?divisor.isNegative()?ONE:NEG_ONE:(rem=this.sub(divisor.mul(approx)),res=approx.add(rem.div(divisor)));if(divisor.eq(MIN_VALUE))return this.unsigned?UZERO:ZERO;if(this.isNegative())return divisor.isNegative()?this.neg().div(divisor.neg()):this.neg().div(divisor).neg();if(divisor.isNegative())return this.div(divisor.neg()).neg();res=ZERO}for(rem=this;rem.gte(divisor);){approx=Math.max(1,Math.floor(rem.toNumber()/divisor.toNumber()));for(var log2=Math.ceil(Math.log(approx)/Math.LN2),delta=log2<=48?1:pow_dbl(2,log2-48),approxRes=fromNumber(approx),approxRem=approxRes.mul(divisor);approxRem.isNegative()||approxRem.gt(rem);)approxRem=(approxRes=fromNumber(approx-=delta,this.unsigned)).mul(divisor);approxRes.isZero()&&(approxRes=ONE),res=res.add(approxRes),rem=rem.sub(approxRem)}return res},LongPrototype.div=LongPrototype.divide,LongPrototype.modulo=function(divisor){return isLong(divisor)||(divisor=fromValue(divisor)),this.sub(this.div(divisor).mul(divisor))},LongPrototype.mod=LongPrototype.modulo,LongPrototype.not=function(){return fromBits(~this.low,~this.high,this.unsigned)},LongPrototype.and=function(other){return isLong(other)||(other=fromValue(other)),fromBits(this.low&other.low,this.high&other.high,this.unsigned)},LongPrototype.or=function(other){return isLong(other)||(other=fromValue(other)),fromBits(this.low|other.low,this.high|other.high,this.unsigned)},LongPrototype.xor=function(other){return isLong(other)||(other=fromValue(other)),fromBits(this.low^other.low,this.high^other.high,this.unsigned)},LongPrototype.shiftLeft=function(numBits){return isLong(numBits)&&(numBits=numBits.toInt()),0==(numBits&=63)?this:numBits<32?fromBits(this.low<<numBits,this.high<<numBits|this.low>>>32-numBits,this.unsigned):fromBits(0,this.low<<numBits-32,this.unsigned)},LongPrototype.shl=LongPrototype.shiftLeft,LongPrototype.shiftRight=function(numBits){return isLong(numBits)&&(numBits=numBits.toInt()),0==(numBits&=63)?this:numBits<32?fromBits(this.low>>>numBits|this.high<<32-numBits,this.high>>numBits,this.unsigned):fromBits(this.high>>numBits-32,this.high>=0?0:-1,this.unsigned)},LongPrototype.shr=LongPrototype.shiftRight,LongPrototype.shiftRightUnsigned=function(numBits){if(isLong(numBits)&&(numBits=numBits.toInt()),0==(numBits&=63))return this;var high=this.high;return numBits<32?fromBits(this.low>>>numBits|high<<32-numBits,high>>>numBits,this.unsigned):fromBits(32===numBits?high:high>>>numBits-32,0,this.unsigned)},LongPrototype.shru=LongPrototype.shiftRightUnsigned,LongPrototype.toSigned=function(){return this.unsigned?fromBits(this.low,this.high,!1):this},LongPrototype.toUnsigned=function(){return this.unsigned?this:fromBits(this.low,this.high,!0)},LongPrototype.toBytes=function(le){return le?this.toBytesLE():this.toBytesBE()},LongPrototype.toBytesLE=function(){var hi=this.high,lo=this.low;return[255&lo,lo>>>8&255,lo>>>16&255,lo>>>24&255,255&hi,hi>>>8&255,hi>>>16&255,hi>>>24&255]},LongPrototype.toBytesBE=function(){var hi=this.high,lo=this.low;return[hi>>>24&255,hi>>>16&255,hi>>>8&255,255&hi,lo>>>24&255,lo>>>16&255,lo>>>8&255,255&lo]},Long},"function"==typeof _dereq_&&"object"==typeof module&&module&&module.exports?module.exports=factory():(global.dcodeIO=global.dcodeIO||{}).Long=factory()},{}],4:[function(_dereq_,module,exports){function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,function(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}var cachedSetTimeout,cachedClearTimeout,process=module.exports={};!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(name){return[]},process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],5:[function(_dereq_,module,exports){(function(process){var global,factory;global=this,factory=function(ByteBuffer,isCommonJS){"use strict";var Util,ProtoBuf={};return ProtoBuf.ByteBuffer=ByteBuffer,ProtoBuf.Long=ByteBuffer.Long||null,ProtoBuf.VERSION="5.0.2",ProtoBuf.WIRE_TYPES={},ProtoBuf.WIRE_TYPES.VARINT=0,ProtoBuf.WIRE_TYPES.BITS64=1,ProtoBuf.WIRE_TYPES.LDELIM=2,ProtoBuf.WIRE_TYPES.STARTGROUP=3,ProtoBuf.WIRE_TYPES.ENDGROUP=4,ProtoBuf.WIRE_TYPES.BITS32=5,ProtoBuf.PACKABLE_WIRE_TYPES=[ProtoBuf.WIRE_TYPES.VARINT,ProtoBuf.WIRE_TYPES.BITS64,ProtoBuf.WIRE_TYPES.BITS32],ProtoBuf.TYPES={int32:{name:"int32",wireType:ProtoBuf.WIRE_TYPES.VARINT,defaultValue:0},uint32:{name:"uint32",wireType:ProtoBuf.WIRE_TYPES.VARINT,defaultValue:0},sint32:{name:"sint32",wireType:ProtoBuf.WIRE_TYPES.VARINT,defaultValue:0},int64:{name:"int64",wireType:ProtoBuf.WIRE_TYPES.VARINT,defaultValue:ProtoBuf.Long?ProtoBuf.Long.ZERO:void 0},uint64:{name:"uint64",wireType:ProtoBuf.WIRE_TYPES.VARINT,defaultValue:ProtoBuf.Long?ProtoBuf.Long.UZERO:void 0},sint64:{name:"sint64",wireType:ProtoBuf.WIRE_TYPES.VARINT,defaultValue:ProtoBuf.Long?ProtoBuf.Long.ZERO:void 0},bool:{name:"bool",wireType:ProtoBuf.WIRE_TYPES.VARINT,defaultValue:!1},double:{name:"double",wireType:ProtoBuf.WIRE_TYPES.BITS64,defaultValue:0},string:{name:"string",wireType:ProtoBuf.WIRE_TYPES.LDELIM,defaultValue:""},bytes:{name:"bytes",wireType:ProtoBuf.WIRE_TYPES.LDELIM,defaultValue:null},fixed32:{name:"fixed32",wireType:ProtoBuf.WIRE_TYPES.BITS32,defaultValue:0},sfixed32:{name:"sfixed32",wireType:ProtoBuf.WIRE_TYPES.BITS32,defaultValue:0},fixed64:{name:"fixed64",wireType:ProtoBuf.WIRE_TYPES.BITS64,defaultValue:ProtoBuf.Long?ProtoBuf.Long.UZERO:void 0},sfixed64:{name:"sfixed64",wireType:ProtoBuf.WIRE_TYPES.BITS64,defaultValue:ProtoBuf.Long?ProtoBuf.Long.ZERO:void 0},float:{name:"float",wireType:ProtoBuf.WIRE_TYPES.BITS32,defaultValue:0},enum:{name:"enum",wireType:ProtoBuf.WIRE_TYPES.VARINT,defaultValue:0},message:{name:"message",wireType:ProtoBuf.WIRE_TYPES.LDELIM,defaultValue:null},group:{name:"group",wireType:ProtoBuf.WIRE_TYPES.STARTGROUP,defaultValue:null}},ProtoBuf.MAP_KEY_TYPES=[ProtoBuf.TYPES.int32,ProtoBuf.TYPES.sint32,ProtoBuf.TYPES.sfixed32,ProtoBuf.TYPES.uint32,ProtoBuf.TYPES.fixed32,ProtoBuf.TYPES.int64,ProtoBuf.TYPES.sint64,ProtoBuf.TYPES.sfixed64,ProtoBuf.TYPES.uint64,ProtoBuf.TYPES.fixed64,ProtoBuf.TYPES.bool,ProtoBuf.TYPES.string,ProtoBuf.TYPES.bytes],ProtoBuf.ID_MIN=1,ProtoBuf.ID_MAX=536870911,ProtoBuf.convertFieldsToCamelCase=!1,ProtoBuf.populateAccessors=!0,ProtoBuf.populateDefaults=!0,ProtoBuf.Util=((Util={}).IS_NODE=!("object"!=typeof process||process+""!="[object process]"||process.browser),Util.XHR=function(){for(var XMLHttpFactories=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],xhr=null,i=0;i<XMLHttpFactories.length;i++){try{xhr=XMLHttpFactories[i]()}catch(e){continue}break}if(!xhr)throw Error("XMLHttpRequest is not supported");return xhr},Util.fetch=function(path,callback){if(callback&&"function"!=typeof callback&&(callback=null),Util.IS_NODE){var fs=_dereq_("fs");if(callback)fs.readFile(path,function(err,data){callback(err?null:""+data)});else try{return fs.readFileSync(path)}catch(e){return null}}else{var xhr=Util.XHR();if(xhr.open("GET",path,!!callback),xhr.setRequestHeader("Accept","text/plain"),"function"==typeof xhr.overrideMimeType&&xhr.overrideMimeType("text/plain"),!callback)return xhr.send(null),200==xhr.status||0==xhr.status&&"string"==typeof xhr.responseText?xhr.responseText:null;if(xhr.onreadystatechange=function(){4==xhr.readyState&&callback(200==xhr.status||0==xhr.status&&"string"==typeof xhr.responseText?xhr.responseText:null)},4==xhr.readyState)return;xhr.send(null)}},Util.toCamelCase=function(str){return str.replace(/_([a-zA-Z])/g,function($0,$1){return $1.toUpperCase()})},Util),ProtoBuf.Lang={DELIM:/[\s\{\}=;:\[\],'"\(\)<>]/g,RULE:/^(?:required|optional|repeated|map)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,FQTYPEREF:/^(?:\.[a-zA-Z][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+|([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0[xX][0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/,BOOL:/^(?:true|false)$/i,ID:/^(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\s/,STRING:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")|(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,STRING_DQ:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,STRING_SQ:/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g},ProtoBuf.DotProto=function(ProtoBuf,Lang){function mkId(value,mayBeNegative){var id=-1,sign=1;if("-"==value.charAt(0)&&(sign=-1,value=value.substring(1)),Lang.NUMBER_DEC.test(value))id=parseInt(value);else if(Lang.NUMBER_HEX.test(value))id=parseInt(value.substring(2),16);else{if(!Lang.NUMBER_OCT.test(value))throw Error("illegal id value: "+(sign<0?"-":"")+value);id=parseInt(value.substring(1),8)}if(id=sign*id|0,!mayBeNegative&&id<0)throw Error("illegal id value: "+(sign<0?"-":"")+value);return id}function mkNumber(val){var sign=1;if("-"==val.charAt(0)&&(sign=-1,val=val.substring(1)),Lang.NUMBER_DEC.test(val))return sign*parseInt(val,10);if(Lang.NUMBER_HEX.test(val))return sign*parseInt(val.substring(2),16);if(Lang.NUMBER_OCT.test(val))return sign*parseInt(val.substring(1),8);if("inf"===val)return sign*(1/0);if("nan"===val)return NaN;if(Lang.NUMBER_FLT.test(val))return sign*parseFloat(val);throw Error("illegal number value: "+(sign<0?"-":"")+val)}function setOption(options,name,value){void 0===options[name]?options[name]=value:(Array.isArray(options[name])||(options[name]=[options[name]]),options[name].push(value))}var DotProto={},Tokenizer=function(proto){this.source=proto+"",this.index=0,this.line=1,this.stack=[],this._stringOpen=null},TokenizerPrototype=Tokenizer.prototype;TokenizerPrototype._readString=function(){var re='"'===this._stringOpen?Lang.STRING_DQ:Lang.STRING_SQ;re.lastIndex=this.index-1;var match=re.exec(this.source);if(!match)throw Error("unterminated string");return this.index=re.lastIndex,this.stack.push(this._stringOpen),this._stringOpen=null,match[1]},TokenizerPrototype.next=function(){if(this.stack.length>0)return this.stack.shift();if(this.index>=this.source.length)return null;if(null!==this._stringOpen)return this._readString();var repeat,prev,next;do{for(repeat=!1;Lang.WHITESPACE.test(next=this.source.charAt(this.index));)if("\n"===next&&++this.line,++this.index===this.source.length)return null;if("/"===this.source.charAt(this.index))if(++this.index,"/"===this.source.charAt(this.index)){for(;"\n"!==this.source.charAt(++this.index);)if(this.index==this.source.length)return null;++this.index,++this.line,repeat=!0}else{if("*"!==(next=this.source.charAt(this.index)))return"/";do{if("\n"===next&&++this.line,++this.index===this.source.length)return null;prev=next,next=this.source.charAt(this.index)}while("*"!==prev||"/"!==next);++this.index,repeat=!0}}while(repeat);if(this.index===this.source.length)return null;var end=this.index;if(Lang.DELIM.lastIndex=0,!Lang.DELIM.test(this.source.charAt(end++)))for(;end<this.source.length&&!Lang.DELIM.test(this.source.charAt(end));)++end;var token=this.source.substring(this.index,this.index=end);return'"'!==token&&"'"!==token||(this._stringOpen=token),token},TokenizerPrototype.peek=function(){if(0===this.stack.length){var token=this.next();if(null===token)return null;this.stack.push(token)}return this.stack[0]},TokenizerPrototype.skip=function(expected){var actual=this.next();if(actual!==expected)throw Error("illegal '"+actual+"', '"+expected+"' expected")},TokenizerPrototype.omit=function(expected){return this.peek()===expected&&(this.next(),!0)},TokenizerPrototype.toString=function(){return"Tokenizer ("+this.index+"/"+this.source.length+" at line "+this.line+")"},DotProto.Tokenizer=Tokenizer;var Parser=function(source){this.tn=new Tokenizer(source),this.proto3=!1},ParserPrototype=Parser.prototype;return ParserPrototype.parse=function(){var token,weak,topLevel={name:"[ROOT]",package:null,messages:[],enums:[],imports:[],options:{},services:[]},head=!0;try{for(;token=this.tn.next();)switch(token){case"package":if(!head||null!==topLevel.package)throw Error("unexpected 'package'");if(token=this.tn.next(),!Lang.TYPEREF.test(token))throw Error("illegal package name: "+token);this.tn.skip(";"),topLevel.package=token;break;case"import":if(!head)throw Error("unexpected 'import'");("public"===(token=this.tn.peek())||(weak="weak"===token))&&this.tn.next(),token=this._readString(),this.tn.skip(";"),weak||topLevel.imports.push(token);break;case"syntax":if(!head)throw Error("unexpected 'syntax'");this.tn.skip("="),"proto3"===(topLevel.syntax=this._readString())&&(this.proto3=!0),this.tn.skip(";");break;case"message":this._parseMessage(topLevel,null),head=!1;break;case"enum":this._parseEnum(topLevel),head=!1;break;case"option":this._parseOption(topLevel);break;case"service":this._parseService(topLevel);break;case"extend":this._parseExtend(topLevel);break;default:throw Error("unexpected '"+token+"'")}}catch(e){throw e.message="Parse error at line "+this.tn.line+": "+e.message,e}return delete topLevel.name,topLevel},Parser.parse=function(source){return new Parser(source).parse()},ParserPrototype._readString=function(){var token,delim,value="";do{if("'"!==(delim=this.tn.next())&&'"'!==delim)throw Error("illegal string delimiter: "+delim);value+=this.tn.next(),this.tn.skip(delim),token=this.tn.peek()}while('"'===token||'"'===token);return value},ParserPrototype._readValue=function(mayBeTypeRef){var token=this.tn.peek();if('"'===token||"'"===token)return this._readString();if(this.tn.next(),Lang.NUMBER.test(token))return mkNumber(token);if(Lang.BOOL.test(token))return"true"===token.toLowerCase();if(mayBeTypeRef&&Lang.TYPEREF.test(token))return token;throw Error("illegal value: "+token)},ParserPrototype._parseOption=function(parent,isList){var token=this.tn.next(),custom=!1;if("("===token&&(custom=!0,token=this.tn.next()),!Lang.TYPEREF.test(token))throw Error("illegal option name: "+token);var name=token;custom&&(this.tn.skip(")"),name="("+name+")",token=this.tn.peek(),Lang.FQTYPEREF.test(token)&&(name+=token,this.tn.next())),this.tn.skip("="),this._parseOptionValue(parent,name),isList||this.tn.skip(";")},ParserPrototype._parseOptionValue=function(parent,name){var token=this.tn.peek();if("{"!==token)setOption(parent.options,name,this._readValue(!0));else for(this.tn.skip("{");"}"!==(token=this.tn.next());){if(!Lang.NAME.test(token))throw Error("illegal option name: "+name+"."+token);this.tn.omit(":")?setOption(parent.options,name+"."+token,this._readValue(!0)):this._parseOptionValue(parent,name+"."+token)}},ParserPrototype._parseService=function(parent){var token=this.tn.next();if(!Lang.NAME.test(token))throw Error("illegal service name at line "+this.tn.line+": "+token);var svc={name:token,rpc:{},options:{}};for(this.tn.skip("{");"}"!==(token=this.tn.next());)if("option"===token)this._parseOption(svc);else{if("rpc"!==token)throw Error("illegal service token: "+token);this._parseServiceRPC(svc)}this.tn.omit(";"),parent.services.push(svc)},ParserPrototype._parseServiceRPC=function(svc){var token=this.tn.next();if(!Lang.NAME.test(token))throw Error("illegal rpc service method name: "+token);var name=token,method={request:null,response:null,request_stream:!1,response_stream:!1,options:{}};if(this.tn.skip("("),"stream"===(token=this.tn.next()).toLowerCase()&&(method.request_stream=!0,token=this.tn.next()),!Lang.TYPEREF.test(token))throw Error("illegal rpc service request type: "+token);if(method.request=token,this.tn.skip(")"),"returns"!==(token=this.tn.next()).toLowerCase())throw Error("illegal rpc service request type delimiter: "+token);if(this.tn.skip("("),"stream"===(token=this.tn.next()).toLowerCase()&&(method.response_stream=!0,token=this.tn.next()),method.response=token,this.tn.skip(")"),"{"===(token=this.tn.peek())){for(this.tn.next();"}"!==(token=this.tn.next());){if("option"!==token)throw Error("illegal rpc service token: "+token);this._parseOption(method)}this.tn.omit(";")}else this.tn.skip(";");void 0===svc.rpc&&(svc.rpc={}),svc.rpc[name]=method},ParserPrototype._parseMessage=function(parent,fld){var isGroup=!!fld,token=this.tn.next(),msg={name:"",fields:[],enums:[],messages:[],options:{},services:[],oneofs:{}};if(!Lang.NAME.test(token))throw Error("illegal "+(isGroup?"group":"message")+" name: "+token);for(msg.name=token,isGroup&&(this.tn.skip("="),fld.id=mkId(this.tn.next()),msg.isGroup=!0),"["===(token=this.tn.peek())&&fld&&this._parseFieldOptions(fld),this.tn.skip("{");"}"!==(token=this.tn.next());)if(Lang.RULE.test(token))this._parseMessageField(msg,token);else if("oneof"===token)this._parseMessageOneOf(msg);else if("enum"===token)this._parseEnum(msg);else if("message"===token)this._parseMessage(msg);else if("option"===token)this._parseOption(msg);else if("service"===token)this._parseService(msg);else if("extensions"===token)msg.hasOwnProperty("extensions")?msg.extensions=msg.extensions.concat(this._parseExtensionRanges()):msg.extensions=this._parseExtensionRanges();else if("reserved"===token)this._parseIgnored();else if("extend"===token)this._parseExtend(msg);else{if(!Lang.TYPEREF.test(token))throw Error("illegal message token: "+token);if(!this.proto3)throw Error("illegal field rule: "+token);this._parseMessageField(msg,"optional",token)}return this.tn.omit(";"),parent.messages.push(msg),msg},ParserPrototype._parseIgnored=function(){for(;";"!==this.tn.peek();)this.tn.next();this.tn.skip(";")},ParserPrototype._parseMessageField=function(msg,rule,type){if(!Lang.RULE.test(rule))throw Error("illegal message field rule: "+rule);var token,fld={rule:rule,type:"",name:"",options:{},id:0};if("map"===rule){if(type)throw Error("illegal type: "+type);if(this.tn.skip("<"),token=this.tn.next(),!Lang.TYPE.test(token)&&!Lang.TYPEREF.test(token))throw Error("illegal message field type: "+token);if(fld.keytype=token,this.tn.skip(","),token=this.tn.next(),!Lang.TYPE.test(token)&&!Lang.TYPEREF.test(token))throw Error("illegal message field: "+token);if(fld.type=token,this.tn.skip(">"),token=this.tn.next(),!Lang.NAME.test(token))throw Error("illegal message field name: "+token);fld.name=token,this.tn.skip("="),fld.id=mkId(this.tn.next()),"["===(token=this.tn.peek())&&this._parseFieldOptions(fld),this.tn.skip(";")}else if("group"===(type=void 0!==type?type:this.tn.next())){var grp=this._parseMessage(msg,fld);if(!/^[A-Z]/.test(grp.name))throw Error("illegal group name: "+grp.name);fld.type=grp.name,fld.name=grp.name.toLowerCase(),this.tn.omit(";")}else{if(!Lang.TYPE.test(type)&&!Lang.TYPEREF.test(type))throw Error("illegal message field type: "+type);if(fld.type=type,token=this.tn.next(),!Lang.NAME.test(token))throw Error("illegal message field name: "+token);fld.name=token,this.tn.skip("="),fld.id=mkId(this.tn.next()),"["===(token=this.tn.peek())&&this._parseFieldOptions(fld),this.tn.skip(";")}return msg.fields.push(fld),fld},ParserPrototype._parseMessageOneOf=function(msg){var token=this.tn.next();if(!Lang.NAME.test(token))throw Error("illegal oneof name: "+token);var fld,name=token,fields=[];for(this.tn.skip("{");"}"!==(token=this.tn.next());)(fld=this._parseMessageField(msg,"optional",token)).oneof=name,fields.push(fld.id);this.tn.omit(";"),msg.oneofs[name]=fields},ParserPrototype._parseFieldOptions=function(fld){this.tn.skip("[");for(var first=!0;"]"!==this.tn.peek();)first||this.tn.skip(","),this._parseOption(fld,!0),first=!1;this.tn.next()},ParserPrototype._parseEnum=function(msg){var enm={name:"",values:[],options:{}},token=this.tn.next();if(!Lang.NAME.test(token))throw Error("illegal name: "+token);for(enm.name=token,this.tn.skip("{");"}"!==(token=this.tn.next());)if("option"===token)this._parseOption(enm);else{if(!Lang.NAME.test(token))throw Error("illegal name: "+token);this.tn.skip("=");var val={name:token,id:mkId(this.tn.next(),!0)};"["===(token=this.tn.peek())&&this._parseFieldOptions({options:{}}),this.tn.skip(";"),enm.values.push(val)}this.tn.omit(";"),msg.enums.push(enm)},ParserPrototype._parseExtensionRanges=function(){var token,range,value,ranges=[];do{for(range=[];;){switch(token=this.tn.next()){case"min":value=ProtoBuf.ID_MIN;break;case"max":value=ProtoBuf.ID_MAX;break;default:value=mkNumber(token)}if(range.push(value),2===range.length)break;if("to"!==this.tn.peek()){range.push(value);break}this.tn.next()}ranges.push(range)}while(this.tn.omit(","));return this.tn.skip(";"),ranges},ParserPrototype._parseExtend=function(parent){var token=this.tn.next();if(!Lang.TYPEREF.test(token))throw Error("illegal extend reference: "+token);var ext={ref:token,fields:[]};for(this.tn.skip("{");"}"!==(token=this.tn.next());)if(Lang.RULE.test(token))this._parseMessageField(ext,token);else{if(!Lang.TYPEREF.test(token))throw Error("illegal extend token: "+token);if(!this.proto3)throw Error("illegal field rule: "+token);this._parseMessageField(ext,"optional",token)}return this.tn.omit(";"),parent.messages.push(ext),ext},ParserPrototype.toString=function(){return"Parser at line "+this.tn.line},DotProto.Parser=Parser,DotProto}(ProtoBuf,ProtoBuf.Lang),ProtoBuf.Reflect=function(ProtoBuf){function mkLong(value,unsigned){if(value&&"number"==typeof value.low&&"number"==typeof value.high&&"boolean"==typeof value.unsigned&&value.low==value.low&&value.high==value.high)return new ProtoBuf.Long(value.low,value.high,void 0===unsigned?value.unsigned:unsigned);if("string"==typeof value)return ProtoBuf.Long.fromString(value,unsigned||!1,10);if("number"==typeof value)return ProtoBuf.Long.fromNumber(value,unsigned||!1);throw Error("not convertible to Long")}function skipTillGroupEnd(expectedId,buf){var tag=buf.readVarint32(),wireType=7&tag,id=tag>>>3;switch(wireType){case ProtoBuf.WIRE_TYPES.VARINT:do{tag=buf.readUint8()}while(128==(128&tag));break;case ProtoBuf.WIRE_TYPES.BITS64:buf.offset+=8;break;case ProtoBuf.WIRE_TYPES.LDELIM:tag=buf.readVarint32(),buf.offset+=tag;break;case ProtoBuf.WIRE_TYPES.STARTGROUP:skipTillGroupEnd(id,buf);break;case ProtoBuf.WIRE_TYPES.ENDGROUP:if(id===expectedId)return!1;throw Error("Illegal GROUPEND after unknown group: "+id+" ("+expectedId+" expected)");case ProtoBuf.WIRE_TYPES.BITS32:buf.offset+=4;break;default:throw Error("Illegal wire type in unknown group "+expectedId+": "+wireType)}return!0}var Reflect={},T=function(builder,parent,name){this.builder=builder,this.parent=parent,this.name=name,this.className},TPrototype=T.prototype;TPrototype.fqn=function(){for(var name=this.name,ptr=this;null!=(ptr=ptr.parent);)name=ptr.name+"."+name;return name},TPrototype.toString=function(includeClass){return(includeClass?this.className+" ":"")+this.fqn()},TPrototype.build=function(){throw Error(this.toString(!0)+" cannot be built directly")},Reflect.T=T;var Namespace=function(builder,parent,name,options,syntax){T.call(this,builder,parent,name),this.className="Namespace",this.children=[],this.options=options||{},this.syntax=syntax||"proto2"},NamespacePrototype=Namespace.prototype=Object.create(T.prototype);NamespacePrototype.getChildren=function(type){if(null==(type=type||null))return this.children.slice();for(var children=[],i=0,k=this.children.length;i<k;++i)this.children[i]instanceof type&&children.push(this.children[i]);return children},NamespacePrototype.addChild=function(child){var other;if(other=this.getChild(child.name))if(other instanceof Message.Field&&other.name!==other.originalName&&null===this.getChild(other.originalName))other.name=other.originalName;else{if(!(child instanceof Message.Field&&child.name!==child.originalName&&null===this.getChild(child.originalName)))throw Error("Duplicate name in namespace "+this.toString(!0)+": "+child.name);child.name=child.originalName}this.children.push(child)},NamespacePrototype.getChild=function(nameOrId){for(var key="number"==typeof nameOrId?"id":"name",i=0,k=this.children.length;i<k;++i)if(this.children[i][key]===nameOrId)return this.children[i];return null},NamespacePrototype.resolve=function(qn,excludeNonNamespace){var child,part="string"==typeof qn?qn.split("."):qn,ptr=this,i=0;if(""===part[i]){for(;null!==ptr.parent;)ptr=ptr.parent;i++}do{do{if(!(ptr instanceof Reflect.Namespace)){ptr=null;break}if(!(child=ptr.getChild(part[i]))||!(child instanceof Reflect.T)||excludeNonNamespace&&!(child instanceof Reflect.Namespace)){ptr=null;break}ptr=child,i++}while(i<part.length);if(null!=ptr)break;if(null!==this.parent)return this.parent.resolve(qn,excludeNonNamespace)}while(null!=ptr);return ptr},NamespacePrototype.qn=function(t){var part=[],ptr=t;do{part.unshift(ptr.name),ptr=ptr.parent}while(null!==ptr);for(var len=1;len<=part.length;len++){var qn=part.slice(part.length-len);if(t===this.resolve(qn,t instanceof Reflect.Namespace))return qn.join(".")}return t.fqn()},NamespacePrototype.build=function(){for(var child,ns={},children=this.children,i=0,k=children.length;i<k;++i)(child=children[i])instanceof Namespace&&(ns[child.name]=child.build());return Object.defineProperty&&Object.defineProperty(ns,"$options",{value:this.buildOpt()}),ns},NamespacePrototype.buildOpt=function(){for(var opt={},keys=Object.keys(this.options),i=0,k=keys.length;i<k;++i){var key=keys[i],val=this.options[keys[i]];opt[key]=val}return opt},NamespacePrototype.getOption=function(name){return void 0===name?this.options:void 0!==this.options[name]?this.options[name]:null},Reflect.Namespace=Namespace;var Element=function(type,resolvedType,isMapKey,syntax,name){if(this.type=type,this.resolvedType=resolvedType,this.isMapKey=isMapKey,this.syntax=syntax,this.name=name,isMapKey&&ProtoBuf.MAP_KEY_TYPES.indexOf(type)<0)throw Error("Invalid map key type: "+type.name)},ElementPrototype=Element.prototype;Element.defaultFieldValue=function(type){if("string"==typeof type&&(type=ProtoBuf.TYPES[type]),void 0===type.defaultValue)throw Error("default value for type "+type.name+" is not supported");return type==ProtoBuf.TYPES.bytes?new ByteBuffer(0):type.defaultValue},ElementPrototype.toString=function(){return(this.name||"")+(this.isMapKey?"map":"value")+" element"},ElementPrototype.verifyValue=function(value){function fail(val,msg){throw Error("Illegal value for "+self.toString(!0)+" of type "+self.type.name+": "+val+" ("+msg+")")}var self=this;switch(this.type){case ProtoBuf.TYPES.int32:case ProtoBuf.TYPES.sint32:case ProtoBuf.TYPES.sfixed32:return("number"!=typeof value||value==value&&value%1!=0)&&fail(typeof value,"not an integer"),value>4294967295?0|value:value;case ProtoBuf.TYPES.uint32:case ProtoBuf.TYPES.fixed32:return("number"!=typeof value||value==value&&value%1!=0)&&fail(typeof value,"not an integer"),value<0?value>>>0:value;case ProtoBuf.TYPES.int64:case ProtoBuf.TYPES.sint64:case ProtoBuf.TYPES.sfixed64:if(ProtoBuf.Long)try{return mkLong(value,!1)}catch(e){fail(typeof value,e.message)}else fail(typeof value,"requires Long.js");case ProtoBuf.TYPES.uint64:case ProtoBuf.TYPES.fixed64:if(ProtoBuf.Long)try{return mkLong(value,!0)}catch(e){fail(typeof value,e.message)}else fail(typeof value,"requires Long.js");case ProtoBuf.TYPES.bool:return"boolean"!=typeof value&&fail(typeof value,"not a boolean"),value;case ProtoBuf.TYPES.float:case ProtoBuf.TYPES.double:return"number"!=typeof value&&fail(typeof value,"not a number"),value;case ProtoBuf.TYPES.string:return"string"==typeof value||value&&value instanceof String||fail(typeof value,"not a string"),""+value;case ProtoBuf.TYPES.bytes:return ByteBuffer.isByteBuffer(value)?value:ByteBuffer.wrap(value,"base64");case ProtoBuf.TYPES.enum:var values=this.resolvedType.getChildren(ProtoBuf.Reflect.Enum.Value);for(i=0;i<values.length;i++){if(values[i].name==value)return values[i].id;if(values[i].id==value)return values[i].id}if("proto3"===this.syntax)return("number"!=typeof value||value==value&&value%1!=0)&&fail(typeof value,"not an integer"),(value>4294967295||value<0)&&fail(typeof value,"not in range for uint32"),value;fail(value,"not a valid enum value");case ProtoBuf.TYPES.group:case ProtoBuf.TYPES.message:if(value&&"object"==typeof value||fail(typeof value,"object expected"),value instanceof this.resolvedType.clazz)return value;if(value instanceof ProtoBuf.Builder.Message){var obj={};for(var i in value)value.hasOwnProperty(i)&&(obj[i]=value[i]);value=obj}return new this.resolvedType.clazz(value)}throw Error("[INTERNAL] Illegal value for "+this.toString(!0)+": "+value+" (undefined type "+this.type+")")},ElementPrototype.calculateLength=function(id,value){if(null===value)return 0;var n;switch(this.type){case ProtoBuf.TYPES.int32:return value<0?ByteBuffer.calculateVarint64(value):ByteBuffer.calculateVarint32(value);case ProtoBuf.TYPES.uint32:return ByteBuffer.calculateVarint32(value);case ProtoBuf.TYPES.sint32:return ByteBuffer.calculateVarint32(ByteBuffer.zigZagEncode32(value));case ProtoBuf.TYPES.fixed32:case ProtoBuf.TYPES.sfixed32:case ProtoBuf.TYPES.float:return 4;case ProtoBuf.TYPES.int64:case ProtoBuf.TYPES.uint64:return ByteBuffer.calculateVarint64(value);case ProtoBuf.TYPES.sint64:return ByteBuffer.calculateVarint64(ByteBuffer.zigZagEncode64(value));case ProtoBuf.TYPES.fixed64:case ProtoBuf.TYPES.sfixed64:return 8;case ProtoBuf.TYPES.bool:return 1;case ProtoBuf.TYPES.enum:return ByteBuffer.calculateVarint32(value);case ProtoBuf.TYPES.double:return 8;case ProtoBuf.TYPES.string:return n=ByteBuffer.calculateUTF8Bytes(value),ByteBuffer.calculateVarint32(n)+n;case ProtoBuf.TYPES.bytes:if(value.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+value.remaining()+" bytes remaining");return ByteBuffer.calculateVarint32(value.remaining())+value.remaining();case ProtoBuf.TYPES.message:return n=this.resolvedType.calculate(value),ByteBuffer.calculateVarint32(n)+n;case ProtoBuf.TYPES.group:return(n=this.resolvedType.calculate(value))+ByteBuffer.calculateVarint32(id<<3|ProtoBuf.WIRE_TYPES.ENDGROUP)}throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+value+" (unknown type)")},ElementPrototype.encodeValue=function(id,value,buffer){if(null===value)return buffer;switch(this.type){case ProtoBuf.TYPES.int32:value<0?buffer.writeVarint64(value):buffer.writeVarint32(value);break;case ProtoBuf.TYPES.uint32:buffer.writeVarint32(value);break;case ProtoBuf.TYPES.sint32:buffer.writeVarint32ZigZag(value);break;case ProtoBuf.TYPES.fixed32:buffer.writeUint32(value);break;case ProtoBuf.TYPES.sfixed32:buffer.writeInt32(value);break;case ProtoBuf.TYPES.int64:case ProtoBuf.TYPES.uint64:buffer.writeVarint64(value);break;case ProtoBuf.TYPES.sint64:buffer.writeVarint64ZigZag(value);break;case ProtoBuf.TYPES.fixed64:buffer.writeUint64(value);break;case ProtoBuf.TYPES.sfixed64:buffer.writeInt64(value);break;case ProtoBuf.TYPES.bool:"string"==typeof value?buffer.writeVarint32("false"===value.toLowerCase()?0:!!value):buffer.writeVarint32(value?1:0);break;case ProtoBuf.TYPES.enum:buffer.writeVarint32(value);break;case ProtoBuf.TYPES.float:buffer.writeFloat32(value);break;case ProtoBuf.TYPES.double:buffer.writeFloat64(value);break;case ProtoBuf.TYPES.string:buffer.writeVString(value);break;case ProtoBuf.TYPES.bytes:if(value.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+value.remaining()+" bytes remaining");var prevOffset=value.offset;buffer.writeVarint32(value.remaining()),buffer.append(value),value.offset=prevOffset;break;case ProtoBuf.TYPES.message:var bb=(new ByteBuffer).LE();this.resolvedType.encode(value,bb),buffer.writeVarint32(bb.offset),buffer.append(bb.flip());break;case ProtoBuf.TYPES.group:this.resolvedType.encode(value,buffer),buffer.writeVarint32(id<<3|ProtoBuf.WIRE_TYPES.ENDGROUP);break;default:throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+value+" (unknown type)")}return buffer},ElementPrototype.decode=function(buffer,wireType,id){if(wireType!=this.type.wireType)throw Error("Unexpected wire type for element");var value,nBytes;switch(this.type){case ProtoBuf.TYPES.int32:return 0|buffer.readVarint32();case ProtoBuf.TYPES.uint32:return buffer.readVarint32()>>>0;case ProtoBuf.TYPES.sint32:return 0|buffer.readVarint32ZigZag();case ProtoBuf.TYPES.fixed32:return buffer.readUint32()>>>0;case ProtoBuf.TYPES.sfixed32:return 0|buffer.readInt32();case ProtoBuf.TYPES.int64:return buffer.readVarint64();case ProtoBuf.TYPES.uint64:return buffer.readVarint64().toUnsigned();case ProtoBuf.TYPES.sint64:return buffer.readVarint64ZigZag();case ProtoBuf.TYPES.fixed64:return buffer.readUint64();case ProtoBuf.TYPES.sfixed64:return buffer.readInt64();case ProtoBuf.TYPES.bool:return!!buffer.readVarint32();case ProtoBuf.TYPES.enum:return buffer.readVarint32();case ProtoBuf.TYPES.float:return buffer.readFloat();case ProtoBuf.TYPES.double:return buffer.readDouble();case ProtoBuf.TYPES.string:return buffer.readVString();case ProtoBuf.TYPES.bytes:if(nBytes=buffer.readVarint32(),buffer.remaining()<nBytes)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+nBytes+" required but got only "+buffer.remaining());return(value=buffer.clone()).limit=value.offset+nBytes,buffer.offset+=nBytes,value;case ProtoBuf.TYPES.message:return nBytes=buffer.readVarint32(),this.resolvedType.decode(buffer,nBytes);case ProtoBuf.TYPES.group:return this.resolvedType.decode(buffer,-1,id)}throw Error("[INTERNAL] Illegal decode type")},ElementPrototype.valueFromString=function(str){if(!this.isMapKey)throw Error("valueFromString() called on non-map-key element");switch(this.type){case ProtoBuf.TYPES.int32:case ProtoBuf.TYPES.sint32:case ProtoBuf.TYPES.sfixed32:case ProtoBuf.TYPES.uint32:case ProtoBuf.TYPES.fixed32:return this.verifyValue(parseInt(str));case ProtoBuf.TYPES.int64:case ProtoBuf.TYPES.sint64:case ProtoBuf.TYPES.sfixed64:case ProtoBuf.TYPES.uint64:case ProtoBuf.TYPES.fixed64:return this.verifyValue(str);case ProtoBuf.TYPES.bool:return"true"===str;case ProtoBuf.TYPES.string:return this.verifyValue(str);case ProtoBuf.TYPES.bytes:return ByteBuffer.fromBinary(str)}},ElementPrototype.valueToString=function(value){if(!this.isMapKey)throw Error("valueToString() called on non-map-key element");return this.type===ProtoBuf.TYPES.bytes?value.toString("binary"):value.toString()},Reflect.Element=Element;var Message=function(builder,parent,name,options,isGroup,syntax){Namespace.call(this,builder,parent,name,options,syntax),this.className="Message",this.extensions=void 0,this.clazz=null,this.isGroup=!!isGroup,this._fields=null,this._fieldsById=null,this._fieldsByName=null},MessagePrototype=Message.prototype=Object.create(Namespace.prototype);MessagePrototype.build=function(rebuild){if(this.clazz&&!rebuild)return this.clazz;var clazz=function(ProtoBuf,T){function cloneRaw(obj,binaryAsBase64,longsAsStrings,resolvedType){if(null===obj||"object"!=typeof obj){if(resolvedType&&resolvedType instanceof ProtoBuf.Reflect.Enum){var name=ProtoBuf.Reflect.Enum.getName(resolvedType.object,obj);if(null!==name)return name}return obj}if(ByteBuffer.isByteBuffer(obj))return binaryAsBase64?obj.toBase64():obj.toBuffer();if(ProtoBuf.Long.isLong(obj))return longsAsStrings?obj.toString():ProtoBuf.Long.fromValue(obj);var clone;if(Array.isArray(obj))return clone=[],obj.forEach(function(v,k){clone[k]=cloneRaw(v,binaryAsBase64,longsAsStrings,resolvedType)}),clone;if(clone={},obj instanceof ProtoBuf.Map){for(var it=obj.entries(),e=it.next();!e.done;e=it.next())clone[obj.keyElem.valueToString(e.value[0])]=cloneRaw(e.value[1],binaryAsBase64,longsAsStrings,obj.valueElem.resolvedType);return clone}var type=obj.$type,field=void 0;for(var i in obj)obj.hasOwnProperty(i)&&(type&&(field=type.getChild(i))?clone[i]=cloneRaw(obj[i],binaryAsBase64,longsAsStrings,field.resolvedType):clone[i]=cloneRaw(obj[i],binaryAsBase64,longsAsStrings));return clone}var fields=T.getChildren(ProtoBuf.Reflect.Message.Field),oneofs=T.getChildren(ProtoBuf.Reflect.Message.OneOf),Message=function(values,var_args){ProtoBuf.Builder.Message.call(this);for(var i=0,k=oneofs.length;i<k;++i)this[oneofs[i].name]=null;for(i=0,k=fields.length;i<k;++i){var field=fields[i];this[field.name]=field.repeated?[]:field.map?new ProtoBuf.Map(field):null,!field.required&&"proto3"!==T.syntax||null===field.defaultValue||(this[field.name]=field.defaultValue)}var value;if(arguments.length>0)if(1!==arguments.length||null===values||"object"!=typeof values||!("function"!=typeof values.encode||values instanceof Message)||Array.isArray(values)||values instanceof ProtoBuf.Map||ByteBuffer.isByteBuffer(values)||values instanceof ArrayBuffer||ProtoBuf.Long&&values instanceof ProtoBuf.Long)for(i=0,k=arguments.length;i<k;++i)void 0!==(value=arguments[i])&&this.$set(fields[i].name,value);else this.$set(values)},MessagePrototype=Message.prototype=Object.create(ProtoBuf.Builder.Message.prototype);MessagePrototype.add=function(key,value,noAssert){var field=T._fieldsByName[key];if(!noAssert){if(!field)throw Error(this+"#"+key+" is undefined");if(!(field instanceof ProtoBuf.Reflect.Message.Field))throw Error(this+"#"+key+" is not a field: "+field.toString(!0));if(!field.repeated)throw Error(this+"#"+key+" is not a repeated field");value=field.verifyValue(value,!0)}return null===this[key]&&(this[key]=[]),this[key].push(value),this},MessagePrototype.$add=MessagePrototype.add,MessagePrototype.set=function(keyOrObj,value,noAssert){if(keyOrObj&&"object"==typeof keyOrObj){for(var ikey in noAssert=value,keyOrObj)keyOrObj.hasOwnProperty(ikey)&&void 0!==(value=keyOrObj[ikey])&&void 0===T._oneofsByName[ikey]&&this.$set(ikey,value,noAssert);return this}var field=T._fieldsByName[keyOrObj];if(noAssert)this[keyOrObj]=value;else{if(!field)throw Error(this+"#"+keyOrObj+" is not a field: undefined");if(!(field instanceof ProtoBuf.Reflect.Message.Field))throw Error(this+"#"+keyOrObj+" is not a field: "+field.toString(!0));this[field.name]=value=field.verifyValue(value)}if(field&&field.oneof){var currentField=this[field.oneof.name];null!==value?(null!==currentField&&currentField!==field.name&&(this[currentField]=null),this[field.oneof.name]=field.name):currentField===keyOrObj&&(this[field.oneof.name]=null)}return this},MessagePrototype.$set=MessagePrototype.set,MessagePrototype.get=function(key,noAssert){if(noAssert)return this[key];var field=T._fieldsByName[key];if(!(field&&field instanceof ProtoBuf.Reflect.Message.Field))throw Error(this+"#"+key+" is not a field: undefined");if(!(field instanceof ProtoBuf.Reflect.Message.Field))throw Error(this+"#"+key+" is not a field: "+field.toString(!0));return this[field.name]},MessagePrototype.$get=MessagePrototype.get;for(var i=0;i<fields.length;i++){var field=fields[i];field instanceof ProtoBuf.Reflect.Message.ExtensionField||T.builder.options.populateAccessors&&function(field){var Name=field.originalName.replace(/(_[a-zA-Z])/g,function(match){return match.toUpperCase().replace("_","")});Name=Name.substring(0,1).toUpperCase()+Name.substring(1);var name=field.originalName.replace(/([A-Z])/g,function(match){return"_"+match}),setter=function(value,noAssert){return this[field.name]=noAssert?value:field.verifyValue(value),this},getter=function(){return this[field.name]};null===T.getChild("set"+Name)&&(MessagePrototype["set"+Name]=setter),null===T.getChild("set_"+name)&&(MessagePrototype["set_"+name]=setter),null===T.getChild("get"+Name)&&(MessagePrototype["get"+Name]=getter),null===T.getChild("get_"+name)&&(MessagePrototype["get_"+name]=getter)}(field)}return MessagePrototype.encode=function(buffer,noVerify){"boolean"==typeof buffer&&(noVerify=buffer,buffer=void 0);var isNew=!1;buffer||(buffer=new ByteBuffer,isNew=!0);var le=buffer.littleEndian;try{return T.encode(this,buffer.LE(),noVerify),(isNew?buffer.flip():buffer).LE(le)}catch(e){throw buffer.LE(le),e}},Message.encode=function(data,buffer,noVerify){return new Message(data).encode(buffer,noVerify)},MessagePrototype.calculate=function(){return T.calculate(this)},MessagePrototype.encodeDelimited=function(buffer,noVerify){var isNew=!1;buffer||(buffer=new ByteBuffer,isNew=!0);var enc=(new ByteBuffer).LE();return T.encode(this,enc,noVerify).flip(),buffer.writeVarint32(enc.remaining()),buffer.append(enc),isNew?buffer.flip():buffer},MessagePrototype.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toArrayBuffer()),e}},MessagePrototype.toArrayBuffer=MessagePrototype.encodeAB,MessagePrototype.encodeNB=function(){try{return this.encode().toBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBuffer()),e}},MessagePrototype.toBuffer=MessagePrototype.encodeNB,MessagePrototype.encode64=function(){try{return this.encode().toBase64()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBase64()),e}},MessagePrototype.toBase64=MessagePrototype.encode64,MessagePrototype.encodeHex=function(){try{return this.encode().toHex()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toHex()),e}},MessagePrototype.toHex=MessagePrototype.encodeHex,MessagePrototype.toRaw=function(binaryAsBase64,longsAsStrings){return cloneRaw(this,!!binaryAsBase64,!!longsAsStrings,this.$type)},MessagePrototype.encodeJSON=function(){return JSON.stringify(cloneRaw(this,!0,!0,this.$type))},Message.decode=function(buffer,length,enc){"string"==typeof length&&(enc=length,length=-1),"string"==typeof buffer?buffer=ByteBuffer.wrap(buffer,enc||"base64"):ByteBuffer.isByteBuffer(buffer)||(buffer=ByteBuffer.wrap(buffer));var le=buffer.littleEndian;try{var msg=T.decode(buffer.LE(),length);return buffer.LE(le),msg}catch(e){throw buffer.LE(le),e}},Message.decodeDelimited=function(buffer,enc){if("string"==typeof buffer?buffer=ByteBuffer.wrap(buffer,enc||"base64"):ByteBuffer.isByteBuffer(buffer)||(buffer=ByteBuffer.wrap(buffer)),buffer.remaining()<1)return null;var off=buffer.offset,len=buffer.readVarint32();if(buffer.remaining()<len)return buffer.offset=off,null;try{var msg=T.decode(buffer.slice(buffer.offset,buffer.offset+len).LE());return buffer.offset+=len,msg}catch(err){throw buffer.offset+=len,err}},Message.decode64=function(str){return Message.decode(str,"base64")},Message.decodeHex=function(str){return Message.decode(str,"hex")},Message.decodeJSON=function(str){return new Message(JSON.parse(str))},MessagePrototype.toString=function(){return T.toString()},Object.defineProperty&&(Object.defineProperty(Message,"$options",{value:T.buildOpt()}),Object.defineProperty(MessagePrototype,"$options",{value:Message.$options}),Object.defineProperty(Message,"$type",{value:T}),Object.defineProperty(MessagePrototype,"$type",{value:T})),Message}(ProtoBuf,this);this._fields=[],this._fieldsById={},this._fieldsByName={},this._oneofsByName={};for(var child,i=0,k=this.children.length;i<k;i++)if((child=this.children[i])instanceof Enum||child instanceof Message||child instanceof Service){if(clazz.hasOwnProperty(child.name))throw Error("Illegal reflect child of "+this.toString(!0)+": "+child.toString(!0)+" cannot override static property '"+child.name+"'");clazz[child.name]=child.build()}else if(child instanceof Message.Field)child.build(),this._fields.push(child),this._fieldsById[child.id]=child,this._fieldsByName[child.name]=child;else if(child instanceof Message.OneOf)this._oneofsByName[child.name]=child;else if(!(child instanceof Message.OneOf||child instanceof Extension))throw Error("Illegal reflect child of "+this.toString(!0)+": "+this.children[i].toString(!0));return this.clazz=clazz},MessagePrototype.encode=function(message,buffer,noVerify){for(var field,val,fieldMissing=null,i=0,k=this._fields.length;i<k;++i)val=message[(field=this._fields[i]).name],field.required&&null===val?null===fieldMissing&&(fieldMissing=field):field.encode(noVerify?val:field.verifyValue(val),buffer,message);if(null!==fieldMissing){var err=Error("Missing at least one required field for "+this.toString(!0)+": "+fieldMissing);throw err.encoded=buffer,err}return buffer},MessagePrototype.calculate=function(message){for(var field,val,n=0,i=0,k=this._fields.length;i<k;++i){if(val=message[(field=this._fields[i]).name],field.required&&null===val)throw Error("Missing at least one required field for "+this.toString(!0)+": "+field);n+=field.calculate(val,message)}return n},MessagePrototype.decode=function(buffer,length,expectedGroupEndId){"number"!=typeof length&&(length=-1);for(var tag,wireType,id,field,start=buffer.offset,msg=new this.clazz;buffer.offset<start+length||-1===length&&buffer.remaining()>0;){if(id=(tag=buffer.readVarint32())>>>3,(wireType=7&tag)===ProtoBuf.WIRE_TYPES.ENDGROUP){if(id!==expectedGroupEndId)throw Error("Illegal group end indicator for "+this.toString(!0)+": "+id+" ("+(expectedGroupEndId?expectedGroupEndId+" expected":"not a group")+")");break}if(field=this._fieldsById[id]){if(field.repeated&&!field.options.packed)msg[field.name].push(field.decode(wireType,buffer));else if(field.map){var keyval=field.decode(wireType,buffer);msg[field.name].set(keyval[0],keyval[1])}else if(msg[field.name]=field.decode(wireType,buffer),field.oneof){var currentField=msg[field.oneof.name];null!==currentField&&currentField!==field.name&&(msg[currentField]=null),msg[field.oneof.name]=field.name}}else switch(wireType){case ProtoBuf.WIRE_TYPES.VARINT:buffer.readVarint32();break;case ProtoBuf.WIRE_TYPES.BITS32:buffer.offset+=4;break;case ProtoBuf.WIRE_TYPES.BITS64:buffer.offset+=8;break;case ProtoBuf.WIRE_TYPES.LDELIM:var len=buffer.readVarint32();buffer.offset+=len;break;case ProtoBuf.WIRE_TYPES.STARTGROUP:for(;skipTillGroupEnd(id,buffer););break;default:throw Error("Illegal wire type for unknown field "+id+" in "+this.toString(!0)+"#decode: "+wireType)}}for(var i=0,k=this._fields.length;i<k;++i)if(null===msg[(field=this._fields[i]).name])if("proto3"===this.syntax)msg[field.name]=field.defaultValue;else{if(field.required){var err=Error("Missing at least one required field for "+this.toString(!0)+": "+field.name);throw err.decoded=msg,err}ProtoBuf.populateDefaults&&null!==field.defaultValue&&(msg[field.name]=field.defaultValue)}return msg},Reflect.Message=Message;var Field=function(builder,message,rule,keytype,type,name,id,options,oneof,syntax){T.call(this,builder,message,name),this.className="Message.Field",this.required="required"===rule,this.repeated="repeated"===rule,this.map="map"===rule,this.keyType=keytype||null,this.type=type,this.resolvedType=null,this.id=id,this.options=options||{},this.defaultValue=null,this.oneof=oneof||null,this.syntax=syntax||"proto2",this.originalName=this.name,this.element=null,this.keyElement=null,!this.builder.options.convertFieldsToCamelCase||this instanceof Message.ExtensionField||(this.name=ProtoBuf.Util.toCamelCase(this.name))},FieldPrototype=Field.prototype=Object.create(T.prototype);FieldPrototype.build=function(){this.element=new Element(this.type,this.resolvedType,!1,this.syntax,this.name),this.map&&(this.keyElement=new Element(this.keyType,void 0,!0,this.syntax,this.name)),"proto3"!==this.syntax||this.repeated||this.map?void 0!==this.options.default&&(this.defaultValue=this.verifyValue(this.options.default)):this.defaultValue=Element.defaultFieldValue(this.type)},FieldPrototype.verifyValue=function(value,skipRepeated){function fail(val,msg){throw Error("Illegal value for "+self.toString(!0)+" of type "+self.type.name+": "+val+" ("+msg+")")}skipRepeated=skipRepeated||!1;var i,self=this;if(null===value)return this.required&&fail(typeof value,"required"),"proto3"===this.syntax&&this.type!==ProtoBuf.TYPES.message&&fail(typeof value,"proto3 field without field presence cannot be null"),null;if(this.repeated&&!skipRepeated){Array.isArray(value)||(value=[value]);var res=[];for(i=0;i<value.length;i++)res.push(this.element.verifyValue(value[i]));return res}return this.map&&!skipRepeated?value instanceof ProtoBuf.Map?value:(value instanceof Object||fail(typeof value,"expected ProtoBuf.Map or raw object for map field"),new ProtoBuf.Map(this,value)):(!this.repeated&&Array.isArray(value)&&fail(typeof value,"no array expected"),this.element.verifyValue(value))},FieldPrototype.hasWirePresence=function(value,message){if("proto3"!==this.syntax)return null!==value;if(this.oneof&&message[this.oneof.name]===this.name)return!0;switch(this.type){case ProtoBuf.TYPES.int32:case ProtoBuf.TYPES.sint32:case ProtoBuf.TYPES.sfixed32:case ProtoBuf.TYPES.uint32:case ProtoBuf.TYPES.fixed32:return 0!==value;case ProtoBuf.TYPES.int64:case ProtoBuf.TYPES.sint64:case ProtoBuf.TYPES.sfixed64:case ProtoBuf.TYPES.uint64:case ProtoBuf.TYPES.fixed64:return 0!==value.low||0!==value.high;case ProtoBuf.TYPES.bool:return value;case ProtoBuf.TYPES.float:case ProtoBuf.TYPES.double:return 0!==value;case ProtoBuf.TYPES.string:return value.length>0;case ProtoBuf.TYPES.bytes:return value.remaining()>0;case ProtoBuf.TYPES.enum:return 0!==value;case ProtoBuf.TYPES.message:return null!==value;default:return!0}},FieldPrototype.encode=function(value,buffer,message){if(null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===value||this.repeated&&0==value.length)return buffer;try{var i;if(this.repeated)if(this.options.packed&&ProtoBuf.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){buffer.writeVarint32(this.id<<3|ProtoBuf.WIRE_TYPES.LDELIM),buffer.ensureCapacity(buffer.offset+=1);var start=buffer.offset;for(i=0;i<value.length;i++)this.element.encodeValue(this.id,value[i],buffer);var len=buffer.offset-start,varintLen=ByteBuffer.calculateVarint32(len);if(varintLen>1){var contents=buffer.slice(start,buffer.offset);start+=varintLen-1,buffer.offset=start,buffer.append(contents)}buffer.writeVarint32(len,start-varintLen)}else for(i=0;i<value.length;i++)buffer.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,value[i],buffer);else this.map?value.forEach(function(val,key,m){var length=ByteBuffer.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,key)+ByteBuffer.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,val);buffer.writeVarint32(this.id<<3|ProtoBuf.WIRE_TYPES.LDELIM),buffer.writeVarint32(length),buffer.writeVarint32(8|this.keyType.wireType),this.keyElement.encodeValue(1,key,buffer),buffer.writeVarint32(16|this.type.wireType),this.element.encodeValue(2,val,buffer)},this):this.hasWirePresence(value,message)&&(buffer.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,value,buffer))}catch(e){throw Error("Illegal value for "+this.toString(!0)+": "+value+" ("+e+")")}return buffer},FieldPrototype.calculate=function(value,message){if(value=this.verifyValue(value),null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===value||this.repeated&&0==value.length)return 0;var n=0;try{var i,ni;if(this.repeated)if(this.options.packed&&ProtoBuf.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){for(n+=ByteBuffer.calculateVarint32(this.id<<3|ProtoBuf.WIRE_TYPES.LDELIM),ni=0,i=0;i<value.length;i++)ni+=this.element.calculateLength(this.id,value[i]);n+=ByteBuffer.calculateVarint32(ni),n+=ni}else for(i=0;i<value.length;i++)n+=ByteBuffer.calculateVarint32(this.id<<3|this.type.wireType),n+=this.element.calculateLength(this.id,value[i]);else this.map?value.forEach(function(val,key,m){var length=ByteBuffer.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,key)+ByteBuffer.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,val);n+=ByteBuffer.calculateVarint32(this.id<<3|ProtoBuf.WIRE_TYPES.LDELIM),n+=ByteBuffer.calculateVarint32(length),n+=length},this):this.hasWirePresence(value,message)&&(n+=ByteBuffer.calculateVarint32(this.id<<3|this.type.wireType),n+=this.element.calculateLength(this.id,value))}catch(e){throw Error("Illegal value for "+this.toString(!0)+": "+value+" ("+e+")")}return n},FieldPrototype.decode=function(wireType,buffer,skipRepeated){var value,nBytes;if(!(!this.map&&wireType==this.type.wireType||!skipRepeated&&this.repeated&&this.options.packed&&wireType==ProtoBuf.WIRE_TYPES.LDELIM||this.map&&wireType==ProtoBuf.WIRE_TYPES.LDELIM))throw Error("Illegal wire type for field "+this.toString(!0)+": "+wireType+" ("+this.type.wireType+" expected)");if(wireType==ProtoBuf.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&ProtoBuf.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0&&!skipRepeated){nBytes=buffer.readVarint32(),nBytes=buffer.offset+nBytes;for(var values=[];buffer.offset<nBytes;)values.push(this.decode(this.type.wireType,buffer,!0));return values}if(this.map){var key=Element.defaultFieldValue(this.keyType);if(value=Element.defaultFieldValue(this.type),nBytes=buffer.readVarint32(),buffer.remaining()<nBytes)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+nBytes+" required but got only "+buffer.remaining());var msgbuf=buffer.clone();for(msgbuf.limit=msgbuf.offset+nBytes,buffer.offset+=nBytes;msgbuf.remaining()>0;){var tag=msgbuf.readVarint32();wireType=7&tag;var id=tag>>>3;if(1===id)key=this.keyElement.decode(msgbuf,wireType,id);else{if(2!==id)throw Error("Unexpected tag in map field key/value submessage");value=this.element.decode(msgbuf,wireType,id)}}return[key,value]}return this.element.decode(buffer,wireType,this.id)},Reflect.Message.Field=Field;var ExtensionField=function(builder,message,rule,type,name,id,options){Field.call(this,builder,message,rule,null,type,name,id,options),this.extension};ExtensionField.prototype=Object.create(Field.prototype),Reflect.Message.ExtensionField=ExtensionField;Reflect.Message.OneOf=function(builder,message,name){T.call(this,builder,message,name),this.fields=[]};var Enum=function(builder,parent,name,options,syntax){Namespace.call(this,builder,parent,name,options,syntax),this.className="Enum",this.object=null};Enum.getName=function(enm,value){for(var key,keys=Object.keys(enm),i=0;i<keys.length;++i)if(enm[key=keys[i]]===value)return key;return null},(Enum.prototype=Object.create(Namespace.prototype)).build=function(rebuild){if(this.object&&!rebuild)return this.object;for(var enm=new ProtoBuf.Builder.Enum,values=this.getChildren(Enum.Value),i=0,k=values.length;i<k;++i)enm[values[i].name]=values[i].id;return Object.defineProperty&&Object.defineProperty(enm,"$options",{value:this.buildOpt(),enumerable:!1}),this.object=enm},Reflect.Enum=Enum;var Value=function(builder,enm,name,id){T.call(this,builder,enm,name),this.className="Enum.Value",this.id=id};Value.prototype=Object.create(T.prototype),Reflect.Enum.Value=Value;var Extension=function(builder,parent,name,field){T.call(this,builder,parent,name),this.field=field};Extension.prototype=Object.create(T.prototype),Reflect.Extension=Extension;var Service=function(builder,root,name,options){Namespace.call(this,builder,root,name,options),this.className="Service",this.clazz=null};(Service.prototype=Object.create(Namespace.prototype)).build=function(rebuild){return this.clazz&&!rebuild?this.clazz:this.clazz=function(ProtoBuf,T){for(var Service=function(rpcImpl){ProtoBuf.Builder.Service.call(this),this.rpcImpl=rpcImpl||function(name,msg,callback){setTimeout(callback.bind(this,Error("Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services")),0)}},ServicePrototype=Service.prototype=Object.create(ProtoBuf.Builder.Service.prototype),rpc=T.getChildren(ProtoBuf.Reflect.Service.RPCMethod),i=0;i<rpc.length;i++)!function(method){ServicePrototype[method.name]=function(req,callback){try{try{req=method.resolvedRequestType.clazz.decode(ByteBuffer.wrap(req))}catch(err){if(!(err instanceof TypeError))throw err}if(null===req||"object"!=typeof req)throw Error("Illegal arguments");req instanceof method.resolvedRequestType.clazz||(req=new method.resolvedRequestType.clazz(req)),this.rpcImpl(method.fqn(),req,function(err,res){if(err)callback(err);else{null===res&&(res="");try{res=method.resolvedResponseType.clazz.decode(res)}catch(notABuffer){}res&&res instanceof method.resolvedResponseType.clazz?callback(null,res):callback(Error("Illegal response type received in service method "+T.name+"#"+method.name))}})}catch(err){setTimeout(callback.bind(this,err),0)}},Service[method.name]=function(rpcImpl,req,callback){new Service(rpcImpl)[method.name](req,callback)},Object.defineProperty&&(Object.defineProperty(Service[method.name],"$options",{value:method.buildOpt()}),Object.defineProperty(ServicePrototype[method.name],"$options",{value:Service[method.name].$options}))}(rpc[i]);return Object.defineProperty&&(Object.defineProperty(Service,"$options",{value:T.buildOpt()}),Object.defineProperty(ServicePrototype,"$options",{value:Service.$options}),Object.defineProperty(Service,"$type",{value:T}),Object.defineProperty(ServicePrototype,"$type",{value:T})),Service}(ProtoBuf,this)},Reflect.Service=Service;var Method=function(builder,svc,name,options){T.call(this,builder,svc,name),this.className="Service.Method",this.options=options||{}};(Method.prototype=Object.create(T.prototype)).buildOpt=NamespacePrototype.buildOpt,Reflect.Service.Method=Method;var RPCMethod=function(builder,svc,name,request,response,request_stream,response_stream,options){Method.call(this,builder,svc,name,options),this.className="Service.RPCMethod",this.requestName=request,this.responseName=response,this.requestStream=request_stream,this.responseStream=response_stream,this.resolvedRequestType=null,this.resolvedResponseType=null};return RPCMethod.prototype=Object.create(Method.prototype),Reflect.Service.RPCMethod=RPCMethod,Reflect}(ProtoBuf),ProtoBuf.Builder=function(ProtoBuf,Lang,Reflect){var Builder=function(options){this.ns=new Reflect.Namespace(this,null,""),this.ptr=this.ns,this.resolved=!1,this.result=null,this.files={},this.importRoot=null,this.options=options||{}},BuilderPrototype=Builder.prototype;return Builder.isMessage=function(def){return"string"==typeof def.name&&void 0===def.values&&void 0===def.rpc},Builder.isMessageField=function(def){return"string"==typeof def.rule&&"string"==typeof def.name&&"string"==typeof def.type&&void 0!==def.id},Builder.isEnum=function(def){return"string"==typeof def.name&&!(void 0===def.values||!Array.isArray(def.values)||0===def.values.length)},Builder.isService=function(def){return!("string"!=typeof def.name||"object"!=typeof def.rpc||!def.rpc)},Builder.isExtend=function(def){return"string"==typeof def.ref},BuilderPrototype.reset=function(){return this.ptr=this.ns,this},BuilderPrototype.define=function(namespace){if("string"!=typeof namespace||!Lang.TYPEREF.test(namespace))throw Error("illegal namespace: "+namespace);return namespace.split(".").forEach(function(part){var ns=this.ptr.getChild(part);null===ns&&this.ptr.addChild(ns=new Reflect.Namespace(this,this.ptr,part)),this.ptr=ns},this),this},BuilderPrototype.create=function(defs){if(!defs)return this;if(Array.isArray(defs)){if(0===defs.length)return this;defs=defs.slice()}else defs=[defs];for(var stack=[defs];stack.length>0;){if(defs=stack.pop(),!Array.isArray(defs))throw Error("not a valid namespace: "+JSON.stringify(defs));for(;defs.length>0;){var def=defs.shift();if(Builder.isMessage(def)){var obj=new Reflect.Message(this,this.ptr,def.name,def.options,def.isGroup,def.syntax),oneofs={};def.oneofs&&Object.keys(def.oneofs).forEach(function(name){obj.addChild(oneofs[name]=new Reflect.Message.OneOf(this,obj,name))},this),def.fields&&def.fields.forEach(function(fld){if(null!==obj.getChild(0|fld.id))throw Error("duplicate or invalid field id in "+obj.name+": "+fld.id);if(fld.options&&"object"!=typeof fld.options)throw Error("illegal field options in "+obj.name+"#"+fld.name);var oneof=null;if("string"==typeof fld.oneof&&!(oneof=oneofs[fld.oneof]))throw Error("illegal oneof in "+obj.name+"#"+fld.name+": "+fld.oneof);fld=new Reflect.Message.Field(this,obj,fld.rule,fld.keytype,fld.type,fld.name,fld.id,fld.options,oneof,def.syntax),oneof&&oneof.fields.push(fld),obj.addChild(fld)},this);var subObj=[];if(def.enums&&def.enums.forEach(function(enm){subObj.push(enm)}),def.messages&&def.messages.forEach(function(msg){subObj.push(msg)}),def.services&&def.services.forEach(function(svc){subObj.push(svc)}),def.extensions&&("number"==typeof def.extensions[0]?obj.extensions=[def.extensions]:obj.extensions=def.extensions),this.ptr.addChild(obj),subObj.length>0){stack.push(defs),defs=subObj,subObj=null,this.ptr=obj,obj=null;continue}subObj=null}else if(Builder.isEnum(def))obj=new Reflect.Enum(this,this.ptr,def.name,def.options,def.syntax),def.values.forEach(function(val){obj.addChild(new Reflect.Enum.Value(this,obj,val.name,val.id))},this),this.ptr.addChild(obj);else if(Builder.isService(def))obj=new Reflect.Service(this,this.ptr,def.name,def.options),Object.keys(def.rpc).forEach(function(name){var mtd=def.rpc[name];obj.addChild(new Reflect.Service.RPCMethod(this,obj,name,mtd.request,mtd.response,!!mtd.request_stream,!!mtd.response_stream,mtd.options))},this),this.ptr.addChild(obj);else{if(!Builder.isExtend(def))throw Error("not a valid definition: "+JSON.stringify(def));if(obj=this.ptr.resolve(def.ref,!0))def.fields.forEach(function(fld){if(null!==obj.getChild(0|fld.id))throw Error("duplicate extended field id in "+obj.name+": "+fld.id);if(obj.extensions){var valid=!1;if(obj.extensions.forEach(function(range){fld.id>=range[0]&&fld.id<=range[1]&&(valid=!0)}),!valid)throw Error("illegal extended field id in "+obj.name+": "+fld.id+" (not within valid ranges)")}var name=fld.name;this.options.convertFieldsToCamelCase&&(name=ProtoBuf.Util.toCamelCase(name));var field=new Reflect.Message.ExtensionField(this,obj,fld.rule,fld.type,this.ptr.fqn()+"."+name,fld.id,fld.options),ext=new Reflect.Extension(this,this.ptr,fld.name,field);field.extension=ext,this.ptr.addChild(ext),obj.addChild(field)},this);else if(!/\.?google\.protobuf\./.test(def.ref))throw Error("extended message "+def.ref+" is not defined")}def=null,obj=null}defs=null,this.ptr=this.ptr.parent}return this.resolved=!1,this.result=null,this},BuilderPrototype.import=function(json,filename){var delim="/";if("string"==typeof filename){if(ProtoBuf.Util.IS_NODE&&(filename=_dereq_("path").resolve(filename)),!0===this.files[filename])return this.reset();this.files[filename]=!0}else if("object"==typeof filename){var fname,root=filename.root;if(ProtoBuf.Util.IS_NODE&&(root=_dereq_("path").resolve(root)),(root.indexOf("\\")>=0||filename.file.indexOf("\\")>=0)&&(delim="\\"),fname=ProtoBuf.Util.IS_NODE?_dereq_("path").join(root,filename.file):root+delim+filename.file,!0===this.files[fname])return this.reset();this.files[fname]=!0}if(json.imports&&json.imports.length>0){var importRoot,resetRoot=!1;"object"==typeof filename?(this.importRoot=filename.root,resetRoot=!0,importRoot=this.importRoot,filename=filename.file,(importRoot.indexOf("\\")>=0||filename.indexOf("\\")>=0)&&(delim="\\")):"string"==typeof filename?this.importRoot?importRoot=this.importRoot:filename.indexOf("/")>=0?""===(importRoot=filename.replace(/\/[^\/]*$/,""))&&(importRoot="/"):filename.indexOf("\\")>=0?(importRoot=filename.replace(/\\[^\\]*$/,""),delim="\\"):importRoot=".":importRoot=null;for(var i=0;i<json.imports.length;i++)if("string"==typeof json.imports[i]){if(!importRoot)throw Error("cannot determine import root");var importFilename=json.imports[i];if("google/protobuf/descriptor.proto"===importFilename)continue;if(importFilename=ProtoBuf.Util.IS_NODE?_dereq_("path").join(importRoot,importFilename):importRoot+delim+importFilename,!0===this.files[importFilename])continue;/\.proto$/i.test(importFilename)&&!ProtoBuf.DotProto&&(importFilename=importFilename.replace(/\.proto$/,".json"));var contents=ProtoBuf.Util.fetch(importFilename);if(null===contents)throw Error("failed to import '"+importFilename+"' in '"+filename+"': file not found");/\.json$/i.test(importFilename)?this.import(JSON.parse(contents+""),importFilename):this.import(ProtoBuf.DotProto.Parser.parse(contents),importFilename)}else filename?/\.(\w+)$/.test(filename)?this.import(json.imports[i],filename.replace(/^(.+)\.(\w+)$/,function($0,$1,$2){return $1+"_import"+i+"."+$2})):this.import(json.imports[i],filename+"_import"+i):this.import(json.imports[i]);resetRoot&&(this.importRoot=null)}json.package&&this.define(json.package),json.syntax&&function propagateSyntax(parent){parent.messages&&parent.messages.forEach(function(child){child.syntax=parent.syntax,propagateSyntax(child)}),parent.enums&&parent.enums.forEach(function(child){child.syntax=parent.syntax})}(json);var base=this.ptr;return json.options&&Object.keys(json.options).forEach(function(key){base.options[key]=json.options[key]}),json.messages&&(this.create(json.messages),this.ptr=base),json.enums&&(this.create(json.enums),this.ptr=base),json.services&&(this.create(json.services),this.ptr=base),json.extends&&this.create(json.extends),this.reset()},BuilderPrototype.resolveAll=function(){var res;if(null==this.ptr||"object"==typeof this.ptr.type)return this;if(this.ptr instanceof Reflect.Namespace)this.ptr.children.forEach(function(child){this.ptr=child,this.resolveAll()},this);else if(this.ptr instanceof Reflect.Message.Field){if(Lang.TYPE.test(this.ptr.type))this.ptr.type=ProtoBuf.TYPES[this.ptr.type];else{if(!Lang.TYPEREF.test(this.ptr.type))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(!(res=(this.ptr instanceof Reflect.Message.ExtensionField?this.ptr.extension.parent:this.ptr.parent).resolve(this.ptr.type,!0)))throw Error("unresolvable type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(this.ptr.resolvedType=res,res instanceof Reflect.Enum){if(this.ptr.type=ProtoBuf.TYPES.enum,"proto3"===this.ptr.syntax&&"proto3"!==res.syntax)throw Error("proto3 message cannot reference proto2 enum")}else{if(!(res instanceof Reflect.Message))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);this.ptr.type=res.isGroup?ProtoBuf.TYPES.group:ProtoBuf.TYPES.message}}if(this.ptr.map){if(!Lang.TYPE.test(this.ptr.keyType))throw Error("illegal key type for map field in "+this.ptr.toString(!0)+": "+this.ptr.keyType);this.ptr.keyType=ProtoBuf.TYPES[this.ptr.keyType]}"proto3"===this.ptr.syntax&&this.ptr.repeated&&void 0===this.ptr.options.packed&&-1!==ProtoBuf.PACKABLE_WIRE_TYPES.indexOf(this.ptr.type.wireType)&&(this.ptr.options.packed=!0)}else if(this.ptr instanceof ProtoBuf.Reflect.Service.Method){if(!(this.ptr instanceof ProtoBuf.Reflect.Service.RPCMethod))throw Error("illegal service type in "+this.ptr.toString(!0));if(!((res=this.ptr.parent.resolve(this.ptr.requestName,!0))&&res instanceof ProtoBuf.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.requestName);if(this.ptr.resolvedRequestType=res,!((res=this.ptr.parent.resolve(this.ptr.responseName,!0))&&res instanceof ProtoBuf.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.responseName);this.ptr.resolvedResponseType=res}else if(!(this.ptr instanceof ProtoBuf.Reflect.Message.OneOf||this.ptr instanceof ProtoBuf.Reflect.Extension||this.ptr instanceof ProtoBuf.Reflect.Enum.Value))throw Error("illegal object in namespace: "+typeof this.ptr+": "+this.ptr);return this.reset()},BuilderPrototype.build=function(path){if(this.reset(),this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null),null===this.result&&(this.result=this.ns.build()),!path)return this.result;for(var part="string"==typeof path?path.split("."):path,ptr=this.result,i=0;i<part.length;i++){if(!ptr[part[i]]){ptr=null;break}ptr=ptr[part[i]]}return ptr},BuilderPrototype.lookup=function(path,excludeNonNamespace){return path?this.ns.resolve(path,excludeNonNamespace):this.ns},BuilderPrototype.toString=function(){return"Builder"},Builder.Message=function(){},Builder.Enum=function(){},Builder.Service=function(){},Builder}(ProtoBuf,ProtoBuf.Lang,ProtoBuf.Reflect),ProtoBuf.Map=function(ProtoBuf,Reflect){function arrayIterator(arr){var idx=0;return{next:function(){return idx<arr.length?{done:!1,value:arr[idx++]}:{done:!0}}}}var Map=function(field,contents){if(!field.map)throw Error("field is not a map");if(this.field=field,this.keyElem=new Reflect.Element(field.keyType,null,!0,field.syntax),this.valueElem=new Reflect.Element(field.type,field.resolvedType,!1,field.syntax),this.map={},Object.defineProperty(this,"size",{get:function(){return Object.keys(this.map).length}}),contents)for(var keys=Object.keys(contents),i=0;i<keys.length;i++){var key=this.keyElem.valueFromString(keys[i]),val=this.valueElem.verifyValue(contents[keys[i]]);this.map[this.keyElem.valueToString(key)]={key:key,value:val}}},MapPrototype=Map.prototype;return MapPrototype.clear=function(){this.map={}},MapPrototype.delete=function(key){var keyValue=this.keyElem.valueToString(this.keyElem.verifyValue(key)),hadKey=keyValue in this.map;return delete this.map[keyValue],hadKey},MapPrototype.entries=function(){for(var entry,entries=[],strKeys=Object.keys(this.map),i=0;i<strKeys.length;i++)entries.push([(entry=this.map[strKeys[i]]).key,entry.value]);return arrayIterator(entries)},MapPrototype.keys=function(){for(var keys=[],strKeys=Object.keys(this.map),i=0;i<strKeys.length;i++)keys.push(this.map[strKeys[i]].key);return arrayIterator(keys)},MapPrototype.values=function(){for(var values=[],strKeys=Object.keys(this.map),i=0;i<strKeys.length;i++)values.push(this.map[strKeys[i]].value);return arrayIterator(values)},MapPrototype.forEach=function(cb,thisArg){for(var entry,strKeys=Object.keys(this.map),i=0;i<strKeys.length;i++)cb.call(thisArg,(entry=this.map[strKeys[i]]).value,entry.key,this)},MapPrototype.set=function(key,value){var keyValue=this.keyElem.verifyValue(key),valValue=this.valueElem.verifyValue(value);return this.map[this.keyElem.valueToString(keyValue)]={key:keyValue,value:valValue},this},MapPrototype.get=function(key){var keyValue=this.keyElem.valueToString(this.keyElem.verifyValue(key));if(keyValue in this.map)return this.map[keyValue].value},MapPrototype.has=function(key){return this.keyElem.valueToString(this.keyElem.verifyValue(key))in this.map},Map}(0,ProtoBuf.Reflect),ProtoBuf.loadProto=function(proto,builder,filename){return("string"==typeof builder||builder&&"string"==typeof builder.file&&"string"==typeof builder.root)&&(filename=builder,builder=void 0),ProtoBuf.loadJson(ProtoBuf.DotProto.Parser.parse(proto),builder,filename)},ProtoBuf.protoFromString=ProtoBuf.loadProto,ProtoBuf.loadProtoFile=function(filename,callback,builder){if(callback&&"object"==typeof callback?(builder=callback,callback=null):callback&&"function"==typeof callback||(callback=null),callback)return ProtoBuf.Util.fetch("string"==typeof filename?filename:filename.root+"/"+filename.file,function(contents){if(null!==contents)try{callback(null,ProtoBuf.loadProto(contents,builder,filename))}catch(e){callback(e)}else callback(Error("Failed to fetch file"))});var contents=ProtoBuf.Util.fetch("object"==typeof filename?filename.root+"/"+filename.file:filename);return null===contents?null:ProtoBuf.loadProto(contents,builder,filename)},ProtoBuf.protoFromFile=ProtoBuf.loadProtoFile,ProtoBuf.newBuilder=function(options){return void 0===(options=options||{}).convertFieldsToCamelCase&&(options.convertFieldsToCamelCase=ProtoBuf.convertFieldsToCamelCase),void 0===options.populateAccessors&&(options.populateAccessors=ProtoBuf.populateAccessors),new ProtoBuf.Builder(options)},ProtoBuf.loadJson=function(json,builder,filename){return("string"==typeof builder||builder&&"string"==typeof builder.file&&"string"==typeof builder.root)&&(filename=builder,builder=null),builder&&"object"==typeof builder||(builder=ProtoBuf.newBuilder()),"string"==typeof json&&(json=JSON.parse(json)),builder.import(json,filename),builder.resolveAll(),builder},ProtoBuf.loadJsonFile=function(filename,callback,builder){if(callback&&"object"==typeof callback?(builder=callback,callback=null):callback&&"function"==typeof callback||(callback=null),callback)return ProtoBuf.Util.fetch("string"==typeof filename?filename:filename.root+"/"+filename.file,function(contents){if(null!==contents)try{callback(null,ProtoBuf.loadJson(JSON.parse(contents),builder,filename))}catch(e){callback(e)}else callback(Error("Failed to fetch file"))});var contents=ProtoBuf.Util.fetch("object"==typeof filename?filename.root+"/"+filename.file:filename);return null===contents?null:ProtoBuf.loadJson(JSON.parse(contents),builder,filename)},ProtoBuf},"function"==typeof _dereq_&&"object"==typeof module&&module&&module.exports?module.exports=factory(_dereq_("bytebuffer")):(global.dcodeIO=global.dcodeIO||{}).ProtoBuf=factory(global.dcodeIO.ByteBuffer)}).call(this,_dereq_("_process"))},{_process:4,bytebuffer:2,fs:1,path:1}],6:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _pusherClient=_dereq_("./pusherClient");Object.keys(_pusherClient).forEach(function(key){"default"!==key&&"__esModule"!==key&&Object.defineProperty(exports,key,{enumerable:!0,get:function(){return _pusherClient[key]}})});var _pusherInterface=_dereq_("./pusherInterface");Object.keys(_pusherInterface).forEach(function(key){"default"!==key&&"__esModule"!==key&&Object.defineProperty(exports,key,{enumerable:!0,get:function(){return _pusherInterface[key]}})})},{"./pusherClient":7,"./pusherInterface":8}],7:[function(_dereq_,module,exports){"use strict";function Pusher(){this.topicsMessageConsumers={},this.connectionOpenHandlers=[],this.authToken="",this.url="",this.infoLogger=function(info){console.log(info)},this.errorLogger=function(error){console.log(error)},this.reconnectionDelayMin=1e4,this.reconnectionDelayMax=3e4,this.socket=null,this.authorized=!1,this.callback=function(){},this.duringConnection=!1,this.managedDisconnect=!1}Object.defineProperty(exports,"__esModule",{value:!0}),exports.PusherFactory=void 0;var obj,ProtoBuf=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(_dereq_("protobufjs")),_bytebuffer=_dereq_("bytebuffer"),_bytebuffer2=(obj=_bytebuffer)&&obj.__esModule?obj:{default:obj},socket=void 0,gogPbProto=ProtoBuf.newBuilder({}).import({package:"gog.protocols.pb",messages:[{name:"Header",fields:[{rule:"required",type:"uint32",name:"sort",id:1},{rule:"required",type:"uint32",name:"type",id:2},{rule:"optional",type:"uint32",name:"size",id:3,options:{default:0}},{rule:"optional",type:"uint32",name:"oseq",id:4}],extensions:[[100,536870911]]},{name:"Response",fields:[],messages:[{ref:"Header",fields:[{rule:"optional",type:"uint32",name:"rseq",id:100},{rule:"optional",type:"Response.Code",name:"code",id:101,options:{default:"OK"}},{rule:"optional",type:"string",name:"description",id:102},{rule:"optional",type:"uint32",name:"retry_after",id:103}]}],enums:[{name:"Code",values:[{name:"UNKNOWN_RESPONSE",id:0},{name:"OK",id:200},{name:"ACCEPTED",id:202},{name:"BAD_REQUEST",id:400},{name:"UNAUTHORIZED",id:401},{name:"FORBIDDEN",id:403},{name:"NOT_FOUND",id:404},{name:"CONFLICT",id:409},{name:"INTERNAL_ERROR",id:500},{name:"NOT_IMPLEMENTED",id:501},{name:"UNAVAILABLE",id:503}]}]}]}).build(),pusherPbProto=ProtoBuf.newBuilder({}).import({package:"galaxy.protocols.pusher_service",options:{optimize_for:"LITE_RUNTIME"},messages:[{name:"AuthRequest",fields:[{rule:"required",type:"string",name:"auth_token",id:1}]},{name:"SubscribeTopicRequest",fields:[{rule:"required",type:"string",name:"topic",id:1}]},{name:"SubscribeTopicResponse",fields:[{rule:"required",type:"string",name:"topic",id:1}]},{name:"MessageFromTopic",fields:[{rule:"required",type:"string",name:"topic",id:1},{rule:"required",type:"string",name:"content",id:2},{rule:"optional",type:"uint64",name:"id",id:3}]}],enums:[{name:"MessageSort",values:[{name:"MESSAGE_SORT",id:2}]},{name:"MessageType",values:[{name:"UNKNOWN_MESSAGE",id:0},{name:"AUTH_REQUEST",id:1},{name:"AUTH_RESPONSE",id:2},{name:"SUBSCRIBE_TOPIC_REQUEST",id:3},{name:"SUBSCRIBE_TOPIC_RESPONSE",id:4},{name:"MESSAGE_FROM_TOPIC",id:5}]}]}).build(),gogPb=gogPbProto.gog.protocols.pb,pusherPb=pusherPbProto.galaxy.protocols.pusher_service,messagesHandler={decodeResponse:function(responseBuffer){if(!(responseBuffer instanceof ArrayBuffer))throw new Error("Wrong responseBuffer data",responseBuffer);var result={header:null,message:null},dataSize=responseBuffer.byteLength;if(dataSize<2)throw new Error("Message is too small",responseBuffer);var headerSize=(responseBuffer=_bytebuffer2.default.wrap(responseBuffer)).readUint16();if(dataSize<2+headerSize)throw new Error("Message is too small",responseBuffer);var header=void 0;try{(header=gogPb.Header.decode(responseBuffer.slice(2,2+headerSize)))[".gog.protocols.pb.Response.code"]&&(header.code=header[".gog.protocols.pb.Response.code"]),header[".gog.protocols.pb.Response.rseq"]&&(header.rseq=header[".gog.protocols.pb.Response.rseq"]),header[".gog.protocols.pb.Response.description"]&&(header.description=header[".gog.protocols.pb.Response.description"]),result.header=header}catch(e){throw new Error("Can`t decode header from response.")}if(header.sort!==pusherPb.MessageSort.MESSAGE_SORT)throw new Error("Invalid subprotocol",header.sort);if(0===header.size||dataSize<2+headerSize+header.size)return result;var messageType=this.resolveMessageClass(header.type);if(!messageType)throw new Error("Wrong message type");var messageStart=2+headerSize,messageEnd=messageStart+header.size;try{var message=pusherPb[messageType].decode(responseBuffer.slice(messageStart,messageEnd));result.message=message}catch(e){throw new Error("Can`t decode message from response")}return result},resolveMessageClass:function(messageType){switch(messageType){case pusherPb.MessageType.SUBSCRIBE_TOPIC_RESPONSE:return"SubscribeTopicResponse";case pusherPb.MessageType.MESSAGE_FROM_TOPIC:return"MessageFromTopic"}},createMessage:function(type,messageData){switch(type){case this.messageTypes.AUTH_REQUEST:return new pusherPb.AuthRequest(messageData);case this.messageTypes.SUBSCRIBE_TOPIC_REQUEST:return new pusherPb.SubscribeTopicRequest(messageData)}throw new Error("Wrong message type: "+type)},generateRequestSequenceNo:function(){return Math.floor(-8999999*Math.random()+9999999)},createRequest:function(type,messageData){var message=this.createMessage(type,messageData),header=new gogPb.Header({sort:pusherPb.MessageSort.MESSAGE_SORT,type:type,size:message.toArrayBuffer().byteLength,oseq:this.generateRequestSequenceNo()}),request=new _bytebuffer2.default;return request.writeUint16(header.toArrayBuffer().byteLength),request.append(header.toArrayBuffer()),request.append(message.toArrayBuffer()),request.clear(),request.toBuffer()},messageTypes:pusherPb.MessageType};Pusher.prototype.setReconnectionDelayBounds=function(minMs,maxMs){this.reconnectionDelayMin=minMs,this.reconnectionDelayMax=maxMs},Pusher.prototype.getReconnectionDelay=function(){return Math.floor(Math.random()*(this.reconnectionDelayMax-this.reconnectionDelayMin)+this.reconnectionDelayMin)},Pusher.prototype.logInfo=function(info){this.infoLogger(info)},Pusher.prototype.logError=function(error){this.errorLogger(error)},Pusher.prototype.addInfoLogger=function(logger){return this.infoLogger=logger,this},Pusher.prototype.addErrorLogger=function(logger){return this.errorLogger=logger,this},Pusher.prototype.addMessagesConsumerForTopic=function(topic,consumer){return this.topicsMessageConsumers[topic]=consumer,this._subscribeTopic(topic),this},Pusher.prototype._subscribeTopic=function(topic){this.authorized&&this.socket.send(messagesHandler.createRequest(messagesHandler.messageTypes.SUBSCRIBE_TOPIC_REQUEST,{topic:topic}))},Pusher.prototype.addConnectionOpenHandler=function(consumer){return this.connectionOpenHandlers.push(consumer),this},Pusher.prototype.reconnect=function(token){this.authToken=token,this.managedDisconnect=!1,this.logInfo({subject:"Pusher",message:"Try to reconnect"}),this.run.call(this,this.callback)},Pusher.prototype.disconnect=function(){this.authToken=null,this.managedDisconnect=!0,this.logInfo({subject:"Pusher",message:"Disconnect"}),this.socket&&this.socket.close()},Pusher.prototype.disconnectClient=function(){console.log("Disconnecting"),this.logInfo({subject:"Pusher",message:"Disconnect "}),this.socket&&this.socket.close()},Pusher.prototype.run=function(callback){function resolveAction(response){if(response.header){switch(response.header.type){case messagesHandler.messageTypes.AUTH_RESPONSE:return void function(response){if(200!==response.header.code)return callback(new Error("Can`t subscribe topic")),self.authorized=!1,void self.logError({subject:"Pusher",message:"Can`t authorize"});self.authorized=!0,Object.keys(self.topicsMessageConsumers).forEach(self._subscribeTopic.bind(self)),self.connectionOpenHandlers.forEach(function(handler){handler()})}(response);case messagesHandler.messageTypes.SUBSCRIBE_TOPIC_RESPONSE:return void function(response){200!==response.header.code?(callback(new Error("Can`t subscribe topic")),self.logError({subject:"Pusher",message:"Can`t subscribe topic"})):callback(null,!0)}(response);case messagesHandler.messageTypes.MESSAGE_FROM_TOPIC:return void function(response){200===response.header.code?(response.message.id=response.message.id.toString(),self.topicsMessageConsumers[response.message.topic](response.message)):self.logError({subject:"Pusher",message:"Problem with message coming from topic"})}(response)}self.logError({subject:"Pusher",message:"Can`t resolve received response"})}else self.logError({subject:"Pusher",message:"Incorrect response",data:response})}var self=this;!self.duringConnection&&self.authToken&&((socket=new WebSocket(this.url)).binaryType="arraybuffer",self.managedDisconnect=!1,self.socket=socket,self.duringConnection=!0,self.callback=callback,self.logInfo({subject:"Pusher",message:"Connected"}),socket.onopen=function(){var authRequest;self.duringConnection=!0,authRequest=messagesHandler.createRequest(messagesHandler.messageTypes.AUTH_REQUEST,{auth_token:self.authToken}),socket.send(authRequest)},socket.onmessage=function(msg){resolveAction(messagesHandler.decodeResponse(msg.data))},socket.onclose=function(){self.duringConnection=!1,self.socket=null,self.authorized=!1,callback(new Error("Pusher Disconnected")),self.logInfo({subject:"Pusher",message:"Disconnected"}),self.managedDisconnect?self.managedDisconnect=!1:window.setTimeout(function(){self.logInfo({subject:"Pusher",message:"Try to reconnect"}),self.run.call(self,callback)},self.getReconnectionDelay())},socket.onerror=function(error){self.duringConnection=!1,self.socket=null,self.authorized=!1,callback(new Error("Pusher Error")),self.logInfo({subject:"Pusher",message:error}),self.managedDisconnect?self.managedDisconnect=!1:window.setTimeout(function(){self.logInfo({subject:"Pusher",message:"Try to reconnect"}),self.run.call(self,callback)},self.getReconnectionDelay())})},exports.PusherFactory={createPusher:function(url,authToken){var pusher=new Pusher;return pusher.url=url,pusher.authToken=authToken,pusher}}},{bytebuffer:2,protobufjs:5}],8:[function(_dereq_,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_pusherClient=_dereq_("./pusherClient"),PusherInterfaceProvider=function(){function PusherInterfaceProvider(){_classCallCheck(this,PusherInterfaceProvider),this.$get=["$rootScope","listenersManager",function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return new(Function.prototype.bind.apply(PusherInterfaceService,[null].concat(args)))}]}return _createClass(PusherInterfaceProvider,[{key:"setLogger",value:function(serviceName){this.$get=["$rootScope","listenersManager",serviceName,function(){for(var _len2=arguments.length,args=Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];return new(Function.prototype.bind.apply(PusherInterfaceService,[null].concat(args)))}]}}]),PusherInterfaceProvider}(),PusherInterfaceService=function(){function PusherInterfaceService($rootScope,listenersManager){var loggerService=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console;_classCallCheck(this,PusherInterfaceService),this._$rootScope=$rootScope,this._pusher=null,this._loggerService=loggerService,this._isHealthy=null,this._topicConsumers={},this._queuedTopicsForRegistration=[],this._connectionStatusListenersManager=listenersManager.getManager()}return _createClass(PusherInterfaceService,[{key:"connect",value:function(path,accessToken){var bearerAccessToken="Bearer "+accessToken;null===this._pusher?(this._pusher=_pusherClient.PusherFactory.createPusher(path,bearerAccessToken),this._pusher.addInfoLogger(angular.noop),this._pusher.addErrorLogger(angular.noop),this._pusher.run(this._monitorPusherConnection.bind(this)),this._registerQueuedTopics()):this._pusher.reconnect(bearerAccessToken)}},{key:"disconnect",value:function(){null!==this._pusher&&this._pusher.disconnect()}},{key:"setReconnectionDelayBounds",value:function(minMs,maxMs){this._pusher.setReconnectionDelayBounds(minMs,maxMs)}},{key:"getConnectionStatus",value:function(){return this._isHealthy}},{key:"registerConnectionStatusListener",value:function(listener){return this._connectionStatusListenersManager.addListener(listener)}},{key:"_monitorPusherConnection",value:function(pusherError){pusherError?this._setPusherHealth(!1):this._setPusherHealth(!0)}},{key:"_setPusherHealth",value:function(isPusherHealthy){this._isHealthy!==isPusherHealthy&&(this._isHealthy=isPusherHealthy,this._connectionStatusListenersManager.callListeners(this._isHealthy))}},{key:"registerTopicConsumer",value:function(topic,consumer){this._verifyTopicConsumer(topic),this._topicConsumers[topic].push(consumer)}},{key:"_verifyTopicConsumer",value:function(topic){Array.isArray(this._topicConsumers[topic])||(this._topicConsumers[topic]=[],this._registerTopicInPusher(topic))}},{key:"_getTopicConsumer",value:function(topic){return function(message){var _this=this;Array.isArray(this._topicConsumers[topic])&&this._$rootScope.$applyAsync(function(){for(var messageConsumerIndex in _this._topicConsumers[topic])try{_this._topicConsumers[topic][messageConsumerIndex](message)}catch(err){_this._loggerService.error(err)}})}.bind(this)}},{key:"_registerTopicInPusher",value:function(topic){null!==this._pusher?this._pusher.addMessagesConsumerForTopic(topic,this._getTopicConsumer(topic)):this._queuedTopicsForRegistration.push(topic)}},{key:"_registerQueuedTopics",value:function(){if(0!==this._queuedTopicsForRegistration.length){for(var topicIndex in this._queuedTopicsForRegistration)this._registerTopicInPusher(this._queuedTopicsForRegistration[topicIndex]);this._queuedTopicsForRegistration.length=0}}}]),PusherInterfaceService}();angular.module("gogModulePusherClient",[]).provider("pusherInterface",PusherInterfaceProvider)},{"./pusherClient":7}]},{},[6])(6)},module.exports=f()},function(module,exports,__webpack_require__){"use strict";angular.module("ngTouchstart",[]).directive("ngTouchstart",function(){return{controller:function($scope,$element,$attrs){$element.bind("touchstart",function(event){var method=$element.attr("ng-touchstart");$scope.$event=event,$scope.$apply(method)})}}})},function(module,exports,__webpack_require__){var require,f;f=function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){if(!u&&("function"==typeof require&&require))return require(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){return s(t[o][1][e]||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),ActivityFeedTopicParserService=function(){function ActivityFeedTopicParserService(listenersManager){(function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")})(this,ActivityFeedTopicParserService),this.newNotificationListenersManager=listenersManager.getManager(),this.notificationRemovedListenersManager=listenersManager.getManager(),this.notificationConsumedListenersManager=listenersManager.getManager()}return _createClass(ActivityFeedTopicParserService,null,[{key:"initClass",value:function(){ActivityFeedTopicParserService.$inject=["listenersManager"]}}]),_createClass(ActivityFeedTopicParserService,[{key:"registerNewNotificationListener",value:function(listener){return this.newNotificationListenersManager.addListener(listener)}},{key:"registerNotificationRemovedListener",value:function(listener){return this.notificationRemovedListenersManager.addListener(listener)}},{key:"registerNotificationConsumedListener",value:function(listener){return this.notificationConsumedListenersManager.addListener(listener)}},{key:"parseTopicMessage",value:function(message){var activityPayload=JSON.parse(message.content);this.newNotificationListenersManager.callListeners(message.id,activityPayload)}},{key:"parseRemovedTopicMessage",value:function(message){var messageContent=JSON.parse(message.content);this.notificationRemovedListenersManager.callListeners(messageContent.removed_by,messageContent[messageContent.removed_by])}},{key:"parseConsumedTopicMessage",value:function(message){var messageContent=JSON.parse(message.content);this.notificationConsumedListenersManager.callListeners(messageContent.id)}}]),ActivityFeedTopicParserService}();ActivityFeedTopicParserService.initClass(),exports.activityFeedTopicParser=angular.module("gogModuleTopicParsers").service("activityFeedTopicParser",ActivityFeedTopicParserService)},{}],2:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),FriendsTopicParserService=function(){function FriendsTopicParserService(listenersManager){(function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")})(this,FriendsTopicParserService),this._friendInviteReceivedListenersManager=listenersManager.getManager(),this._friendInviteRemovedListenersManager=listenersManager.getManager(),this._newFriendListenersManager=listenersManager.getManager(),this._friendRemovedListenersManager=listenersManager.getManager()}return _createClass(FriendsTopicParserService,null,[{key:"initClass",value:function(){FriendsTopicParserService.$inject=["listenersManager"],FriendsTopicParserService.KEYS=Object.freeze({NEW_INVITE:"new_invite",INVITE_REMOVED:"invite_removed",NEW_FRIEND:"new_friend",FRIEND_REMOVED:"friend_removed"}),FriendsTopicParserService.NEW_INVITE_RECEIVED_STATUS="invited"}}]),_createClass(FriendsTopicParserService,[{key:"parseTopicMessage",value:function(message){var content=JSON.parse(message.content);switch(content.key){case FriendsTopicParserService.KEYS.NEW_INVITE:this._onFriendInviteReceived(content.data);break;case FriendsTopicParserService.KEYS.INVITE_REMOVED:this._onFriendInviteRemoved(content.data);break;case FriendsTopicParserService.KEYS.NEW_FRIEND:this._onNewFriend(content.data);break;case FriendsTopicParserService.KEYS.FRIEND_REMOVED:this._onFriendRemoved(content.data);break;default:console.warn("Unknown friends topic key: "+message.key)}}},{key:"registerFriendInviteReceivedListener",value:function(listener){return this._friendInviteReceivedListenersManager.addListener(listener)}},{key:"_onFriendInviteReceived",value:function(data){data.status===FriendsTopicParserService.NEW_INVITE_RECEIVED_STATUS&&this._friendInviteReceivedListenersManager.callListeners({userName:data.user.username,userId:data.user_id,avatarUrls:data.user.avatar})}},{key:"registerFriendInviteRemovedListener",value:function(listener){return this._friendInviteRemovedListenersManager.addListener(listener)}},{key:"_onFriendInviteRemoved",value:function(data){this._friendInviteRemovedListenersManager.callListeners({userId:data.user_id})}},{key:"registerNewFriendListener",value:function(listener){return this._newFriendListenersManager.addListener(listener)}},{key:"_onNewFriend",value:function(data){this._newFriendListenersManager.callListeners({userName:data.user.username,userId:data.user_id,avatarUrls:data.user.avatar})}},{key:"registerFriendRemovedListener",value:function(listener){return this._friendRemovedListenersManager.addListener(listener)}},{key:"_onFriendRemoved",value:function(data){this._friendRemovedListenersManager.callListeners({userName:data.user.username,userId:data.user_id,avatarUrls:data.user.avatar})}}]),FriendsTopicParserService}();FriendsTopicParserService.initClass(),exports.friendsTopicParser=angular.module("gogModuleTopicParsers").service("friendsTopicParser",FriendsTopicParserService)},{}],3:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.gogModuleTopicParsers=angular.module("gogModuleTopicParsers",[])},{}],4:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),MenuCustomTopicParser=function(){function MenuCustomTopicParser(listenersManager){(function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")})(this,MenuCustomTopicParser),this.newWishlistNotificationListenersManager=listenersManager.getManager(),this.newForumNotificationListenersManager=listenersManager.getManager(),this.newGogAnnouncementListenersManager=listenersManager.getManager(),this.productReleaseNotificationListenersManager=listenersManager.getManager(),this.notificationRemovedListenersManager=listenersManager.getManager(),this.notificationConsumedListenersManager=listenersManager.getManager()}return _createClass(MenuCustomTopicParser,null,[{key:"initClass",value:function(){MenuCustomTopicParser.$inject=["listenersManager"],MenuCustomTopicParser.KEYS=Object.freeze({WISHLIST_DISCOUNT:"wishlisted_products_discounted",FORUM_REPLY:"new_forum_reply",GOG_ANNOUNCEMENT:"gog_announces",PRODUCT_RELEASE:"product_release_notify"})}}]),_createClass(MenuCustomTopicParser,[{key:"parseTopicMessage",value:function(message){var isDownloaded=arguments.length>1&&void 0!==arguments[1]&&arguments[1],messageContent=JSON.parse(message.content),consumed=!1;message.hasOwnProperty("consumed")&&(consumed=message.consumed);var updateTimestamp=null;void 0!==message.date_updated&&(updateTimestamp=Math.floor(this._dateIsoStringToTimestamp(message.date_updated)/1e3));var expirationTimestamp=null;void 0!==message.date_expiration&&(expirationTimestamp=this._dateIsoStringToTimestamp(message.date_expiration));var creationTimestamp;switch(creationTimestamp=void 0!==message.date_created?Math.floor(this._dateIsoStringToTimestamp(message.date_created)/1e3):Math.floor(Date.now()/1e3),messageContent.key){case MenuCustomTopicParser.KEYS.WISHLIST_DISCOUNT:this.newWishlistNotificationListenersManager.callListeners(message.id,messageContent.discountedProducts,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,isDownloaded);break;case MenuCustomTopicParser.KEYS.FORUM_REPLY:var counter=0;message.hasOwnProperty("counter")&&(counter=message.counter),this.newForumNotificationListenersManager.callListeners(message.id,this._formatForumNotification(messageContent),consumed,counter,creationTimestamp,expirationTimestamp,updateTimestamp,isDownloaded);break;case MenuCustomTopicParser.KEYS.GOG_ANNOUNCEMENT:this.newGogAnnouncementListenersManager.callListeners(message.id,this._formatGogAnnouncementNotification(messageContent),consumed,creationTimestamp,expirationTimestamp,updateTimestamp,isDownloaded);break;case MenuCustomTopicParser.KEYS.PRODUCT_RELEASE:this.productReleaseNotificationListenersManager.callListeners(message.id,this._formatProductReleaseNotification(messageContent),consumed,creationTimestamp,expirationTimestamp,updateTimestamp,isDownloaded);break;default:console.warn("Messages topic key not supported: "+messageContent.key)}}},{key:"parseRemovedTopicMessage",value:function(message){var messageContent=JSON.parse(message.content);this.notificationRemovedListenersManager.callListeners(messageContent.removed_by,messageContent[messageContent.removed_by])}},{key:"parseConsumedTopicMessage",value:function(message){var messageContent=JSON.parse(message.content);this.notificationConsumedListenersManager.callListeners(messageContent.id)}},{key:"registerNewWishlistNotificationListener",value:function(listener){return this.newWishlistNotificationListenersManager.addListener(listener)}},{key:"registerNewForumNotificationListener",value:function(listener){return this.newForumNotificationListenersManager.addListener(listener)}},{key:"registerNewGogAnnouncementNotificationListener",value:function(listener){return this.newGogAnnouncementListenersManager.addListener(listener)}},{key:"registerProductReleaseNotificationListener",value:function(listener){return this.productReleaseNotificationListenersManager.addListener(listener)}},{key:"registerNotificationRemovedListener",value:function(listener){return this.notificationRemovedListenersManager.addListener(listener)}},{key:"registerNotificationConsumedListener",value:function(listener){return this.notificationConsumedListenersManager.addListener(listener)}},{key:"_formatGogAnnouncementNotification",value:function(notificationContent){return{announcement:notificationContent.announcement,background:notificationContent.background}}},{key:"_formatProductReleaseNotification",value:function(notificationContent){return{link:notificationContent.product.link,productTitle:notificationContent.product.title,productPrice:notificationContent.product.price,productId:notificationContent.product.productId,productIcon:{full:notificationContent.product.gameIcon.full}}}},{key:"_formatForumNotification",value:function(notificationContent){return{userName:notificationContent.sender_username,userAvatarUrls:{medium:notificationContent.avatars.medium,medium_2x:notificationContent.avatars.medium_2x},userId:notificationContent.from_user_id,forumSlug:notificationContent.forum_slug,topicSlug:notificationContent.topic_slug,threadTitle:notificationContent.thread_title,threadLink:notificationContent.link,forumPostCreationTimestamp:this._dateIsoStringToTimestamp(notificationContent.publish_date)/1e3}}},{key:"_dateIsoStringToTimestamp",value:function(isoDate){var dateParts=isoDate.match(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})/);return Date.UTC(parseInt(dateParts[1],10),parseInt(dateParts[2],10)-1,parseInt(dateParts[3],10),parseInt(dateParts[4],10),parseInt(dateParts[5],10),parseInt(dateParts[6],10))}}]),MenuCustomTopicParser}();MenuCustomTopicParser.initClass(),exports.menuCustomTopicParser=angular.module("gogModuleTopicParsers").service("menuCustomTopicParser",MenuCustomTopicParser)},{}],5:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),PresenceTopicParser=function(){function PresenceTopicParser(listenersManager){(function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")})(this,PresenceTopicParser),this._newStatusListenersManager=listenersManager.getManager(),this._deletedStatusListenersManager=listenersManager.getManager()}return _createClass(PresenceTopicParser,null,[{key:"initClass",value:function(){PresenceTopicParser.$inject=["listenersManager"],PresenceTopicParser.KEYS=Object.freeze({NEW_STATUS:"new_presence_status",DELETED_STATUS:"delete_presence_status"})}}]),_createClass(PresenceTopicParser,[{key:"parseTopicMessage",value:function(message){var content=JSON.parse(message.content);switch(content.key){case PresenceTopicParser.KEYS.NEW_STATUS:this._onNewStatus(content.data);break;case PresenceTopicParser.KEYS.DELETED_STATUS:this._onDeletedStatus(content.data);break;default:console.warn("Unknown presence topic key: "+message.key)}}},{key:"registerNewStatusListener",value:function(listener){return this._newStatusListenersManager.addListener(listener)}},{key:"_onNewStatus",value:function(pusherData){this._newStatusListenersManager.callListeners(pusherData)}},{key:"registerDeletedStatusListener",value:function(listener){return this._deletedStatusListenersManager.addListener(listener)}},{key:"_onDeletedStatus",value:function(data){this._deletedStatusListenersManager.callListeners({userId:data.user_id})}}]),PresenceTopicParser}();PresenceTopicParser.initClass(),exports.presenceTopicParser=angular.module("gogModuleTopicParsers").service("presenceTopicParser",PresenceTopicParser)},{}],6:[function(_dereq_,module,exports){"use strict";_dereq_("./GogModuleTopicParsers"),_dereq_("./MenuCustomTopicParser"),_dereq_("./PresenceTopicParser"),_dereq_("./FriendsTopicParser"),_dereq_("./ActivityFeedTopicParser")},{"./ActivityFeedTopicParser":1,"./FriendsTopicParser":2,"./GogModuleTopicParsers":3,"./MenuCustomTopicParser":4,"./PresenceTopicParser":5}]},{},[6])(6)},module.exports=f()},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var GogMenu=function(){function GogMenu($attrs,$element,menuDropdown,$window,menuAimFactory,$timeout,menuConfig){this.$attrs=$attrs,this.$element=$element,this.menuDropdown=menuDropdown,this.$window=$window,this.menuAimFactory=menuAimFactory,this.$timeout=$timeout,this.menuConfig=menuConfig,this.currentExpanded={},this.currentLocale=this.menuConfig.getLocale(),this.currentCountry=this.menuConfig.getCountry(),this.currentCurrency=this.menuConfig.getCurrency(),this.menuConfig.registerLocaleListener(this.setCurrentLocale.bind(this)),this.menuConfig.registerCountryListener(this.setCurrentCountry.bind(this)),this.menuConfig.registerCurrencyListener(this.setCurrentCurrency.bind(this)),this.container=$element[0],this.currentOs=this.menuConfig.getOs(),this.expanded={},this.hiddingTimeouts={},this.showingTimeout=null,this.container=$element[0],this.menuAim=menuAimFactory.getForMenu(this.container,75,300,"below"),this.animationMode=GogMenu.ANIMATION_MODES.LONG,this.menuConfig.registerLocaleListener(this.setCurrentLocale.bind(this)),this.menuConfig.registerCountryListener(this.setCurrentCountry.bind(this)),this.menuConfig.registerCurrencyListener(this.setCurrentCurrency.bind(this)),menuDropdown.registerVisibilityChangeTriggeredListener(this.changeTriggered.bind(this)),this.hideOnClickOutsideBound=this.hideOnClickOutside.bind(this),this.hideExpandedBound=this.hideExpanded.bind(this),$window.addEventListener("keydown",this.onKeyDown.bind(this)),this.container.addEventListener("click",this.stopPropagation.bind(this)),this.container.addEventListener("click",this.hideOnClickInMenu.bind(this))}return GogMenu.prototype.show=function($event,menuName){if(null!=$event&&$event.stopPropagation(),!this.isExpanded(menuName)){this.hideExpanded();var menu=this.container.querySelector(GogMenu.DROPDOWN_SUBMENU_PREFIX+menuName);menu.classList.add("is-expanded","animation-mode--"+this.animationMode),this.currentExpanded.menuElement=menu,this.currentExpanded.menuName=menuName,this.container.classList.add("menu--"+menuName+"-expanded","menu--expanded"),this.menuDropdown.setState(menuName,!0),this.expanded[menuName]=!0,document.body.addEventListener("click",this.hideExpandedBound)}},GogMenu.prototype.showWithDelay=function($event,menuName,delay){var _this=this;void 0===delay&&(delay=GogMenu.ACTIVATION_DELAY),this.$timeout.cancel(this.showingTimeout),null!=$event&&$event.stopPropagation(),this.animationMode=GogMenu.ANIMATION_MODES.LONG,this.anyExpanded()?(this.animationMode=GogMenu.ANIMATION_MODES.SHORT,this.show(null,menuName)):this.showingTimeout=this.$timeout(function(){_this.show(null,menuName)},delay)},GogMenu.prototype.showOnFirstClick=function($event,menuName){this.isExpanded(menuName)||($event.preventDefault(),this.$timeout.cancel(this.showingTimeout),this.show($event,menuName))},GogMenu.prototype.toggle=function($event,menuName,disableScroll){void 0===disableScroll&&(disableScroll=!1),this.animationMode=GogMenu.ANIMATION_MODES.LONG,this.isExpanded(menuName)?(this.hide($event,menuName),disableScroll&&this.enableScroll()):(this.anyExpanded()&&(this.animationMode=GogMenu.ANIMATION_MODES.SHORT),this.show($event,menuName),disableScroll&&this.disableScroll())},GogMenu.prototype.isExpanded=function(menuName){return this.expanded[menuName]},GogMenu.prototype.hide=function($event,menuName,delay){if(void 0===delay&&(delay=this.menuAim.getActivationDelay()),this.$timeout.cancel(this.showingTimeout),this.expanded[menuName]){null!=$event&&$event.stopPropagation();var activationDelay=delay;this.hiddingTimeouts[menuName]=this.$timeout(this.delayedHide.bind(this,menuName),activationDelay)}},GogMenu.prototype.hideOnMouseleave=function($event,menuName,delay){this.eventToPass=$event,this.menuNameToPass=menuName,this.$window.addEventListener("blur",this.hideOnClickOutsideBound),this.$window.addEventListener("click",this.hideOnClickOutsideBound),this.hide($event,menuName,delay)},GogMenu.prototype.hideOnClickOutside=function(e){this.hide(this.eventToPass,this.menuNameToPass,0),this.$window.removeEventListener("blur",this.hideOnClickOutsideBound),this.$window.removeEventListener("click",this.hideOnClickOutsideBound)},GogMenu.prototype.stopPropagation=function($event){$event.stopPropagation()},GogMenu.prototype.cancelTimeout=function(menuName){this.$timeout.cancel(this.hiddingTimeouts[menuName])},GogMenu.prototype.setCurrentLocale=function(locale){this.currentLocale=locale},GogMenu.prototype.setCurrentCountry=function(country){this.currentCountry=country},GogMenu.prototype.setCurrentCurrency=function(currency){this.currentCurrency=currency},GogMenu.prototype.enableScroll=function(){},GogMenu.prototype.disableScroll=function(){},GogMenu.prototype.delayedHide=function(menuName){var menu=this.container.querySelector(GogMenu.DROPDOWN_SUBMENU_PREFIX+menuName);menu.classList.remove("animation-mode--short","animation-mode--long"),this.expanded[menuName]=!1,menu.classList.contains("is-expanded")&&(menu.classList.remove("is-expanded"),this.menuDropdown.setState(menuName,!1),this.container.classList.remove("menu--"+menuName+"-expanded"),this.anyExpanded()||this.container.classList.remove("menu--expanded"))},GogMenu.prototype.onKeyDown=function(event){event.keyCode!=GogMenu.ESCAPE||this.isExpanded("search")||this.hideExpanded()},GogMenu.prototype.changeTriggered=function(menuName,state){state?this.showByExternalTrigger(menuName):this.hide(null,menuName)},GogMenu.prototype.showByExternalTrigger=function(menuName){this.show(null,menuName);for(var iframesList=document.querySelectorAll("iframe"),i=0;i<iframesList.length;i++)iframesList[i].contentDocument.addEventListener("click",this.hideExpandedBound)},GogMenu.prototype.hideExpanded=function(){for(var menuName in this.expanded)this.expanded[menuName]&&this.hide(null,menuName)},GogMenu.prototype.hideOnClickInMenu=function(event){var className=(GogMenu.DROPDOWN_SUBMENU_PREFIX+this.currentExpanded.menuName).substring(1),target=event.target;for(this.hideExpanded();(null!==target||void 0!==target)&&target!==document.documentElement;){if(target.classList.contains(className)){this.cancelTimeout(this.currentExpanded.menuName);break}target=target.parentNode}},GogMenu.prototype.anyExpanded=function(){for(var menuName in this.expanded)if(this.expanded[menuName])return!0;return!1},GogMenu.$inject=["$attrs","$element","menuDropdown","$window","menuAimFactory","$timeout","menuConfig"],GogMenu.DROPDOWN_SUBMENU_PREFIX=".js-menu-",GogMenu.ACTIVATION_DELAY=150,GogMenu.ESCAPE=27,GogMenu.ANIMATION_MODES={LONG:"long",SHORT:"short"},GogMenu}();exports.GogMenu=GogMenu},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var GogMenuOverlay=function(){function GogMenuOverlay($element,menuDropdown){this.$element=$element,this.menuDropdown=menuDropdown,this.overlay=$element[0],this.menuDropdown.registerVisibilityChangedListener(this.submenuVisibilityChanged.bind(this))}return GogMenuOverlay.prototype.submenuVisibilityChanged=function(){this.menuDropdown.anyExpanded()?this.show():this.hide()},GogMenuOverlay.prototype.show=function(){this.overlay.classList.add("is-visible")},GogMenuOverlay.prototype.hide=function(){this.overlay.classList.remove("is-visible")},GogMenuOverlay.$inject=["$element","menuDropdown"],GogMenuOverlay}();exports.GogMenuOverlay=GogMenuOverlay},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var GogMenuSearch=function(){function GogMenuSearch($attrs,$element,menuSearch,menuDropdown,$window){this.$attrs=$attrs,this.$element=$element,this.menuSearch=menuSearch,this.menuDropdown=menuDropdown,this.$window=$window,this.element=$element[0],this.resultsContainer=this.element.querySelector(GogMenuSearch.RESULTS_CONTAINER_SELECTOR),this.currentElementIndex=-1,this.input=this.element.querySelector(GogMenuSearch.INPUT_SELECTOR),this.keyDownEventCallback=this.keyDown.bind(this),this.menuDropdown.registerVisibilityChangedListener(this.menuVisibilityChanged.bind(this))}return GogMenuSearch.prototype.menuVisibilityChanged=function(menuName,isExpanded){"search"==menuName&&(isExpanded?this.$window.document.addEventListener("keydown",this.keyDownEventCallback):this.$window.document.removeEventListener("keydown",this.keyDownEventCallback))},GogMenuSearch.prototype.isGogScrollbarActive=function(){return window.gogMicroservices&&window.gogMicroservices.hasOwnProperty("menu")&&window.gogMicroservices.menu.hasOwnProperty("features")&&window.gogMicroservices.menu.features.hasOwnProperty("gog_scrollbar")&&window.gogMicroservices.menu.features.gog_scrollbar},GogMenuSearch.prototype.keyDown=function(event){switch(this.focusableElements=this.element.querySelectorAll(GogMenuSearch.FOCUSABLE_ELEMENT_SELECTOR),event.keyCode){case GogMenuSearch.KEYS.ESC:""==this.input.value?this.exit():this.clear();break;case GogMenuSearch.KEYS.UP_ARROW:this.focusOnPrevElement();break;case GogMenuSearch.KEYS.DOWN_ARROW:this.focusOnNextElement();break;case GogMenuSearch.KEYS.ENTER:this.menuSearch.openSelected()}this.setFocus()},GogMenuSearch.prototype.focusOnPrevElement=function(){0==this.currentElementIndex?this.currentElementIndex=this.focusableElements.length-1:this.currentElementIndex--,this.menuSearch.selectResult(this.currentElementIndex),this.isGogScrollbarActive()&&this.scrollToResult(this.currentElementIndex)},GogMenuSearch.prototype.focusOnNextElement=function(){this.currentElementIndex+1>=this.focusableElements.length?this.currentElementIndex=0:this.currentElementIndex++,this.menuSearch.selectResult(this.currentElementIndex),this.isGogScrollbarActive()&&this.scrollToResult(this.currentElementIndex)},GogMenuSearch.prototype.scrollToResult=function(resultIndex){this.resultsContainer.scrollTop=this.focusableElements[resultIndex].offsetTop},GogMenuSearch.prototype.exit=function(){this.menuSearch.reset(),this.menuDropdown.triggerCollapse("search")},GogMenuSearch.prototype.clear=function(){this.menuSearch.reset()},GogMenuSearch.prototype.setFocus=function(){if(this.focusableElements[this.currentElementIndex]){for(var focusedElements=this.element.querySelectorAll(GogMenuSearch.FOCUSABLE_ELEMENT_SELECTOR+"."+GogMenuSearch.IS_FOCUSED_CLASSNAME),i=0;i<focusedElements.length;i++)focusedElements[i].classList.remove(GogMenuSearch.IS_FOCUSED_CLASSNAME);this.focusableElements[this.currentElementIndex].classList.add(GogMenuSearch.IS_FOCUSED_CLASSNAME)}},GogMenuSearch.$inject=["$attrs","$element","menuSearch","menuDropdown","$window"],GogMenuSearch.INPUT_SELECTOR=".js-menu-search-input",GogMenuSearch.RESULTS_CONTAINER_SELECTOR=".js-menu-search-content",GogMenuSearch.FOCUSABLE_ELEMENT_SELECTOR=".js-focusable-element",GogMenuSearch.IS_FOCUSED_CLASSNAME="is-focused",GogMenuSearch.KEYS={ESC:27,DOWN_ARROW:40,UP_ARROW:38,ENTER:13},GogMenuSearch}();exports.GogMenuSearch=GogMenuSearch},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var GogMenuFeaturesSlider=function(){function GogMenuFeaturesSlider($element,menuDropdown){this.menuDropdown=menuDropdown,this.element=$element[0],this.slides=this.element.querySelectorAll(".js-slide"),this.timer=this.element.querySelector(".js-timer"),this.timerSections=this.timer.querySelectorAll(".js-timer-section"),this.numberOfSlides=this.slides.length,this.currentSlide=1,this.intervalIDs=[],this.timeoutID=0,this.startTime=0,this.visibilityListenerCanceller=this.menuDropdown.registerVisibilityChangedListener(this.checkState.bind(this)),$element.on("$destroy",this.destructor.bind(this))}return GogMenuFeaturesSlider.prototype.triggerNextSlide=function(){this.remaining=null,window.clearTimeout(this.timeoutID),this.clearIntervals(),this.nextSlide(!0)},GogMenuFeaturesSlider.prototype.triggerPrevSlide=function(){if(window.clearTimeout(this.timeoutID),this.currentSlide>1?this.currentSlide--:this.currentSlide=this.numberOfSlides,this.element.querySelector("."+GogMenuFeaturesSlider.CLASSNAMES.ACTIVE).classList.remove(GogMenuFeaturesSlider.CLASSNAMES.ACTIVE),this.currentSlide==this.numberOfSlides)for(var section in Array.prototype.slice.call(this.timerSections))this.timerSections[section].classList.remove(GogMenuFeaturesSlider.CLASSNAMES.ACTIVE,GogMenuFeaturesSlider.CLASSNAMES.PAUSED,GogMenuFeaturesSlider.CLASSNAMES.ON),this.timerSections[section].classList.add(GogMenuFeaturesSlider.CLASSNAMES.DONE);else this.timerSections[this.currentSlide].classList.remove(GogMenuFeaturesSlider.CLASSNAMES.ACTIVE,GogMenuFeaturesSlider.CLASSNAMES.PAUSED,GogMenuFeaturesSlider.CLASSNAMES.ON);this.slides[this.currentSlide-1].classList.add(GogMenuFeaturesSlider.CLASSNAMES.ACTIVE),this.timerSections[this.currentSlide-1].classList.remove(GogMenuFeaturesSlider.CLASSNAMES.DONE),this.timerSections[this.currentSlide-1].classList.add(GogMenuFeaturesSlider.CLASSNAMES.PAUSED)},GogMenuFeaturesSlider.prototype.reset=function(){this.currentSlide=1,this.element.querySelector("."+GogMenuFeaturesSlider.CLASSNAMES.ACTIVE).classList.remove(GogMenuFeaturesSlider.CLASSNAMES.ACTIVE),this.slides[0].classList.add(GogMenuFeaturesSlider.CLASSNAMES.ACTIVE),this.timer.classList.remove(GogMenuFeaturesSlider.CLASSNAMES.ON),this.remaining=null,this.startTime=0,this.resetTimer(),window.clearTimeout(this.timeoutID)},GogMenuFeaturesSlider.prototype.play=function(){if(this.timerSections[this.currentSlide-1].classList.add(GogMenuFeaturesSlider.CLASSNAMES.ON),null!=this.remaining){this.timeoutID=window.setTimeout(function(){this.nextSlide(),this.intervalIDs.push(window.setInterval(this.nextSlide.bind(this),GogMenuFeaturesSlider.AUTOPLAY_INTERVAL))}.bind(this),this.remaining),this.remaining=null}else this.intervalIDs.push(window.setInterval(this.nextSlide.bind(this),GogMenuFeaturesSlider.AUTOPLAY_INTERVAL));this.timerSections[this.currentSlide-1].classList.remove(GogMenuFeaturesSlider.CLASSNAMES.PAUSED),this.timerSections[this.currentSlide-1].classList.add(GogMenuFeaturesSlider.CLASSNAMES.ON),this.startTime=(new Date).getMilliseconds()},GogMenuFeaturesSlider.prototype.stop=function(){this.clearIntervals(),this.timerSections[this.currentSlide-1].classList.add(GogMenuFeaturesSlider.CLASSNAMES.PAUSED);var timeSinceStart=(new Date).getMilliseconds()-this.startTime;this.remaining=GogMenuFeaturesSlider.AUTOPLAY_INTERVAL-timeSinceStart},GogMenuFeaturesSlider.prototype.destructor=function(){this.visibilityListenerCanceller(),window.clearTimeout(this.timeoutID),this.clearIntervals()},GogMenuFeaturesSlider.prototype.checkState=function(){this.menuDropdown.isExpanded("anonymous")?this.play():(this.stop(),this.reset())},GogMenuFeaturesSlider.prototype.nextSlide=function(userTriggered){void 0===userTriggered&&(userTriggered=!1),this.currentSlide<this.numberOfSlides?this.currentSlide++:(this.currentSlide=1,this.resetTimer()),this.startTime=(new Date).getMilliseconds(),this.element.querySelector("."+GogMenuFeaturesSlider.CLASSNAMES.ACTIVE).classList.remove(GogMenuFeaturesSlider.CLASSNAMES.ACTIVE),this.slides[this.currentSlide-1].classList.add(GogMenuFeaturesSlider.CLASSNAMES.ACTIVE),this.currentSlide>1&&(this.timerSections[this.currentSlide-2].classList.add(GogMenuFeaturesSlider.CLASSNAMES.DONE),this.timerSections[this.currentSlide-2].classList.remove(GogMenuFeaturesSlider.CLASSNAMES.ON)),userTriggered?this.timerSections[this.currentSlide-2]&&this.timerSections[this.currentSlide-2].classList.add(GogMenuFeaturesSlider.CLASSNAMES.DONE):this.timerSections[this.currentSlide-1].classList.add(GogMenuFeaturesSlider.CLASSNAMES.ON)},GogMenuFeaturesSlider.prototype.resetTimer=function(){for(var i=0;i<this.timerSections.length;i++)this.timerSections[i].classList.remove(GogMenuFeaturesSlider.CLASSNAMES.ON,GogMenuFeaturesSlider.CLASSNAMES.PAUSED,GogMenuFeaturesSlider.CLASSNAMES.DONE)},GogMenuFeaturesSlider.prototype.clearIntervals=function(){for(var _i=0,_a=this.intervalIDs;_i<_a.length;_i++){var intervalID=_a[_i];window.clearInterval(intervalID)}this.intervalIDs=[]},GogMenuFeaturesSlider.AUTOPLAY_INTERVAL=5e3,GogMenuFeaturesSlider.CLASSNAMES={ACTIVE:"is-active",PAUSED:"is-paused",ON:"is-on",DONE:"is-done"},GogMenuFeaturesSlider.$inject=["$element","menuDropdown"],GogMenuFeaturesSlider}();exports.GogMenuFeaturesSlider=GogMenuFeaturesSlider},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var angular=__webpack_require__(0),GogMenuLangAndCurrency=function(){function GogMenuLangAndCurrency($element,menuAimFactory,$window,$timeout,gtmEventSender,$http,menuConfig){this.$window=$window,this.$timeout=$timeout,this.gtmEventSender=gtmEventSender,this.$http=$http,this.menuConfig=menuConfig,this.showApplyButton=!1,this.parentMenu=document.querySelector(".js-menu-account"),this.container=$element[0],this.isVisible=!1,this.menuAim=menuAimFactory.getForMenu(this.container),this.currentLanguageCode=this.menuConfig.getLocale(),this.currentCurrencyCode=this.menuConfig.getCurrency(),this.hidingTimeout=!1}return GogMenuLangAndCurrency.prototype.hide=function(){var _this=this,delay=this.menuAim.getActivationDelay();this.hidingTimeout=this.$timeout(function(){_this.isVisible=!1,_this.parentMenu.classList.remove(GogMenuLangAndCurrency.LANG_AND_CURRENCY_VISIBLE_CLASSNAME)},delay)},GogMenuLangAndCurrency.prototype.show=function(){this.isVisible=!0,this.parentMenu.classList.add(GogMenuLangAndCurrency.LANG_AND_CURRENCY_VISIBLE_CLASSNAME)},GogMenuLangAndCurrency.prototype.changeLanguage=function(newLanguageCode){this.currentLanguageCode!=newLanguageCode&&(this.showApplyButton=!0),this.currentLanguageCode=newLanguageCode},GogMenuLangAndCurrency.prototype.changeCurrency=function(newCurrencyCode){this.currentCurrencyCode!=newCurrencyCode&&(this.showApplyButton=!0),this.currentCurrencyCode=newCurrencyCode},GogMenuLangAndCurrency.prototype.applyChanges=function(){this.$http({method:"get",url:this.menuConfig.urls.setUserPreferences(this.currentLanguageCode,this.currentCurrencyCode),withCredentials:!0}).then(this.refresh.bind(this)).catch(angular.noop),this.gtmEventSender.sendEvent({eventCategory:"topBar",eventAction:"Language and Currency Change",eventLabel:this.currentLanguageCode+" "+this.currentCurrencyCode})},GogMenuLangAndCurrency.prototype.cancelHidding=function(){this.$timeout.cancel(this.hidingTimeout)},GogMenuLangAndCurrency.prototype.refresh=function(){this.$window.location.reload()},GogMenuLangAndCurrency.$inject=["$element","menuAimFactory","$window","$timeout","gtmEventSender","$http","menuConfig"],GogMenuLangAndCurrency.LANG_AND_CURRENCY_VISIBLE_CLASSNAME="menu-account--language-and-currency-is-visible",GogMenuLangAndCurrency}();exports.GogMenuLangAndCurrency=GogMenuLangAndCurrency},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var GogMenuSwipe=function(){function GogMenuSwipe($attrs,$element,menuDropdown){this.$attrs=$attrs,this.$element=$element,this.menuDropdown=menuDropdown,this.element=$element[0],this.startPosition={x:0,y:0},this.endPosition={x:0,y:0},this.delta={x:0,y:0},this.visible=!1,this.originalTransform="",this.element.addEventListener("touchstart",this.swipeStart.bind(this)),this.element.addEventListener("touchend",this.swipeEnd.bind(this)),this.element.addEventListener("touchmove",this.swipeMove.bind(this)),this.menuDropdown.registerVisibilityChangedListener(this.reset.bind(this))}return GogMenuSwipe.prototype.getCoordinates=function(event){var touches,e,originalEvent=event.originalEvent||event;return touches=originalEvent.touches&&originalEvent.touches.length?originalEvent.touches:[originalEvent],{x:(e=originalEvent.changedTouches&&originalEvent.changedTouches[0]||touches[0]).clientX,y:e.clientY}},GogMenuSwipe.prototype.toggle=function(){this.visible?(this.element.style.transform="",this.visible=!1):(this.element.style.transform="translateY(-100%) translateY(90px)",this.visible=!0)},GogMenuSwipe.prototype.reset=function(){this.element.classList.remove("is-swiped"),this.element.style.transform=""},GogMenuSwipe.prototype.swipeStart=function(event){event.target.classList.contains("js-no-prevent-default")||(event.preventDefault(),event.stopPropagation()),this.startPosition=this.getCoordinates(event),this.delta={x:0,y:0},this.element.classList.add("is-swiped"),this.originalTransform=this.element.style.transform},GogMenuSwipe.prototype.swipeEnd=function(event){event.target.classList.contains("js-no-prevent-default")||(event.preventDefault(),event.stopPropagation()),this.endPosition=this.getCoordinates(event),this.delta.x=this.startPosition.x-this.endPosition.x,this.delta.y=this.startPosition.y-this.endPosition.y,this.delta.y>0?(this.element.style.transform="translateY(-100%) translateY(90px)",this.visible=!0):this.delta.y<0&&(this.element.style.transform="",this.visible=!1),this.element.classList.remove("is-swiped")},GogMenuSwipe.prototype.swipeMove=function(event){event.target.classList.contains("js-no-prevent-default")||(event.preventDefault(),event.stopPropagation());this.delta.x,this.delta.y;this.delta.x=this.startPosition.x-this.getCoordinates(event).x,this.delta.y=this.startPosition.y-this.getCoordinates(event).y,(this.delta.y<=this.element.offsetHeight-90&&!this.visible||this.delta.y<=0&&this.visible)&&(this.element.style.transform=this.originalTransform+" translateY("+-1*this.delta.y+"px)")},GogMenuSwipe.$inject=["$attrs","$element","menuDropdown"],GogMenuSwipe}();exports.GogMenuSwipe=GogMenuSwipe},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var GogMenuScrollbar=function(){function GogMenuScrollbar($element,$window,$attrs,$timeout,menuScrollWidth,$scope){this.$window=$window,this.$attrs=$attrs,this.$timeout=$timeout,this.lastPageY=0,this.scrollbarInstanceName="",this.isAutohideOn=!1,this.scrollbarWidth=0,this.cancelRefreshObserver=function(){},this.element=$element[0],this.elTarget=this.element.querySelector(GogMenuScrollbar.CONTENT_CLASS),this.elBar=this.element.querySelector(GogMenuScrollbar.BAR_CLASS),this.scrollbarWidth=menuScrollWidth.getWidth(),this.isAutohideOn=0==this.scrollbarWidth,this.moveBarBound=this.moveBar.bind(this),this.dragScrollbarBound=this.dragScrollbar.bind(this),this.stopScrollbarBound=this.stopScrollbar.bind(this),this.onScrollbarMouseDownBound=this.onScrollbarMouseDown.bind(this),this.isNativeScrollbarOS()||this.isAutohideOn||this.initCustomScrollbar(),$scope.$on("$destroy",this.deconstructor.bind(this))}return GogMenuScrollbar.prototype.initCustomScrollbar=function(){this.wrapper=this.element.querySelector(GogMenuScrollbar.WRAPPER_CLASS),this.elTarget.addEventListener("scroll",this.moveBarBound),this.elBar.addEventListener("mousedown",this.onScrollbarMouseDownBound),this.$attrs.hasOwnProperty("gogMenuScrollbarRefresh")&&(this.cancelRefreshObserver=this.$attrs.$observe("gogMenuScrollbarRefresh",this.refreshAfterDOMChanges.bind(this))),this.moveNativeScrollOffscreen()},GogMenuScrollbar.prototype.refresh=function(){this.updateBarHeight(),this.shouldHaveScrollbar()?(this.enableCustomScrollbar(),this.moveNativeScrollOffscreen()):(this.disableCustomScrollbar(),this.resetContentOffset())},GogMenuScrollbar.prototype.refreshAfterDOMChanges=function(){this.$timeout(this.refresh.bind(this),0,!1)},GogMenuScrollbar.prototype.isNativeScrollbarOS=function(){return!!GogMenuScrollbar.NATIVE_SCROLL_OS_REGEXP.test(navigator.userAgent)},GogMenuScrollbar.prototype.moveNativeScrollOffscreen=function(){this.elTarget.style.width="calc(100% + "+this.scrollbarWidth+"px)"},GogMenuScrollbar.prototype.resetContentOffset=function(){this.elTarget.style.width="100%"},GogMenuScrollbar.prototype.shouldHaveScrollbar=function(){return this.scrollRatio<1},GogMenuScrollbar.prototype.enableCustomScrollbar=function(){this.elBar.classList.remove("is-disabled")},GogMenuScrollbar.prototype.disableCustomScrollbar=function(){this.elBar.classList.add("is-disabled")},GogMenuScrollbar.prototype.onScrollbarMouseDown=function(e){return this.lastPageY=e.pageY,this.elBar.classList.add("is-grabbed"),this.$window.document.body.classList.add(GogMenuScrollbar.DISABLE_TEXT_SELECTION_CLASS),this.$window.document.addEventListener("mousemove",this.dragScrollbarBound),this.$window.document.addEventListener("mouseup",this.stopScrollbarBound),!1},GogMenuScrollbar.prototype.dragScrollbar=function(e){var _this=this,delta=e.pageY-this.lastPageY;this.lastPageY=e.pageY,this.$window.requestAnimationFrame(function(){_this.elTarget.scrollTop+=delta/_this.scrollRatio})},GogMenuScrollbar.prototype.stopScrollbar=function(e){this.element.classList.remove("is-grabbed"),this.$window.document.body.classList.remove(GogMenuScrollbar.DISABLE_TEXT_SELECTION_CLASS),this.$window.document.removeEventListener("mousemove",this.dragScrollbarBound),this.$window.document.removeEventListener("mouseup",this.stopScrollbarBound)},GogMenuScrollbar.prototype.updateBarHeight=function(){var totalHeight=this.elTarget.scrollHeight,ownHeight=this.elTarget.clientHeight;this.scrollRatio=ownHeight/totalHeight,this.elBar.style.height=100*this.scrollRatio+"%"},GogMenuScrollbar.prototype.moveBar=function(e){var _this=this;this.$window.requestAnimationFrame(function(){_this.elBar.style.top=_this.elTarget.scrollTop/_this.elTarget.scrollHeight*100+"%"})},GogMenuScrollbar.prototype.deconstructor=function(){this.cancelScrollTopListener(),this.cancelRefreshObserver(),this.$window.document.removeEventListener("mousemove",this.dragScrollbarBound),this.$window.document.removeEventListener("mouseup",this.stopScrollbarBound),this.elTarget.removeEventListener("scroll",this.moveBarBound),this.elBar.removeEventListener("mousedown",this.onScrollbarMouseDownBound)},GogMenuScrollbar.$inject=["$element","$window","$attrs","$timeout","menuScrollWidth","$scope"],GogMenuScrollbar.DEFAULT_SCROLL_WIDTH=18,GogMenuScrollbar.BAR_CLASS=".js-gog-scrollbar-bar",GogMenuScrollbar.WRAPPER_CLASS=".js-gog-scrollbar-wrapper",GogMenuScrollbar.CONTENT_CLASS=".js-gog-scrollbar-content",GogMenuScrollbar.DISABLE_TEXT_SELECTION_CLASS="_gog-menu-scrollbar-disable-select",GogMenuScrollbar.NATIVE_SCROLL_OS_REGEXP=/Android|webOS|iPhone|iPad|BlackBerry|Windows Phone|Opera Mini|Mobile/i,GogMenuScrollbar}();exports.GogMenuScrollbar=GogMenuScrollbar},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var GogMenuCartItemSwipe=function(){function GogMenuCartItemSwipe($attrs,$element,$window){this.$attrs=$attrs,this.$element=$element,this.$window=$window,this.element=$element[0],this.startPosition={x:0,y:0},this.endPosition={x:0,y:0},this.delta={x:0,y:0},this.originalTransform="",this.snapPoints=[-126,0,126],this.actionPoints=[{position:-252,action:this.remove.bind(this)},{position:252,action:this.addToWishlist.bind(this)}],this.positionX=0,this.originalPositionX=0,this.leftButton=this.element.querySelector(".js-action-left"),this.rightButton=this.element.querySelector(".js-action-right"),this.$attrs.$observe("gogMenuCartItemSwipeDisableWishlisting",this.disableWishlistAction.bind(this)),this.element.addEventListener("touchstart",this.swipeStart.bind(this)),this.element.addEventListener("touchend",this.swipeEnd.bind(this)),this.element.addEventListener("touchmove",this.swipeMove.bind(this))}return GogMenuCartItemSwipe.prototype.disableWishlistAction=function(disabled){"true"===disabled&&(this.snapPoints=[-126,0],this.actionPoints=[{position:-252,action:this.remove.bind(this)}])},GogMenuCartItemSwipe.prototype.remove=function(){this.rightButton.click()},GogMenuCartItemSwipe.prototype.addToWishlist=function(){this.leftButton.click()},GogMenuCartItemSwipe.prototype.getCoordinates=function(event){var touches,originalEvent=event.originalEvent||event;touches=originalEvent.touches&&originalEvent.touches.length?originalEvent.touches:[originalEvent];var e=originalEvent.changedTouches&&originalEvent.changedTouches[0]||touches[0];return{x:e.clientX,y:e.clientY}},GogMenuCartItemSwipe.prototype.swipeStart=function(event){this.startPosition=this.getCoordinates(event),this.element.classList.add("is-swping"),this.originalTransform=this.element.style.transform,this.originalPositionX=this.positionX,this.positionX=0},GogMenuCartItemSwipe.prototype.executeActionOnPosition=function(position){for(var _i=0,_a=this.actionPoints;_i<_a.length;_i++){var actionPoint=_a[_i];if(actionPoint.position>0&&position>actionPoint.position||actionPoint.position<0&&position<actionPoint.position)return actionPoint.action(),this.reset(),!0}return!1},GogMenuCartItemSwipe.prototype.snapToPosition=function(position){for(var _i=0,_a=this.snapPoints;_i<_a.length;_i++){var snap=_a[_i];if(snap>=0&&position>snap-40&&position<snap+40||snap<0&&position<snap+40&&position>snap-40)return this.element.style.transform="translateX("+snap+"px)",this.positionX=snap,!0}return!1},GogMenuCartItemSwipe.prototype.reset=function(){this.element.style.transform="translateX(0px)",this.positionX=0},GogMenuCartItemSwipe.prototype.swipeEnd=function(event){(this.endPosition=this.getCoordinates(event),this.delta.x=this.startPosition.x-this.endPosition.x,this.delta.y=this.startPosition.y-this.endPosition.y,this.positionX=-1*this.delta.x+this.originalPositionX,this.element.classList.remove("is-swping"),this.executeActionOnPosition(this.positionX))||(this.snapToPosition(this.positionX)||(this.element.style.transform="translateX(0px)",this.positionX=0))},GogMenuCartItemSwipe.prototype.swipeMove=function(event){this.delta.x,this.delta.y;this.delta.x=this.startPosition.x-this.getCoordinates(event).x,this.delta.y=this.startPosition.y-this.getCoordinates(event).y,this.positionX=this.delta.x,this.element.style.transform=this.originalTransform+"translateX("+-1*this.delta.x+"px)"},GogMenuCartItemSwipe.$inject=["$attrs","$element","$window"],GogMenuCartItemSwipe}();exports.GogMenuCartItemSwipe=GogMenuCartItemSwipe},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuDropdown=function(){function MenuDropdown($window,listenersManager){this.$window=$window,this.listenersManager=listenersManager,this.expanded={store:!1,galaxy:!1,search:!1,account:!1,friends:!1,cart:!1,notifications:!1,anonymous:!1},this.menuVisibilityChangedListenersManager=listenersManager.getManager(),this.menuVisibilityChangeTriggeredListenersManager=listenersManager.getManager()}return MenuDropdown.prototype.registerVisibilityChangedListener=function(callback){return this.menuVisibilityChangedListenersManager.addListener(callback)},MenuDropdown.prototype.registerVisibilityChangeTriggeredListener=function(callback){return this.menuVisibilityChangeTriggeredListenersManager.addListener(callback)},MenuDropdown.prototype.isExpanded=function(menuName){return this.expanded[menuName]},MenuDropdown.prototype.setState=function(menuName,isExpanded){this.expanded[menuName]=isExpanded,this.menuVisibilityChangedListenersManager.callListeners(menuName,isExpanded)},MenuDropdown.prototype.triggerExpand=function(menuName){this.menuVisibilityChangeTriggeredListenersManager.callListeners(menuName,!0),this.setState(menuName,!0)},MenuDropdown.prototype.triggerCollapse=function(menuName){this.menuVisibilityChangeTriggeredListenersManager.callListeners(menuName,!1),this.setState(menuName,!1)},MenuDropdown.prototype.getState=function(){return this.expanded},MenuDropdown.prototype.hideAll=function(){for(var menuName in this.expanded)this.expanded[menuName]&&this.triggerCollapse(menuName)},MenuDropdown.prototype.anyExpanded=function(){for(var menuName in this.expanded)if(this.expanded[menuName])return!0;return!1},MenuDropdown.$inject=["$window","listenersManager"],MenuDropdown}();exports.MenuDropdown=MenuDropdown},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuCartCtrl=function(){function MenuCartCtrl(cart,menuConfig,menuDropdown,menuRedirect,$window,gtmEventSender,$timeout,menuGalaxyAccounts,menuAccount){this.cart=cart,this.menuConfig=menuConfig,this.menuDropdown=menuDropdown,this.menuRedirect=menuRedirect,this.$window=$window,this.gtmEventSender=gtmEventSender,this.$timeout=$timeout,this.menuGalaxyAccounts=menuGalaxyAccounts,this.menuAccount=menuAccount,this.refreshScroll=!1,this.itemAdded=!1,this.itemAddedAnimation=!1,this.isSpinnerVisible=!1,this.isWishlistButtonVisible=!1,this.menuDropdown.registerVisibilityChangedListener(this.menuVisibilityChanged.bind(this)),this.menuAccount.registerAccountListener(this.checkUserStatus.bind(this)),this.cart.registerBeforeCartUpdateListener(this.notifyUser.bind(this)),this.cart.registerBeforeCartUpdateListener(this.showSpinner.bind(this)),this.cart.registerAfterCartUpdateListener(this.updateView.bind(this)),this.cart.registerAfterCartUpdateListener(this.hideSpinner.bind(this)),this.updateView()}return MenuCartCtrl.prototype.goToCheckout=function(){var _this=this;this.showSpinner(),this.gtmEventSender.sendEvent({eventCategory:"topBar",eventAction:"checkoutNow",eventLabel:this.$window.location.pathname}),this.menuAccount.isUserLoggedIn?this.$window.location.pathname=this.menuConfig.urls.checkout:this.menuRedirect.set("checkout",function(){_this.menuGalaxyAccounts.openLoginForm()})},MenuCartCtrl.prototype.checkUserStatus=function(){this.menuAccount.isUserLoggedIn&&(this.isWishlistButtonVisible=!0)},MenuCartCtrl.prototype.menuVisibilityChanged=function(){this.menuDropdown.isExpanded("cart")&&(this.itemAdded=!1)},MenuCartCtrl.prototype.playAnimation=function(){var _this=this;this.itemAddedAnimation=!0;this.$timeout(function(){_this.itemAddedAnimation=!1},1e3)},MenuCartCtrl.prototype.itemWasAdded=function(){this.itemAdded=!0,this.playAnimation()},MenuCartCtrl.prototype.notifyUser=function(){var newCartCount=this.cart.getCount();this.cartCount<newCartCount&&this.itemWasAdded(),this.cartCount=newCartCount},MenuCartCtrl.prototype.updateView=function(){this.products=this.sortProducts(this.cart.getProducts()),this.cartCount=this.cart.getCount(),this.realCartCount=this.cart.getCount(),this.isCartEmpty=0==this.cartCount,this.cartTotalPrice=this.cart.getTotalPrice(),this.isWishlistButtonVisible=this.menuAccount.isUserLoggedIn},MenuCartCtrl.prototype.showSpinner=function(){this.isSpinnerVisible=!0},MenuCartCtrl.prototype.hideSpinner=function(){this.isSpinnerVisible=!1},MenuCartCtrl.prototype.sortProducts=function(products){return products.slice(0).reverse()},MenuCartCtrl.$inject=["cart","menuConfig","menuDropdown","menuRedirect","$window","gtmEventSender","$timeout","menuGalaxyAccounts","menuAccount"],MenuCartCtrl}();exports.MenuCartCtrl=MenuCartCtrl;var MenuGalaxyCartCtrl=function(){function MenuGalaxyCartCtrl(cart,menuDropdown,$timeout,menuGalaxyActions,menuConfig){this.cart=cart,this.menuDropdown=menuDropdown,this.$timeout=$timeout,this.menuGalaxyActions=menuGalaxyActions,this.menuConfig=menuConfig,this.refreshScroll=!1,this.itemAdded=!1,this.itemAddedAnimation=!1,this.isSpinnerVisible=!0,this.menuDropdown.registerVisibilityChangedListener(this.menuVisibilityChanged.bind(this)),this.cart.registerBeforeCartUpdateListener(this.notifyUser.bind(this)),this.cart.registerBeforeCartUpdateListener(this.showSpinner.bind(this)),this.cart.registerAfterCartUpdateListener(this.updateView.bind(this)),this.cart.registerAfterCartUpdateListener(this.hideSpinner.bind(this)),this.updateView()}return MenuGalaxyCartCtrl.prototype.goToCheckout=function(){this.menuDropdown.triggerCollapse("cart"),this.menuGalaxyActions.showInStoreFrame(this.menuConfig.gogEmbedHostname+this.menuConfig.urls.checkout)},MenuGalaxyCartCtrl.prototype.menuVisibilityChanged=function(){this.menuDropdown.isExpanded("cart")&&(this.itemAdded=!1)},MenuGalaxyCartCtrl.prototype.playAnimation=function(){var _this=this;this.itemAddedAnimation=!0;this.$timeout(function(){_this.itemAddedAnimation=!1},1e3)},MenuGalaxyCartCtrl.prototype.itemWasAdded=function(){this.itemAdded=!0,this.playAnimation()},MenuGalaxyCartCtrl.prototype.notifyUser=function(){var newCartCount=this.cart.getCount();this.cartCount<newCartCount&&this.itemWasAdded(),this.cartCount=newCartCount},MenuGalaxyCartCtrl.prototype.updateView=function(){this.products=this.sortProducts(this.cart.getProducts()),this.cartCount=this.cart.getCount(),this.realCartCount=this.cart.getCount(),this.isCartEmpty=0==this.cartCount,this.cartTotalPrice=this.cart.getTotalPrice()},MenuGalaxyCartCtrl.prototype.showSpinner=function(){this.isSpinnerVisible=!0},MenuGalaxyCartCtrl.prototype.hideSpinner=function(){this.isSpinnerVisible=!1},MenuGalaxyCartCtrl.prototype.sortProducts=function(products){return products.slice(0).reverse()},MenuGalaxyCartCtrl.$inject=["menuCart","menuDropdown","$timeout","menuGalaxyActions","menuConfig"],MenuGalaxyCartCtrl}();exports.MenuGalaxyCartCtrl=MenuGalaxyCartCtrl},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuAccount=function(){function MenuAccount($window,listenersManager,menuConfig,menuDataClientFactory,menuDropdown,menuBasicUserData){this.menuDropdown=menuDropdown,this.menuBasicUserData=menuBasicUserData,this.userGamesCount=0,this.userMoviesCount=0,this.userWishlistedItemsCount=0,this.userWalletBalance={amount:0},this.profileState="enabled",this.accountListenersManager=listenersManager.getManager(),this.profileStateListenersManager=listenersManager.getManager(),this.isUserLoggedIn=!1,this.username=MenuAccount.LOGGED_OUT_USERNAME,this.avatar=MenuAccount.LOGGED_OUT_AVATAR;var currentCurrency=menuConfig.getCurrency();this.accountDataClient=menuDataClientFactory.getForEndpoint(menuConfig.urls.accountData,"accountData_"+currentCurrency,!1),this.menuDropdown.registerVisibilityChangedListener(this.menuVisibilityChanged.bind(this)),this.updateAccountBasic(this.menuBasicUserData.getUserData()),this.menuBasicUserData.registerUserDataListener(this.updateAccountBasic.bind(this)),this.accountDataClient.registerDataListener(this.updateAccountStats.bind(this)),this.accountDataClient.isDataAvailable()&&this.updateAccountStats(),$window.gogEventBus.subscribe("profileState","update",this.profileStateChanged.bind(this))}return MenuAccount.prototype.menuVisibilityChanged=function(menuName,isExpanded){"account"==menuName&&isExpanded&&this.fetchAccountStats()},MenuAccount.prototype.fetchAccountStats=function(){this.accountDataClient.fetchData()},MenuAccount.prototype.registerAccountListener=function(listener){return this.accountListenersManager.addListener(listener)},MenuAccount.prototype.registerProfileStateListener=function(listener){return this.profileStateListenersManager.addListener(listener)},MenuAccount.prototype.getProfileState=function(){return this.profileState},MenuAccount.prototype.getUsername=function(){return this.username},MenuAccount.prototype.getUserAvatar=function(){return this.avatar},MenuAccount.prototype.getUserAvatars=function(){return this.avatars},MenuAccount.prototype.getUserGamesCount=function(){return this.userGamesCount},MenuAccount.prototype.getUserMoviesCount=function(){return this.userMoviesCount},MenuAccount.prototype.getUserWishlistedItemsCount=function(){return this.userWishlistedItemsCount},MenuAccount.prototype.getUserWalletBalance=function(){return this.userWalletBalance},MenuAccount.prototype.profileStateChanged=function(eventData){this.profileState=eventData.state,this.profileStateListenersManager.callListeners()},MenuAccount.prototype.updateAccountBasic=function(basicUserData){null===basicUserData?(this.username=MenuAccount.LOGGED_OUT_USERNAME,this.avatar=MenuAccount.LOGGED_OUT_AVATAR):(this.username=basicUserData.username,this.avatar=basicUserData.avatar.url,this.avatars=basicUserData.avatars,this.profileState=basicUserData.profileState),this.isUserLoggedIn=this.menuBasicUserData.isUserLoggedIn(),this.accountListenersManager.callListeners()},MenuAccount.prototype.updateAccountStats=function(){var accountData=this.accountDataClient.getData();Object.keys(accountData).length&&(this.userGamesCount=accountData.purchasedItems.games||0,this.userMoviesCount=accountData.purchasedItems.movies||0,this.userWishlistedItemsCount=accountData.wishlistedItems||0,this.userWalletBalance=accountData.walletBalance||0,this.accountListenersManager.callListeners())},MenuAccount.$inject=["$window","listenersManager","menuConfig","menuDataClientFactory","menuDropdown","menuBasicUserData"],MenuAccount.LOGGED_OUT_USERNAME="",MenuAccount.LOGGED_OUT_AVATAR="",MenuAccount}();exports.MenuAccount=MenuAccount},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuAnonymousCtrl=function(){function MenuAnonymousCtrl(menuBasicUserData,menuDropdown,menuGalaxyAccounts){this.menuDropdown=menuDropdown,this.menuGalaxyAccounts=menuGalaxyAccounts,this.isUserLoggedIn=!1,this.isResponseFetched=!1,this.isResponseFetched=!1,menuBasicUserData.registerUserDataListener(this.checkUserStatus.bind(this));var currentUserBasicData=menuBasicUserData.getUserData();null!==currentUserBasicData?this.checkUserStatus(currentUserBasicData):this.isResponseFetched=!1}return MenuAnonymousCtrl.prototype.openLogin=function(){this.menuGalaxyAccounts.openLoginForm(),this.menuDropdown.triggerCollapse("anonymous")},MenuAnonymousCtrl.prototype.openRegistration=function(){this.menuGalaxyAccounts.openRegistrationForm(),this.menuDropdown.triggerCollapse("anonymous")},MenuAnonymousCtrl.prototype.checkUserStatus=function(currentUserBasicData){this.isUserLoggedIn=currentUserBasicData.isLoggedIn,this.isResponseFetched=!0},MenuAnonymousCtrl.$inject=["menuBasicUserData","menuDropdown","menuGalaxyAccounts"],MenuAnonymousCtrl}();exports.MenuAnonymousCtrl=MenuAnonymousCtrl},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuInternetConnectionStatus=function(){function MenuInternetConnectionStatus(listenersManager,$window){this.$window=$window,this.internetConnectionStatusListenersManager=listenersManager.getManager();var connectionStatusChangedBound=this.connectionStatusChanged.bind(this);this.$window.addEventListener("online",connectionStatusChangedBound),this.$window.addEventListener("offline",connectionStatusChangedBound)}return MenuInternetConnectionStatus.prototype.isConnected=function(){return this.$window.navigator.onLine},MenuInternetConnectionStatus.prototype.registerConnectivityChangeListener=function(callback){return this.internetConnectionStatusListenersManager.addListener(callback)},MenuInternetConnectionStatus.prototype.connectionStatusChanged=function(){this.internetConnectionStatusListenersManager.callListeners(this.$window.navigator.onLine)},MenuInternetConnectionStatus.$inject=["listenersManager","$window"],MenuInternetConnectionStatus}();exports.MenuInternetConnectionStatus=MenuInternetConnectionStatus},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuInternetConnectivityStateProvider=function(){function MenuInternetConnectivityStateProvider(){this.$get=function(){throw new Error("MenuState needs to have connectivity status service provided")}}return MenuInternetConnectivityStateProvider.prototype.setInternetConnectivityProvider=function(connectivityServiceName){this.$get=[connectivityServiceName,function(connectivityService){return connectivityService}]},MenuInternetConnectivityStateProvider}();exports.MenuInternetConnectivityStateProvider=MenuInternetConnectivityStateProvider},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuAccountCtrl=function(){function MenuAccountCtrl(menuAccount,menuLogout,menuConfig,$scope){this.menuAccount=menuAccount,this.menuLogout=menuLogout,this.menuConfig=menuConfig,this.isUserLoggedIn=!1,this.isUserProfileEnabled=!0,this.defaultAccountPage="/account",this.updateAccountData(),this.accountListenerCanceller=this.menuAccount.registerAccountListener(this.updateAccountData.bind(this)),this.profileStateListenerCanceller=this.menuAccount.registerProfileStateListener(this.updateProfileState.bind(this)),$scope.$on("$destroy",this.deconstructor.bind(this))}return MenuAccountCtrl.prototype.logout=function(){this.menuLogout.logout()},MenuAccountCtrl.prototype.deconstructor=function(){this.accountListenerCanceller(),this.profileStateListenerCanceller()},MenuAccountCtrl.prototype.updateAccountData=function(){this.isUserLoggedIn=this.menuAccount.isUserLoggedIn,this.username=this.menuAccount.getUsername(),this.userAvatar=this.menuAccount.getUserAvatar(),this.userAvatars=this.menuAccount.getUserAvatars(),this.userGamesCount=this.menuAccount.getUserGamesCount(),this.userMoviesCount=this.menuAccount.getUserMoviesCount(),this.userWalletBalance=this.menuAccount.getUserWalletBalance().amount,this.userWishlistedItemsCount=this.menuAccount.getUserWishlistedItemsCount(),this.updateProfileState()},MenuAccountCtrl.prototype.updateProfileState=function(){this.isUserProfileEnabled="enabled"===this.menuAccount.getProfileState(),this.defaultAccountPage=this.isUserProfileEnabled?this.menuConfig.urls.feed:this.menuConfig.urls.account},MenuAccountCtrl.$inject=["menuAccount","menuLogout","menuConfig","$scope"],MenuAccountCtrl}();exports.MenuAccountCtrl=MenuAccountCtrl},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuSearch_1=__webpack_require__(1),MenuSearchCtrl=function(){function MenuSearchCtrl(menuSearch,gtmEventSender,debounce,$element,menuDropdown,$scope){this.menuSearch=menuSearch,this.gtmEventSender=gtmEventSender,this.debounce=debounce,this.$element=$element,this.menuDropdown=menuDropdown,this.$scope=$scope,this.searchTerm="",this.selectedCategory="",this.selectedCategoryProducts=[],this.isLoading=!1,this.totalMovies=0,this.totalGames=0,this.displayedMoviesCount=0,this.displayedGamesCount=0,this.searchCount=0,this.shouldBeAnimated=!1,this.menuContainer=document.querySelector(".js-menu-container"),this.searchContainer=$element[0],this.inputElement=$element[0].querySelector(MenuSearchCtrl.INPUT_CLASS),this.menuSearch.registerResultsReadyListener(this.resultsReady.bind(this)),this.menuSearch.registerCategoryChangedListener(this.categoryChanged.bind(this)),this.menuSearch.registerAfterResetListener(this.afterReset.bind(this)),this.menuDropdown.registerVisibilityChangedListener(this.visibilityChanged.bind(this))}return MenuSearchCtrl.prototype.clear=function(){this.searchTerm="",this.menuSearch.reset()},MenuSearchCtrl.prototype.searchTermChange=function(){this.isSearchTermValid()&&(this.isLoading=!0,this.menuSearch.search(this.searchTerm),this.sendEventDebounced()),0==this.searchTerm.length&&this.menuSearch.reset()},MenuSearchCtrl.prototype.showMovies=function(){this.shouldBeAnimated=!1,this.menuSearch.totalMovies>this.menuSearch.displayedMoviesCount?(this.isLoading=!0,this.menuSearch.searchMovies(this.searchTerm)):this.menuSearch.selectCategory("movies")},MenuSearchCtrl.prototype.showGames=function(){this.shouldBeAnimated=!1,this.menuSearch.selectCategory("games")},MenuSearchCtrl.prototype.afterReset=function(){this.searchTerm="",this.$scope.$applyAsync()},MenuSearchCtrl.prototype.visibilityChanged=function(menuName,isExpanded){"search"==menuName&&(isExpanded?this.inputElement.focus():this.menuSearch.reset())},MenuSearchCtrl.prototype.isSearchTermValid=function(){return this.searchTerm.length>1},MenuSearchCtrl.prototype.categoryChanged=function(){this.selectedCategory=this.menuSearch.getCategory(),this.selectedCategoryProducts=this.menuSearch.getResults()},MenuSearchCtrl.prototype.resultsReady=function(){this.isLoading=!1,this.totalMovies=this.menuSearch.totalMovies,this.totalGames=this.menuSearch.totalGames,this.displayedMoviesCount=this.menuSearch.displayedMoviesCount,this.displayedGamesCount=this.menuSearch.displayedGamesCount,this.searchCount=this.menuSearch.searchCount,1==this.searchCount&&(this.shouldBeAnimated=!0),this.menuSearch.selectCategory(this.selectedCategory),this.selectedCategoryProducts=this.menuSearch.getResults()},MenuSearchCtrl.prototype.sendEvent=function(){this.gtmEventSender.sendEvent({eventAction:"siteSearchMenu",eventCategory:"topBar",eventLabel:this.searchTerm})},MenuSearchCtrl.prototype.sendEventDebounced=function(){this.debounce(this.sendEvent,MenuSearch_1.MenuSearch.SEND_EVENT_DELAY,!1,!1)},MenuSearchCtrl.$inject=["menuSearch","gtmEventSender","debounce","$element","menuDropdown","$scope"],MenuSearchCtrl.INPUT_CLASS=".js-menu-search-input",MenuSearchCtrl}();exports.MenuSearchCtrl=MenuSearchCtrl},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuGamesCtrl=function(){function MenuGamesCtrl(menuGames,menuDropdown){this.menuGames=menuGames,this.menuDropdown=menuDropdown,this.customCategoriesCount=0,this.selectedCategoryNumber=0,this.selectedCategory=this.menuGames.selectedCategory,this.categories=Object.keys(this.menuGames.categories),this.customCategories=this.menuGames.getCustomCategories(),this.customCategoriesCount=Object.keys(this.customCategories).length,this.menuGames.registerCategoryChangeListener(this.updateCategory.bind(this)),this.menuGames.registerCustomCategoriesListener(this.updateCustomCategories.bind(this)),this.menuGames.registerGameDataChangeListener(this.updateGameData.bind(this)),this.menuDropdown.registerVisibilityChangedListener(this.checkState.bind(this))}return MenuGamesCtrl.prototype.selectCategory=function(category){this.menuGames.selectCategory(category)},MenuGamesCtrl.prototype.holdCategory=function(){this.menuGames.holdCategory()},MenuGamesCtrl.prototype.hideCateogry=function(){this.menuGames.hideCategory()},MenuGamesCtrl.prototype.hasCategory=function(name){return-1!==this.categories.indexOf(name)},MenuGamesCtrl.prototype.updateGameData=function(){this.categories=Object.keys(this.menuGames.categories),this.updateCategory(),this.updateCustomCategories()},MenuGamesCtrl.prototype.updateCustomCategories=function(){this.customCategories=this.menuGames.getCustomCategories(),this.customCategoriesCount=Object.keys(this.customCategories).length},MenuGamesCtrl.prototype.checkState=function(){this.menuDropdown.isExpanded("store")&&this.menuGames.hideCategory()},MenuGamesCtrl.prototype.updateCategory=function(){this.isLayerExpanded=this.menuGames.isLayerExpanded,this.selectedCategory=this.menuGames.selectedCategory,void 0!==this.selectedCategory&&this.findSelectedCategoryNumber()},MenuGamesCtrl.prototype.findSelectedCategoryNumber=function(){this.selectedCategoryNumber=Object.keys(this.customCategories).indexOf(this.selectedCategory.name)+1},MenuGamesCtrl.$inject=["menuGames","menuDropdown"],MenuGamesCtrl}();exports.MenuGamesCtrl=MenuGamesCtrl},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuFriendsCtrl=function(){function MenuFriendsCtrl(menuDropdown,menuFriends,menuFriendsPresence,menuBasicUserData,$timeout,$filter){this.menuDropdown=menuDropdown,this.menuFriends=menuFriends,this.menuFriendsPresence=menuFriendsPresence,this.menuBasicUserData=menuBasicUserData,this.$timeout=$timeout,this.$filter=$filter,this.isVisible=!1,this.isLoadingFriendlist=!1,this.friendListFetched=!1,this.friendsList=[],this.online=0,this.total=0,this.menuDropdown.registerVisibilityChangedListener(this.visibilityChanged.bind(this)),this.menuFriends.registerFriendsListListener(this.friendsListReady.bind(this)),this.menuFriendsPresence.registerPresenceUpdatedListener(this.updatePresence.bind(this)),this.menuBasicUserData.registerUserDataListener(this.checkUserStatus.bind(this)),this.checkUserStatus()}return MenuFriendsCtrl.prototype.visibilityChanged=function(){var _this=this;this.menuDropdown.isExpanded("friends")&&!this.friendListFetched&&(this.$timeout(function(){_this.menuFriends.fetchFriendsList()},300),this.isLoadingFriendlist=!0,this.friendListFetched=!0)},MenuFriendsCtrl.prototype.checkUserStatus=function(){this.menuBasicUserData.isUserLoggedIn()?(this.isVisible=!0,this.menuFriends.restoreFriendListFromCache()):this.isVisible=!1},MenuFriendsCtrl.prototype.updatePresence=function(){for(var key in this.friendsList){var friend=this.friendsList[key];this.friendsList[key].isOnline=!1,this.friendsList[key].haveRichStatus=!1,this.friendsList[key].status="";for(var _i=0,avaiableFriends_1=this.menuFriendsPresence.getAvailableUsers();_i<avaiableFriends_1.length;_i++){var availableFriend=avaiableFriends_1[_i];if(friend.userId==availableFriend.user_id){this.friendsList[key].isOnline=!0,availableFriend.data.status&&(this.friendsList[key].haveRichStatus=!0,this.friendsList[key].status=availableFriend.data.status);break}}}this.friendsList=this.sortFriendList(this.friendsList),this.online=this.menuFriendsPresence.getAvailableUsers().length},MenuFriendsCtrl.prototype.sortFriendList=function(friendsList){return this.$filter("orderBy")(friendsList,["-isOnline","username"])},MenuFriendsCtrl.prototype.friendsListReady=function(){this.friendsList=this.menuFriends.getFriendsList(),this.updatePresence(),this.isLoadingFriendlist=!1,this.total=this.friendsList.length;for(var usersIds=[],_i=0,_a=this.friendsList;_i<_a.length;_i++){var friend=_a[_i];usersIds.push(friend.userId)}this.menuFriendsPresence.setUsers(usersIds)},MenuFriendsCtrl.$inject=["menuDropdown","menuFriends","menuFriendsPresence","menuBasicUserData","$timeout","$filter"],MenuFriendsCtrl}();exports.MenuFriendsCtrl=MenuFriendsCtrl},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var angular=__webpack_require__(0),MenuGames=function(){function MenuGames(productRepositoriesManager,$window,$timeout,menuAimFactory,listenersManager,productsRepositoryFactory,menuConfig,menuDataClientPerUserFactory){this.productRepositoriesManager=productRepositoriesManager,this.$window=$window,this.$timeout=$timeout,this.menuAimFactory=menuAimFactory,this.listenersManager=listenersManager,this.productsRepositoryFactory=productsRepositoryFactory,this.menuConfig=menuConfig,this.menuDataClientPerUserFactory=menuDataClientPerUserFactory,this.selectedCategory=null,this.categories={},this.customCategories={},this.storeGamesClient={};try{this.productsRepository=this.productsRepositoryFactory.createMenuProductsRepository("menuStoreProducts")}catch(e){this.productsRepository=this.productRepositoriesManager.getRepository("menuStoreProducts")}this.gameDataChangeListeners=listenersManager.getManager(),this.categoryChangeListeners=listenersManager.getManager(),this.customCategoriesListeners=listenersManager.getManager(),this.menuConfig.registerLocaleListener(this.setCurrentLocale.bind(this)),this.menuConfig.registerCurrencyListener(this.setCurrentCurrency.bind(this)),this.menuConfig.registerCountryListener(this.setCurrentCountry.bind(this)),this.storeGamesListenerCanceller=angular.noop,this.currentLocale=this.menuConfig.getLocale(),this.currentCountry=this.menuConfig.getCountry(),this.currentCurrency=this.menuConfig.getCurrency(),this.setStoreGames(),this.menuAim=this.menuAimFactory.getForMenu(this.$window.document.querySelector(".js-menu-sloped-submenu")),this.layerTimeout=!1,this.layerLoadingTimeout=!1}return MenuGames.prototype.registerGameDataChangeListener=function(callback){this.gameDataChangeListeners.addListener(callback)},MenuGames.prototype.registerCategoryChangeListener=function(callback){this.categoryChangeListeners.addListener(callback)},MenuGames.prototype.registerCustomCategoriesListener=function(callback){this.customCategoriesListeners.addListener(callback)},MenuGames.prototype.selectCategory=function(category,activationDelayed){void 0===activationDelayed&&(activationDelayed=!0),this.$timeout.cancel(this.layerLoadingTimeout);var delay=0;activationDelayed&&(delay=this.menuAim.getActivationDelay());this.layerLoadingTimeout=this.$timeout(function(){category in this.categories?(this.selectedCategory=this.categories[category],this.showCategory()):(this.selectedCategory={name:category},this.categoryChangeListeners.callListeners())}.bind(this),delay)},MenuGames.prototype.holdCategory=function(){this.$timeout.cancel(this.layerTimeout),this.$timeout.cancel(this.layerLoadingTimeout),this.isLayerExpanded=!0},MenuGames.prototype.hideCategory=function(){this.isLayerExpanded=!1,this.selectedCategory=this.categories[MenuGames.DEFAULT_CATEGORY],this.categoryChangeListeners.callListeners()},MenuGames.prototype.getCustomCategories=function(){return this.customCategories},MenuGames.prototype.setStoreGames=function(){this.storeGamesListenerCanceller(),this.storeGamesClient=this.menuDataClientPerUserFactory.getForEndpointPerUser(this.menuConfig.urls.storeMenuProducts,"storeGamesData_"+this.currentLocale+"_"+this.currentCountry+"_"+this.currentCurrency,!0),this.storeGamesClient.isDataAvailable()&&this.setCategories(),this.storeGamesListenerCanceller=this.storeGamesClient.registerDataListener(this.setCategories.bind(this))},MenuGames.prototype.setCurrentLocale=function(currentLocale){this.currentLocale=currentLocale,this.setStoreGames()},MenuGames.prototype.setCurrentCurrency=function(currentCurrency){this.currentCurrency=currentCurrency,this.setStoreGames()},MenuGames.prototype.setCurrentCountry=function(currentCountry){this.currentCountry=currentCountry,this.setStoreGames()},MenuGames.prototype.addProductsToProductsRepository=function(){for(var category in this.categories)void 0!==this.categories[category].products&&this.productsRepository.addProducts(this.categories[category].products)},MenuGames.prototype.setCategories=function(){this.categories=this.storeGamesClient.getData(),this.selectedCategory=this.categories[MenuGames.DEFAULT_CATEGORY],this.customCategories=this.filterCustomCategories(this.categories),this.addProductsToProductsRepository(),this.customCategoriesListeners.callListeners(),this.updateGamePrices(this.categories)},MenuGames.prototype.updateGamePrices=function(categories){var newPrices={};for(var category in categories)if(void 0!==categories[category].products)for(var _i=0,products_1=categories[category].products;_i<products_1.length;_i++){var product=products_1[_i];product.isPricingEnabled&&(newPrices[product.id]=product.price)}this.productRepositoriesManager.updatePricesInAllRepositories(newPrices),this.gameDataChangeListeners.callListeners()},MenuGames.prototype.filterCustomCategories=function(allCategories){var customCategories={};for(var category in allCategories)void 0!==this.categories[category].isSpecial&&this.categories[category].isSpecial&&(customCategories[category]=this.categories[category]);return customCategories},MenuGames.prototype.showCategory=function(){this.$timeout.cancel(this.layerTimeout),this.isLayerExpanded=!0,this.categoryChangeListeners.callListeners()},MenuGames.$inject=["productRepositoriesManager","$window","$timeout","menuAimFactory","listenersManager","productsRepositoryFactory","menuConfig","menuDataClientPerUserFactory"],MenuGames.DEFAULT_CATEGORY="default",MenuGames}();exports.MenuGames=MenuGames},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuNow=function(){function MenuNow($window){this.$window=$window}return MenuNow.prototype.getTime=function(serviceName){return void 0===serviceName&&(serviceName=""),serviceName.length&&this.isMicroserviceTimeAvailable(serviceName)?this.$window.gogMicroservices[serviceName].now:this.isGlobalTimeAvailable()?this.$window.gogData.now:Math.floor((new Date).getTime()/1e3)},MenuNow.prototype.getCurrentTime=function(){return Math.floor((new Date).getTime()/1e3)},MenuNow.prototype.isMicroserviceTimeAvailable=function(serviceName){return this.$window.hasOwnProperty("gogMicroservices")&&this.$window.gogMicroservices.hasOwnProperty(serviceName)&&this.$window.gogMicroservices.hasOwnProperty("now")},MenuNow.prototype.isGlobalTimeAvailable=function(){return this.$window.hasOwnProperty("gogData")&&this.$window.gogData.hasOwnProperty("now")},MenuNow.$inject=["$window"],MenuNow}();exports.MenuNow=MenuNow},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuScrollWidth=function(){function MenuScrollWidth(){}return MenuScrollWidth.prototype.getWidth=function(){var testEl=document.createElement("div");testEl.setAttribute("style","width: 100px; height: 100px; overflow: scroll; position: fixed"),document.body.appendChild(testEl);var scrollWidth=testEl.offsetWidth-testEl.clientWidth;return document.body.removeChild(testEl),scrollWidth},MenuScrollWidth}();exports.MenuScrollWidth=MenuScrollWidth},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MenuAimFactory=function($window){var MenuAim=function(){function MenuAim(menuElement,tolerance,delay,direction){this.menuElement=menuElement,this.tolerance=tolerance,this.delay=delay,this.direction=direction,this.mouseLocations=[],this.lastDelayLocation=!1,this.assignEvents()}return MenuAim.prototype.getActivationDelay=function(){var offset=this.menuElement.getBoundingClientRect(),location=this.mouseLocations[this.mouseLocations.length-1],prevLocation=this.mouseLocations[0];if(!location)return 0;if(prevLocation||(prevLocation=location),prevLocation.x<offset.left||prevLocation.x>this.getLowerRight(offset).x||prevLocation.y<offset.Top||prevLocation.y>this.getLowerRight(offset).y)return 0;if(this.lastDelayLocation&&location.x==this.lastDelayLocation.x&&location.y==this.lastDelayLocation.y)return 0;var decreasingCorner=this.getDecreasingCorner(offset),increasingCorner=this.getIncreasingCorner(offset),decreasingSlope=this.getSlope(location,decreasingCorner),increasingSlope=this.getSlope(location,increasingCorner),prevDecreasingSlope=this.getSlope(prevLocation,decreasingCorner),prevIncreasingSlope=this.getSlope(prevLocation,increasingCorner);return decreasingSlope<prevDecreasingSlope&&increasingSlope>prevIncreasingSlope?(this.lastDelayLocation=location,this.delay):(this.lastDelayLocation=null,0)},MenuAim.prototype.getIncreasingCorner=function(offset){switch(this.direction){case"right":return this.getLowerRight(offset);case"left":return this.getUpperLeft(offset);case"below":return this.getLowerLeft(offset);case"above":return this.getUpperRight(offset)}},MenuAim.prototype.getDecreasingCorner=function(offset){switch(this.direction){case"right":return this.getUpperRight(offset);case"left":return this.getLowerLeft(offset);case"below":return this.getLowerRight(offset);case"above":return this.getUpperLeft(offset)}},MenuAim.prototype.assignEvents=function(){$window.document.addEventListener("mousemove",this.mouseTrack.bind(this))},MenuAim.prototype.mouseTrack=function(e){this.mouseLocations.push({x:e.pageX,y:e.pageY}),this.mouseLocations.length>3&&this.mouseLocations.shift()},MenuAim.prototype.getUpperLeft=function(offset){return{x:offset.left,y:offset.top-this.tolerance}},MenuAim.prototype.getUpperRight=function(offset){return{x:offset.left+offset.width,y:offset.top-this.tolerance}},MenuAim.prototype.getLowerLeft=function(offset){return{x:offset.left,y:offset.top+offset.height+this.tolerance}},MenuAim.prototype.getLowerRight=function(offset){return{x:offset.left+offset.width,y:offset.top+offset.height+this.tolerance}},MenuAim.prototype.getSlope=function(a,b){return(b.y-a.y)/(b.x-a.x)},MenuAim}();return{getForMenu:function(menuElement,tolerance,delay,direction){return void 0===tolerance&&(tolerance=75),void 0===delay&&(delay=300),void 0===direction&&(direction="right"),new MenuAim(menuElement,tolerance,delay,direction)}}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MenuDataClientFactory=function($http,listenersManager,wrappedStorageFactory,menuNow,menuLogout,menuGalaxyAccounts,menuInternetConnectivityState){var clients={},DataClient=function(){function DataClient(endpointUrl,storageKey){this.endpointUrl=endpointUrl,this.storageKey=storageKey,this.retrivedData={},this.cacheExpires=0,this.isCallInProgress=!1,this.dataListenersManager=listenersManager.getManager(),this.startStorage(),menuGalaxyAccounts.registerOpeningListener(this.dropCache.bind(this)),this.isCacheAvailable()&&this.restoreCache(),menuLogout.registerLoggedOutListener(this.dropCache.bind(this)),menuInternetConnectivityState.registerConnectivityChangeListener(this.internetConnectionStatusChanged.bind(this))}return DataClient.prototype.registerDataListener=function(listener){return this.isDataAvailable()&&listener(),this.dataListenersManager.addListener(listener)},DataClient.prototype.getData=function(){return this.retrivedData},DataClient.prototype.fetchData=function(){var isInternetConnected=!!menuInternetConnectivityState.isConnected();this.isCallInProgress||!this.isCacheExpired()&&this.isCacheAvailable()||!isInternetConnected?this.dataListenersManager.callListeners():(this.isCallInProgress=!0,$http({method:"get",url:this.endpointUrl,withCredentials:!0}).then(this.updateData.bind(this),this.onFetchDataFail.bind(this)).finally(this.markCallAsDone.bind(this)))},DataClient.prototype.forceFetchData=function(){var isInternetConnected=!!menuInternetConnectivityState.isConnected();!this.isCallInProgress&&isInternetConnected&&(this.isCallInProgress=!0,$http({method:"get",url:this.endpointUrl,withCredentials:!0}).then(this.updateData.bind(this),this.onFetchDataFail.bind(this)).finally(this.markCallAsDone.bind(this)))},DataClient.prototype.onFetchDataFail=function(response){console.warn(response)},DataClient.prototype.markCallAsDone=function(){this.isCallInProgress=!1},DataClient.prototype.dropCache=function(){this.retrivedData={},this.storage.removeItem(this.storageKey)},DataClient.prototype.isDataAvailable=function(){return 0!=Object.keys(this.retrivedData).length},DataClient.prototype.internetConnectionStatusChanged=function(isConnected){isConnected&&this.fetchData()},DataClient.prototype.startStorage=function(){this.storage=wrappedStorageFactory.getLocalStorage("dataClient_")},DataClient.prototype.cacheData=function(){this.storage.setItem(this.storageKey,this.retrivedData)},DataClient.prototype.restoreCache=function(){this.retrivedData=this.storage.getItem(this.storageKey),this.cacheExpires=this.retrivedData[DataClient.EXPIRATION_DATE_KEY]||0,this.dataListenersManager.callListeners()},DataClient.prototype.isCacheAvailable=function(){return this.storage.isSet(this.storageKey)},DataClient.prototype.isCacheExpired=function(){return menuNow.getTime()>=this.cacheExpires},DataClient.prototype.updateData=function(response){this.retrivedData=response.data,this.cacheExpires=response.data[DataClient.EXPIRATION_DATE_KEY]||0,this.cacheData(),this.dataListenersManager.callListeners()},DataClient.EXPIRATION_DATE_KEY="cacheExpires",DataClient}();return{getForEndpoint:function(endpointUrl,storageKey,autocall){return void 0===autocall&&(autocall=!1),clients[endpointUrl]?clients[endpointUrl]:(clients[endpointUrl]=new DataClient(endpointUrl,storageKey),autocall&&clients[endpointUrl].fetchData(),clients[endpointUrl])}}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MenuDataClientPerUserFactory=function($http,listenersManager,menuUserStorage,menuNow,menuLogout,menuGalaxyAccounts,menuInternetConnectivityState){var clients={},DataClientPerUser=function(){function DataClientPerUser(endpointUrl,storageKey){this.endpointUrl=endpointUrl,this.storageKey=storageKey,this.retrivedData={},this.cacheExpires=0,this.isCallInProgress=!1,this.dataListenersManager=listenersManager.getManager(),this.startStorage(),menuGalaxyAccounts.registerOpeningListener(this.dropCache.bind(this)),this.isCacheAvailable()&&this.restoreCache(),menuLogout.registerLoggedOutListener(this.dropCache.bind(this)),menuInternetConnectivityState.registerConnectivityChangeListener(this.internetConnectionStatusChanged.bind(this))}return DataClientPerUser.prototype.registerDataListener=function(listener){return this.isDataAvailable()&&listener(),this.dataListenersManager.addListener(listener)},DataClientPerUser.prototype.getData=function(){return this.retrivedData},DataClientPerUser.prototype.fetchData=function(){var isInternetConnected=!!menuInternetConnectivityState.isConnected();this.isCallInProgress||!this.isCacheExpired()&&this.isCacheAvailable()||!isInternetConnected?this.dataListenersManager.callListeners():(this.isCallInProgress=!0,$http({method:"get",url:this.endpointUrl,withCredentials:!0}).then(this.updateData.bind(this),this.onFetchDataFail.bind(this)).finally(this.markCallAsDone.bind(this)))},DataClientPerUser.prototype.onFetchDataFail=function(response){console.warn(response)},DataClientPerUser.prototype.markCallAsDone=function(){this.isCallInProgress=!1},DataClientPerUser.prototype.dropCache=function(){this.retrivedData={},this.storage.remove(this.storageKey)},DataClientPerUser.prototype.isDataAvailable=function(){return 0!=Object.keys(this.retrivedData).length},DataClientPerUser.prototype.internetConnectionStatusChanged=function(isConnected){isConnected&&this.fetchData()},DataClientPerUser.prototype.startStorage=function(){this.storage=menuUserStorage},DataClientPerUser.prototype.cacheData=function(){this.storage.set(this.storageKey,this.retrivedData)},DataClientPerUser.prototype.restoreCache=function(){this.retrivedData=this.storage.get(this.storageKey),this.cacheExpires=this.retrivedData[DataClientPerUser.EXPIRATION_DATE_KEY]||0,this.dataListenersManager.callListeners()},DataClientPerUser.prototype.isCacheAvailable=function(){return this.storage.isSet(this.storageKey)},DataClientPerUser.prototype.isCacheExpired=function(){return menuNow.getTime()>=this.cacheExpires},DataClientPerUser.prototype.updateData=function(response){this.retrivedData=response.data,this.cacheExpires=response.data[DataClientPerUser.EXPIRATION_DATE_KEY]||0,this.cacheData(),this.dataListenersManager.callListeners()},DataClientPerUser.EXPIRATION_DATE_KEY="cacheExpires",DataClientPerUser}();return{getForEndpointPerUser:function(endpointUrl,storageKey,autocall){return void 0===autocall&&(autocall=!1),clients[endpointUrl]?clients[endpointUrl]:(clients[endpointUrl]=new DataClientPerUser(endpointUrl,storageKey),autocall&&clients[endpointUrl].fetchData(),clients[endpointUrl])}}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.highlight=function($sce){return function(text,phrase){return phrase&&(text=text.replace(new RegExp("("+phrase.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+")","gi"),'<mark class="highlighted">$1</mark>')),$sce.trustAsHtml(text)}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuConfig_1=__webpack_require__(32),MenuConfigProvider=function(){function MenuConfigProvider(){this.os="windows",this.$get=["listenersManager",function(listenersManager){if("string"!=typeof this.env)throw new Error("env is not set in menuConfigProvider!");return new MenuConfig_1.MenuConfig(listenersManager,this.env,this.os,this.locale,this.country,this.currency)}]}return MenuConfigProvider.prototype.setEnvironmentAsDev=function(){this.env="dev"},MenuConfigProvider.prototype.setEnvironmentAsStaging=function(){this.env="staging"},MenuConfigProvider.prototype.setEnvironmentAsProd=function(){this.env="prod"},MenuConfigProvider.prototype.setEnvironmentAsPreprod=function(){this.env="preprod"},MenuConfigProvider.prototype.setOsAsLinux=function(){this.os="gnu-linux"},MenuConfigProvider.prototype.setOsAsOSX=function(){this.os="osx"},MenuConfigProvider.prototype.setOsAsWindows=function(){this.os="windows"},MenuConfigProvider.prototype.setLocale=function(locale){if("string"!=typeof locale)throw new Error("Tried to set locale: "+JSON.stringify(locale)+" ("+typeof locale+"), string expected.");this.locale=locale},MenuConfigProvider.prototype.setCurrency=function(currency){if("string"!=typeof currency)throw new Error("Tried to set currency: "+JSON.stringify(currency)+" ("+typeof currency+"), string expected.");this.currency=currency},MenuConfigProvider.prototype.setCountry=function(country){if("string"!=typeof country)throw new Error("Tried to set country: "+JSON.stringify(country)+" ("+typeof country+"), string expected.");this.country=country},MenuConfigProvider}();exports.MenuConfigProvider=MenuConfigProvider},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuConfig=function(){function MenuConfig(listenersManager,env,os,locale,country,currency){if(void 0===locale&&(locale=MenuConfig.DEAFULT_LOCALES.LANGUAGE),this.env=env,this.os=os,this.locale=locale,this.country=country,this.currency=currency,this.urls={},this.observedTopics=["chat","friends","user_notification"],this.gogMenuHostname=MenuConfig.GOG_MENU_HOSTNAMES.staging,this.gogWebsiteHostname=MenuConfig.GOG_WEBSITE_HOSTNAMES.staging,this.gogEmbedHostname=MenuConfig.GOG_EMBED_HOSTNAMES.staging,this.gogPusherHostname=MenuConfig.GOG_PUSHER_HOSTNAMES.staging,this.gogNotificationsHostname=MenuConfig.GOG_NOTIFICATIONS_HOSTNAMES.staging,this.gogPresenceHostname=MenuConfig.GOG_PRESENCE_HOSTNAMES.staging,this.fakeTimeParameter="",this.localeListenersManager=listenersManager.getManager(),this.currencyListenersManager=listenersManager.getManager(),this.countryListenersManager=listenersManager.getManager(),!this.currency){var storedCurrency=window.localStorage.getItem(MenuConfig.STORED_KEYS.CURRENCY);this.currency=null!=storedCurrency?storedCurrency:MenuConfig.DEAFULT_LOCALES.CURRENCY}if(!this.country){var storedCountry=window.localStorage.getItem(MenuConfig.STORED_KEYS.COUNTRY);this.country=null!=storedCountry?storedCountry:MenuConfig.DEAFULT_LOCALES.COUNTRY}window.gogMicroservices&&window.gogMicroservices.hasOwnProperty("menu")&&window.gogMicroservices.menu.hasOwnProperty("features")&&window.gogMicroservices.menu.features.hasOwnProperty("feedNotifications")&&window.gogMicroservices.menu.features.feedNotifications&&this.observedTopics.push("activity_feed"),this.setHostnames(),this.setUrls()}return MenuConfig.prototype.registerLocaleListener=function(listener){return this.localeListenersManager.addListener(listener)},MenuConfig.prototype.registerCurrencyListener=function(listener){return this.currencyListenersManager.addListener(listener)},MenuConfig.prototype.registerCountryListener=function(listener){return this.countryListenersManager.addListener(listener)},MenuConfig.prototype.getEnv=function(){return this.env},MenuConfig.prototype.getOs=function(){return this.os},MenuConfig.prototype.getLocale=function(){return this.locale},MenuConfig.prototype.getCurrency=function(){return this.currency},MenuConfig.prototype.getCountry=function(){return this.country},MenuConfig.prototype.setLocale=function(locale){this.locale!==locale&&(this.locale=locale,this.setUrls(),this.localeListenersManager.callListeners(this.locale))},MenuConfig.prototype.setCurrency=function(currency){this.currency!==currency&&(this.currency=currency,window.localStorage.setItem(MenuConfig.STORED_KEYS.CURRENCY,currency),this.setUrls(),this.currencyListenersManager.callListeners(this.currency))},MenuConfig.prototype.setCountry=function(country){this.country!==country&&(this.country=country,window.localStorage.setItem(MenuConfig.STORED_KEYS.COUNTRY,country),this.setUrls(),this.countryListenersManager.callListeners(this.country))},MenuConfig.prototype.setFaketimeParameter=function(fakeTime){this.fakeTimeParameter="&fakeTime="+fakeTime,this.setUrls()},MenuConfig.prototype.setHostnames=function(){this.gogMenuHostname=MenuConfig.GOG_MENU_HOSTNAMES[this.env],this.gogWebsiteHostname=MenuConfig.GOG_WEBSITE_HOSTNAMES[this.env],this.gogEmbedHostname=MenuConfig.GOG_EMBED_HOSTNAMES[this.env],this.gogPusherHostname=MenuConfig.GOG_PUSHER_HOSTNAMES[this.env],this.gogNotificationsHostname=MenuConfig.GOG_NOTIFICATIONS_HOSTNAMES[this.env],this.gogPresenceHostname=MenuConfig.GOG_PRESENCE_HOSTNAMES[this.env]},MenuConfig.prototype.setUrls=function(){var _this=this;this.urls={storeMenuProducts:this.gogMenuHostname+"/v1/store/configuration?locale="+this.locale+"&currency="+this.currency+"&country="+this.country+this.fakeTimeParameter,menuData:this.gogMenuHostname+"/v1/account/basic?locale="+this.locale+"&currency="+this.currency+"&country="+this.country+this.fakeTimeParameter,accountData:this.gogMenuHostname+"/v1/account/stats?locale="+this.locale+"&currency="+this.currency+"&country="+this.country+this.fakeTimeParameter,logout:this.gogWebsiteHostname+"/logout",setUserPreferences:function(locale,currency){return _this.gogWebsiteHostname+"/user/preferences?language="+locale+"&currency="+currency},friendsList:this.gogMenuHostname+"/v1/account/friends",productSearch:this.gogWebsiteHostname+"/games/ajax/filtered",checkout:"/checkout",account:"/account",feed:"/feed",ownedProducts:this.gogMenuHostname+"/v1/account/licences",presence:function(usersIds){return _this.gogPresenceHostname+"/statuses?user_id="+usersIds},setRedirectAfterLogin:function(route){return"/user/set-redirect-url?url="+route},cart:{get:this.gogEmbedHostname+"/cart",add:function(id){return _this.gogEmbedHostname+"/cart/add/"+id},addMany:this.gogEmbedHostname+"/cart/add",addSeries:function(id){return _this.gogEmbedHostname+"/cart/add/series/"+id},remove:function(id){return _this.gogEmbedHostname+"/cart/remove/"+id}},wishlist:{get:this.gogWebsiteHostname+"/user/wishlist.json",add:function(id){return _this.gogWebsiteHostname+"/user/wishlist/add/"+id},remove:function(id){return _this.gogWebsiteHostname+"/user/wishlist/remove/"+id}},notifications:{getNotifications:function(client_id,user_id,types,access_token){return _this.gogNotificationsHostname+"/clients/"+client_id+"/users/"+user_id+"/notifications?types="+types.join(",")+"&access_token="+access_token},getNotificationsStats:function(client_id,user_id,access_token){return _this.gogNotificationsHostname+"/clients/"+client_id+"/users/"+user_id+"/stats?access_token="+access_token},deleteNotification:function(notificationId,client_id,user_id,access_token){return _this.gogNotificationsHostname+"/clients/"+client_id+"/users/"+user_id+"/notifications/"+notificationId+"?access_token="+access_token},consumeNotification:function(notificationId,client_id,user_id,access_token){return _this.gogNotificationsHostname+"/clients/"+client_id+"/users/"+user_id+"/notifications/"+notificationId+"?access_token="+access_token},pusher:this.gogPusherHostname}}},MenuConfig.GOG_NOTIFICATIONS_HOSTNAMES={dev:"https://notifications.gog.test",staging:"https://notifications.gog.test",prod:"https://notifications.gog.com",preprod:"https://notifications.gog.com"},MenuConfig.GOG_WEBSITE_HOSTNAMES={dev:"https://www.gog-develop.com",staging:"https://www.gog-staging.com",prod:"https://www.gog.com",preprod:"https://www.gog-preprod.com"},MenuConfig.GOG_EMBED_HOSTNAMES={dev:"https://embed.gog-develop.com",staging:"https://embed.gog-staging.com",prod:"https://embed.gog.com",preprod:"https://embed.gog-preprod.com"},MenuConfig.GOG_PUSHER_HOSTNAMES={dev:"wss://notifications-pusher.gog.test",staging:"wss://notifications-pusher.gog.test",prod:"wss://notifications-pusher.gog.com",preprod:"wss://notifications-pusher.gog.com"},MenuConfig.GOG_PRESENCE_HOSTNAMES={dev:"https://presence.gog.test",staging:"https://presence.gog.test",prod:"https://presence.gog.com",preprod:"https://presence.gog.com"},MenuConfig.GOG_MENU_HOSTNAMES={dev:"https://menu.gog-develop.com",staging:"https://menu.gog-staging.com",prod:"https://menu.gog.com",preprod:"https://menu.gog-preprod.com"},MenuConfig.DEAFULT_LOCALES={LANGUAGE:"en-US",CURRENCY:"USD",COUNTRY:"REST"},MenuConfig.STORED_KEYS={CURRENCY:"menuCurrency",COUNTRY:"menuCountry"},MenuConfig}();exports.MenuConfig=MenuConfig},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuLogoutProvider=function(){function MenuLogoutProvider(){this.$get=function(){throw new Error("MenuLogoutProvider needs to have containing angular app logout service provided.")}}return MenuLogoutProvider.prototype.setLogoutServiceName=function(logoutServiceName){this.$get=["$window",logoutServiceName,function($window,logoutService){return new MenuLogout($window,logoutService)}]},MenuLogoutProvider}();exports.MenuLogoutProvider=MenuLogoutProvider;var MenuLogout=function(){function MenuLogout($window,logoutService){this.$window=$window,this.logoutService=logoutService}return MenuLogout.prototype.logout=function(){this.logoutService.startLogout()},MenuLogout.prototype.registerLoggedOutListener=function(loggedOutListener){return this.logoutService.registerLoggedOutListener(loggedOutListener)},MenuLogout}();exports.MenuLogout=MenuLogout},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuFriends=function(){function MenuFriends(listenersManager,$http,menuBasicUserData,menuConfig,menuDataClientPerUserFactory){this.listenersManager=listenersManager,this.$http=$http,this.menuBasicUserData=menuBasicUserData,this.menuConfig=menuConfig,this.menuDataClientPerUserFactory=menuDataClientPerUserFactory,this.isAvailable=!1,this.allFriends=[],this.friendsListListenersManager=listenersManager.getManager(),this.friendsListClient=this.menuDataClientPerUserFactory.getForEndpointPerUser(this.menuConfig.urls.friendsList,"friendsList"),this.friendsListClient.registerDataListener(this.updateFriendsList.bind(this))}return MenuFriends.prototype.getFriendsList=function(){return this.allFriends},MenuFriends.prototype.registerFriendsListListener=function(listener){this.isAvailable&&listener(),this.friendsListListenersManager.addListener(listener)},MenuFriends.prototype.fetchFriendsList=function(){this.menuBasicUserData.isUserLoggedIn()&&this.friendsListClient.fetchData()},MenuFriends.prototype.restoreFriendListFromCache=function(){this.menuBasicUserData.isUserLoggedIn()&&this.friendsListClient.isDataAvailable()&&this.updateFriendsList()},MenuFriends.prototype.updateFriendsList=function(){var friendsList=this.friendsListClient.getData();this.allFriends=friendsList.friends,this.friendsListListenersManager.callListeners()},MenuFriends.$inject=["listenersManager","$http","menuBasicUserData","menuConfig","menuDataClientPerUserFactory"],MenuFriends}();exports.MenuFriends=MenuFriends},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuRedirect=function(){function MenuRedirect($http,menuConfig){this.$http=$http,this.menuConfig=menuConfig}return MenuRedirect.prototype.set=function(route,callback){this.$http.get(this.menuConfig.urls.setRedirectAfterLogin(route)).then(function(response){"function"==typeof callback&&callback()})},MenuRedirect.$inject=["$http","menuConfig"],MenuRedirect}();exports.MenuRedirect=MenuRedirect},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuFriendsPresence=function(){function MenuFriendsPresence(listenersManager,$http,menuConfig){this.listenersManager=listenersManager,this.$http=$http,this.menuConfig=menuConfig,this.isWatching=!1,this.availableUsers=[],this.presenceUpdatedListenersManager=listenersManager.getManager()}return MenuFriendsPresence.prototype.startWatchingPresence=function(){this.fetchPresence(),this.interval=setInterval(this.fetchPresence.bind(this),MenuFriendsPresence.FETCH_PRESENCE_INTERVAL),this.isWatching=!0},MenuFriendsPresence.prototype.registerPresenceUpdatedListener=function(listener){this.presenceUpdatedListenersManager.addListener(listener)},MenuFriendsPresence.prototype.setUsers=function(usersIds){this.usersIds=usersIds,this.isWatching||this.startWatchingPresence()},MenuFriendsPresence.prototype.getAvailableUsers=function(){return this.availableUsers},MenuFriendsPresence.prototype.fetchPresence=function(){this.usersIds.length&&this.$http.get(this.getUrl(this.usersIds)).then(this.onGetResponse.bind(this),this.onGetError.bind(this))},MenuFriendsPresence.prototype.onGetResponse=function(response){this.availableUsers=response.data.items,this.presenceUpdatedListenersManager.callListeners()},MenuFriendsPresence.prototype.onGetError=function(){},MenuFriendsPresence.prototype.getUrl=function(userIdsArray){var userIdsString=userIdsArray.join(",");return this.menuConfig.urls.presence(userIdsString)},MenuFriendsPresence.$inject=["listenersManager","$http","menuConfig"],MenuFriendsPresence.FETCH_PRESENCE_INTERVAL=3e4,MenuFriendsPresence}();exports.MenuFriendsPresence=MenuFriendsPresence},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuBasicUserDataProvider=function(){function MenuBasicUserDataProvider(){this.$get=function(){throw new Error("MenuBasicUserDataProvider needs to have configured source for user basic data")}}return MenuBasicUserDataProvider.prototype.setUserBasicDataSourceName=function(userBasicDataSourceName){this.$get=[userBasicDataSourceName,function(userBasicDataSource){return userBasicDataSource}]},MenuBasicUserDataProvider}();exports.MenuBasicUserDataProvider=MenuBasicUserDataProvider},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuAccessTokenProvider=function(){function MenuAccessTokenProvider(){this.$get=function(){throw new Error("MenuAccessTokenProvider needs to have configured source to get access token")}}return MenuAccessTokenProvider.prototype.setAccessTokenSourceName=function(accessTokenSourceName){this.$get=[accessTokenSourceName,function(accessTokenSource){return accessTokenSource}]},MenuAccessTokenProvider}();exports.MenuAccessTokenProvider=MenuAccessTokenProvider},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuContainerAppClientIdProvider=function(){function MenuContainerAppClientIdProvider(){this.$get=function(){throw new Error("MenuContainerAppClientIdProvider needs to have configured source to get containing app client id")}}return MenuContainerAppClientIdProvider.prototype.setClientIdSourceName=function(clientIdSourceName){this.$get=[clientIdSourceName,function(clientIdSource){return clientIdSource}]},MenuContainerAppClientIdProvider}();exports.MenuContainerAppClientIdProvider=MenuContainerAppClientIdProvider},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuUserStorageProvider=function(){function MenuUserStorageProvider(){this.$get=function(){throw new Error("MenuUserStorage needs to have userStorage service provided")}}return MenuUserStorageProvider.prototype.setUserStorageProvider=function(userStorageServiceName){this.$get=[userStorageServiceName,function(userStorageService){return userStorageService}]},MenuUserStorageProvider}();exports.MenuUserStorageProvider=MenuUserStorageProvider},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuGalaxyAccountsProvider=function(){function MenuGalaxyAccountsProvider(){this.$get=function(){throw new Error("MenuGalaxyAccounts needs to have menuGalaxyAccounts service provided")}}return MenuGalaxyAccountsProvider.prototype.setMenuGalaxyAccountsName=function(menuGalaxyAccountsServiceName){this.$get=[menuGalaxyAccountsServiceName,function(menuGalaxyAccountsService){return menuGalaxyAccountsService}]},MenuGalaxyAccountsProvider}();exports.MenuGalaxyAccountsProvider=MenuGalaxyAccountsProvider},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var angular=__webpack_require__(0),MenuBasicUserDataEndpointSource=function(){function MenuBasicUserDataEndpointSource(listenersManager,menuDataClientFactory,menuConfig){this.isHandlingDisabledProfileEnabled=!1,this.userBasicData=null,this.isLoggedIn=!1,this.isHandlingDisabledProfileEnabled=window.gogMicroservices&&window.gogMicroservices.hasOwnProperty("menu")&&window.gogMicroservices.menu.hasOwnProperty("features")&&window.gogMicroservices.menu.features.hasOwnProperty("disabled_profile_handling")&&window.gogMicroservices.menu.features.disabled_profile_handling,this.userBasicDataChangeListenersManager=listenersManager.getManager(),this.menuDataClient=menuDataClientFactory.getForEndpoint(menuConfig.urls.menuData,"menuData",!0),this.menuDataClient.registerDataListener(this.parseBasicUserDataFromEndpoint.bind(this)),this.menuDataClient.isDataAvailable()&&this.parseBasicUserDataFromEndpoint()}return MenuBasicUserDataEndpointSource.prototype.registerUserDataListener=function(listener){return this.userBasicDataChangeListenersManager.addListener(listener)},MenuBasicUserDataEndpointSource.prototype.getUserData=function(){return this.userBasicData},MenuBasicUserDataEndpointSource.prototype.isUserLoggedIn=function(){return this.isLoggedIn},MenuBasicUserDataEndpointSource.prototype.parseBasicUserDataFromEndpoint=function(){var menuData=this.menuDataClient.getData(),newIsLoggedInValue=menuData.isLoggedIn,newBasicUserData={avatar:{url:""},avatars:{menu_user_av_small:"",menu_user_av_small2:"",menu_user_av_big:"",menu_user_av_big2:""},username:"",id:"",isLoggedIn:menuData.isLoggedIn,profileState:"enabled"};menuData.isLoggedIn&&(newBasicUserData={avatar:{url:menuData.avatar},avatars:{menu_user_av_small:menuData.avatars.menu_user_av_small,menu_user_av_small2:menuData.avatars.menu_user_av_small2,menu_user_av_big:menuData.avatars.menu_user_av_big,menu_user_av_big2:menuData.avatars.menu_user_av_big2},username:menuData.username,id:"string"==typeof menuData.userId?menuData.userId:null,isLoggedIn:menuData.isLoggedIn},this.isHandlingDisabledProfileEnabled&&(newBasicUserData.profileState=menuData.profileState)),newIsLoggedInValue===this.isLoggedIn&&angular.equals(this.userBasicData,newBasicUserData)||(this.userBasicData=newBasicUserData,this.isLoggedIn=newIsLoggedInValue,this.userBasicDataChangeListenersManager.callListeners(this.userBasicData))},MenuBasicUserDataEndpointSource.$inject=["listenersManager","menuDataClientFactory","menuConfig"],MenuBasicUserDataEndpointSource}();exports.MenuBasicUserDataEndpointSource=MenuBasicUserDataEndpointSource},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuAccessTokenEndpointSource=function(){function MenuAccessTokenEndpointSource(listenersManager,menuDataClientFactory,menuConfig,menuNow,$timeout){this.menuNow=menuNow,this.$timeout=$timeout,this.clientAccessToken=null,this.clientAccessTokenExpires=null,this.accessTokenListenersManager=listenersManager.getManager(),this.menuDataClient=menuDataClientFactory.getForEndpoint(menuConfig.urls.menuData,"menuData",!0),this.menuDataClient.registerDataListener(this.parseTokenDataFromEndpoint.bind(this)),this.menuDataClient.isDataAvailable()&&this.parseTokenDataFromEndpoint()}return MenuAccessTokenEndpointSource.prototype.registerAccessTokenListener=function(listener){return this.accessTokenListenersManager.addListener(listener)},MenuAccessTokenEndpointSource.prototype.getAccessToken=function(){return null===this.clientAccessToken?null:this.isTokenExpired(this.clientAccessTokenExpires)?null:this.clientAccessToken},MenuAccessTokenEndpointSource.prototype.isTokenExpired=function(tokenExpirationTimestamp){return this.menuNow.getTime()>tokenExpirationTimestamp},MenuAccessTokenEndpointSource.prototype.refreshAccessToken=function(){this.menuDataClient.forceFetchData()},MenuAccessTokenEndpointSource.prototype.countAccessTokenRefreshDelay=function(tokenExpirationTimestamp){var delay=this.clientAccessTokenExpires-(this.menuNow.getCurrentTime()+MenuAccessTokenEndpointSource.ACCESS_TOKEN_REFRESH_PRECEDE);return Math.max(1e3*delay,0)},MenuAccessTokenEndpointSource.prototype.parseTokenDataFromEndpoint=function(){if(!this.menuDataClient.isDataAvailable())throw new Error("menuDataClient data is not available although we expect it to be, to get accessToken from it.");var endpointData=this.menuDataClient.getData(),newAccessToken="string"==typeof endpointData.accessToken?endpointData.accessToken:null,newAccessTokenExpires="number"==typeof endpointData.accessTokenExpires?endpointData.accessTokenExpires:null;if(this.clientAccessToken!==newAccessToken||this.clientAccessTokenExpires!==newAccessTokenExpires){var previousAccessToken=this.clientAccessToken;this.clientAccessToken=newAccessToken,this.clientAccessTokenExpires=newAccessTokenExpires,this.$timeout(this.refreshAccessToken.bind(this),this.countAccessTokenRefreshDelay(this.clientAccessTokenExpires)),previousAccessToken!==this.getAccessToken()&&this.accessTokenListenersManager.callListeners()}},MenuAccessTokenEndpointSource.$inject=["listenersManager","menuDataClientFactory","menuConfig","menuNow","$timeout"],MenuAccessTokenEndpointSource.ACCESS_TOKEN_REFRESH_PRECEDE=600,MenuAccessTokenEndpointSource}();exports.MenuAccessTokenEndpointSource=MenuAccessTokenEndpointSource},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuContainerAppClientIdEndpointSource=function(){function MenuContainerAppClientIdEndpointSource(listenersManager,menuDataClientFactory,menuConfig){this.menuConfig=menuConfig,this.clientId=null,this.containerAppClientIdListenersManager=listenersManager.getManager(),this.menuDataClient=menuDataClientFactory.getForEndpoint(menuConfig.urls.menuData,"menuData",!0),this.menuDataClient.registerDataListener(this.setClientId.bind(this)),this.menuDataClient.isDataAvailable()&&this.setClientId()}return MenuContainerAppClientIdEndpointSource.prototype.registerClientIdListener=function(listener){return this.containerAppClientIdListenersManager.addListener(listener)},MenuContainerAppClientIdEndpointSource.prototype.getClientId=function(){return this.clientId},MenuContainerAppClientIdEndpointSource.prototype.setClientId=function(){if(!this.menuDataClient.isDataAvailable())throw new Error("menuDataClient data is not available although we expect it to be, to get clientId from it.");var endpointMenuData=this.menuDataClient.getData(),newClientId=null;"string"==typeof endpointMenuData.clientId&&(newClientId=endpointMenuData.clientId),this.clientId!==newClientId&&(this.clientId=newClientId,this.containerAppClientIdListenersManager.callListeners(this.clientId))},MenuContainerAppClientIdEndpointSource.$inject=["listenersManager","menuDataClientFactory","menuConfig"],MenuContainerAppClientIdEndpointSource}();exports.MenuContainerAppClientIdEndpointSource=MenuContainerAppClientIdEndpointSource},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuNotificationsPusher=function(){function MenuNotificationsPusher(menuAccessToken,pusherInterface,menuConfig){this.menuAccessToken=menuAccessToken,this.pusherInterface=pusherInterface,this.menuConfig=menuConfig,null!==this.menuAccessToken.getAccessToken()&&this.connectPusherWithAccessToken(),this.menuAccessToken.registerAccessTokenListener(this.connectPusherWithAccessToken.bind(this))}return MenuNotificationsPusher.prototype.connectPusherWithAccessToken=function(){var accessToken=this.menuAccessToken.getAccessToken();if(!accessToken)throw new Error("Something went wrong with accessToken! Pusher connection aborted.");this.pusherInterface.connect(this.menuConfig.urls.notifications.pusher,accessToken)},MenuNotificationsPusher.$inject=["menuAccessToken","pusherInterface","menuConfig"],MenuNotificationsPusher}();exports.MenuNotificationsPusher=MenuNotificationsPusher},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),__webpack_require__(47),__webpack_require__(48),__webpack_require__(49)},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),__webpack_require__(0).module("menuNotificationsComponent",[]).run(["menuActivityFeedTopicMediator",function(menuActivityFeedTopicMediator){}])},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var angular=__webpack_require__(0),MenuActivityFeedTopicMediator=function(){function MenuActivityFeedTopicMediator(pusherInterface,menuNotificationListLoad,activityFeedTopicParser){this.activityFeedTopicParser=activityFeedTopicParser,window.gogMicroservices&&window.gogMicroservices.hasOwnProperty("menu")&&window.gogMicroservices.menu.hasOwnProperty("features")&&window.gogMicroservices.menu.features.hasOwnProperty("feedNotifications")&&window.gogMicroservices.menu.features.feedNotifications&&(pusherInterface.registerTopicConsumer("activity_feed",this.parseTopicMessage.bind(this)),pusherInterface.registerTopicConsumer("activity_feed:consumed",this.parseConsumedTopicMessage.bind(this)),pusherInterface.registerTopicConsumer("activity_feed:removed",this.parseRemovedTopicMessage.bind(this)),menuNotificationListLoad.registerFullListBackendDataListener(this.filterMessagesFromBackendData.bind(this)))}return MenuActivityFeedTopicMediator.prototype.filterMessagesFromBackendData=function(messages){for(var index=0;index<messages.length;index++)"activity_feed"===messages[index].type&&this.parseTopicMessage({id:messages[index].id,content:messages[index].payload})},MenuActivityFeedTopicMediator.prototype.parseTopicMessage=function(message){this.activityFeedTopicParser.parseTopicMessage(message)},MenuActivityFeedTopicMediator.prototype.parseRemovedTopicMessage=function(message){this.activityFeedTopicParser.parseRemovedTopicMessage(message)},MenuActivityFeedTopicMediator.prototype.parseConsumedTopicMessage=function(message){this.activityFeedTopicParser.parseConsumedTopicMessage(message)},MenuActivityFeedTopicMediator.$inject=["pusherInterface","menuNotificationListLoad","activityFeedTopicParser"],MenuActivityFeedTopicMediator}();exports.MenuActivityFeedTopicMediator=MenuActivityFeedTopicMediator,angular.module("menuNotificationsComponent").service("menuActivityFeedTopicMediator",MenuActivityFeedTopicMediator)},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var angular=__webpack_require__(0),MenuNotificationsCtrl=function(){function MenuNotificationsCtrl(menuBasicUserData,menuNotificationsRepository,menuDropdown,$timeout,$window,menuNotificationAction,menuConfig,$filter,menuBellNotifications){this.menuBasicUserData=menuBasicUserData,this.menuNotificationsRepository=menuNotificationsRepository,this.menuDropdown=menuDropdown,this.$timeout=$timeout,this.$window=$window,this.menuNotificationAction=menuNotificationAction,this.menuConfig=menuConfig,this.$filter=$filter,this.menuBellNotifications=menuBellNotifications,this.list=[],this.haveNewNotifications=!1,this.notificationsCount=0,this.notificationsCountLabel="0",this.lastUnconsumedNotificationsCount=0,this.newNotificationAnimation=!1,this.isVisible=!1,this.showEmptyNotificationsMessage=!0,this.unconsumedNotificationsCount=0,this.titleChangeTimeoutId=null,this.isBlinkingTitle=!1,this.originalDocumentTitle=this.$window.document.title,this.menuDropdown.registerVisibilityChangedListener(this.removeHighlight.bind(this)),this.menuDropdown.registerVisibilityChangedListener(this.consumeNotificationsIfExpanded.bind(this)),this.menuNotificationsRepository.registerNotificationsChangedListener(this.updateView.bind(this)),this.$window.addEventListener("focus",this.stopDocumentTitleBlinking.bind(this)),this.checkUserStatus(),this.menuBasicUserData.registerUserDataListener(this.checkUserStatus.bind(this))}return MenuNotificationsCtrl.prototype.parseLink=function(link){var hostRegEx=/\/\/[^\/]+\/([^\.]+)/;return hostRegEx.test(link)&&(link=link.match(hostRegEx)[1]),"/"===link[0]&&(link=link.substr(1)),this.menuConfig.gogWebsiteHostname+"/"+link},MenuNotificationsCtrl.prototype.deleteAllNotifications=function(){this.menuNotificationsRepository.deleteAllNotifications(),this.notificationsCount=0,this.resetDocumentTitle()},MenuNotificationsCtrl.prototype.consumeAllNotifications=function(){this.menuNotificationsRepository.consumeAllNotifications()},MenuNotificationsCtrl.prototype.executeActionForNotification=function(notificationId,$event){if("touchend"===$event.type){var redirectTo=this.parseLink(this.menuNotificationsRepository.getNotificationById(notificationId).link);this.menuNotificationAction.executeNotificationAction(notificationId,redirectTo)}else this.menuNotificationAction.executeNotificationAction(notificationId)},MenuNotificationsCtrl.prototype.consumeNotificationsIfExpanded=function(menuName,isExpanded){"notifications"===menuName&&isExpanded&&this.consumeAllNotifications()},MenuNotificationsCtrl.prototype.checkUserStatus=function(){this.menuBasicUserData.isUserLoggedIn()?this.isVisible=!0:this.isVisible=!1},MenuNotificationsCtrl.prototype.filterNotifications=function(notificationsList){var _this=this;return this.$filter("filter")(notificationsList,function(notification){return _this.menuBellNotifications.isHandlingNotificationType(notification.type)})},MenuNotificationsCtrl.prototype.sortNotificationsList=function(notificationsList){return this.$filter("orderBy")(notificationsList,["-creationTimestamp"])},MenuNotificationsCtrl.prototype.playAnimation=function(){var _this=this;this.newNotificationAnimation=!0;this.$timeout(function(){_this.newNotificationAnimation=!1},2e3)},MenuNotificationsCtrl.prototype.removeHighlight=function(menuName,isExpanded){"notifications"===menuName&&isExpanded&&(this.haveNewNotifications=!1)},MenuNotificationsCtrl.prototype.stopDocumentTitleBlinking=function(){clearTimeout(this.titleChangeTimeoutId),this.titleChangeTimeoutId=null,this.isBlinkingTitle=!1,this.unconsumedNotificationsCount?this.updateDocumentTitle():this.resetDocumentTitle()},MenuNotificationsCtrl.prototype.resetDocumentTitle=function(){this.$window.document.title=this.originalDocumentTitle},MenuNotificationsCtrl.prototype.blinkDocumentTitle=function(){this.isBlinkingTitle=!0,null===this.titleChangeTimeoutId&&this.tickDocumentTitle()},MenuNotificationsCtrl.prototype.tickDocumentTitle=function(){this.$window.document.title===this.originalDocumentTitle?(this.updateDocumentTitle(),this.titleChangeTimeoutId=setTimeout(this.tickDocumentTitle.bind(this),7e3)):(this.resetDocumentTitle(),this.titleChangeTimeoutId=setTimeout(this.tickDocumentTitle.bind(this),2e3))},MenuNotificationsCtrl.prototype.updateDocumentTitle=function(){this.$window.document.title="["+this.notificationsCount+"] "+this.originalDocumentTitle},MenuNotificationsCtrl.prototype.setDocumentTitle=function(){!this.$window.document.hasFocus()&&this.unconsumedNotificationsCount?this.isBlinkingTitle?this.updateDocumentTitle():this.blinkDocumentTitle():this.unconsumedNotificationsCount?this.updateDocumentTitle():this.stopDocumentTitleBlinking()},MenuNotificationsCtrl.prototype.updateView=function(){var notifications=this.filterNotifications(this.menuNotificationsRepository.getNotifications());this.list=this.sortNotificationsList(notifications),this.updateNotificationCounts(),this.showEmptyNotificationsMessage=!this.notificationsCount,this.unconsumedNotificationsCount=this.menuBellNotifications.getUnconsumedCount(),this.menuDropdown.isExpanded("notifications")||(this.notificationsCount>0?(this.haveNewNotifications=this.unconsumedNotificationsCount&&this.lastUnconsumedNotificationsCount<=this.unconsumedNotificationsCount,this.haveNewNotifications&&this.playAnimation()):this.haveNewNotifications=!1),this.setDocumentTitle(),this.lastUnconsumedNotificationsCount=this.unconsumedNotificationsCount},MenuNotificationsCtrl.prototype.updateNotificationCounts=function(){this.notificationsCount=this.list.length,this.notificationsCount>99?this.notificationsCountLabel="99+":this.notificationsCountLabel=String(this.notificationsCount)},MenuNotificationsCtrl.$inject=["menuBasicUserData","menuNotificationsRepository","menuDropdown","$timeout","$window","menuNotificationAction","menuConfig","$filter","menuBellNotifications"],MenuNotificationsCtrl}();exports.MenuNotificationsCtrl=MenuNotificationsCtrl,angular.module("menuNotificationsComponent").controller("menuNotificationsCtrl",MenuNotificationsCtrl)},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),__webpack_require__(51),__webpack_require__(52)},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),__webpack_require__(0).module("menuNotificationsRepositoryComponent",[])},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var angular=__webpack_require__(0),MenuNotificationsRepository=function(){function MenuNotificationsRepository(menuChatTopicParser,menuFriendsTopicParser,menuCustomTopicParser,menuNotificationFactory,menuNotificationsClient,activityFeedTopicParser,$timeout,menuChat,listenersManager){this.menuChatTopicParser=menuChatTopicParser,this.menuFriendsTopicParser=menuFriendsTopicParser,this.menuCustomTopicParser=menuCustomTopicParser,this.menuNotificationFactory=menuNotificationFactory,this.menuNotificationsClient=menuNotificationsClient,this.activityFeedTopicParser=activityFeedTopicParser,this.$timeout=$timeout,this.menuChat=menuChat,this.allNotifications=[],this.notificationsChangedListenersManager=listenersManager.getManager(),this.menuChatTopicParser.registerNewChatMessageListener(this.addChatNotification.bind(this)),this.menuChatTopicParser.registerChatMessageRemovedListener(this.removeNotification.bind(this)),this.menuChatTopicParser.registerChatMessageConsumedListener(this.markAsConsumedNotification.bind(this)),this.menuChatTopicParser.registerNewGameInviteListener(this.addGameInviteNotification.bind(this)),this.menuCustomTopicParser.registerNewWishlistNotificationListener(this.addWishlistNotification.bind(this)),this.menuCustomTopicParser.registerNewForumNotificationListener(this.addForumNotification.bind(this)),this.menuCustomTopicParser.registerNewGogAnnouncementNotificationListener(this.addGogAnnouncementNotification.bind(this)),this.menuCustomTopicParser.registerProductReleaseNotificationListener(this.addProductReleaseNotification.bind(this)),this.menuCustomTopicParser.registerNotificationRemovedListener(this.removeNotification.bind(this)),this.menuCustomTopicParser.registerNotificationConsumedListener(this.markAsConsumedNotification.bind(this)),this.menuFriendsTopicParser.registerNewInviteListener(this.addFriendInviteNotification.bind(this)),this.menuFriendsTopicParser.registerFriendAcceptedYourInviteListener(this.addNewFriendNotification.bind(this)),this.menuFriendsTopicParser.registerRemovedTopicMessageListener(this.removeNotification.bind(this)),this.menuFriendsTopicParser.registerNotificationConsumedListener(this.markAsConsumedNotification.bind(this)),window.gogMicroservices&&window.gogMicroservices.hasOwnProperty("menu")&&window.gogMicroservices.menu.hasOwnProperty("features")&&window.gogMicroservices.menu.features.hasOwnProperty("feedNotifications")&&window.gogMicroservices.menu.features.feedNotifications&&(this.activityFeedTopicParser.registerNewNotificationListener(this.addActivityFeedNotification.bind(this)),this.activityFeedTopicParser.registerNotificationRemovedListener(this.removeNotification.bind(this)),this.activityFeedTopicParser.registerNotificationConsumedListener(this.markAsConsumedNotification.bind(this)))}return MenuNotificationsRepository.prototype.registerNotificationsChangedListener=function(listener){return this.notificationsChangedListenersManager.addListener(listener)},MenuNotificationsRepository.prototype.getNotifications=function(){return this.allNotifications},MenuNotificationsRepository.prototype.getNotificationById=function(notificationId){for(var index=0;index<this.allNotifications.length;index++)if(this.allNotifications[index].id==notificationId)return this.allNotifications[index]},MenuNotificationsRepository.prototype.deleteAllNotifications=function(){for(var index=0;index<this.allNotifications.length;index++)this.menuNotificationsClient.deleteNotification(this.allNotifications[index].id);this.allNotifications.length=0,this.notificationsChangedListenersManager.callListeners()},MenuNotificationsRepository.prototype.consumeAllNotifications=function(){for(var index=0;index<this.allNotifications.length;index++)this.allNotifications[index].consumed||(this.menuNotificationsClient.consumeNotification(this.allNotifications[index].id),this.allNotifications[index].consumed=!0);this.notificationsChangedListenersManager.callListeners()},MenuNotificationsRepository.prototype.getUnconsumedCount=function(types){for(var unconsumedCount=0,index=0;index<this.allNotifications.length;index++)this.allNotifications[index].consumed||void 0!==types&&-1===types.indexOf(this.allNotifications[index].type)||unconsumedCount++;return unconsumedCount},MenuNotificationsRepository.prototype.getConsumedCount=function(){for(var consumedCount=0,index=0;index<this.allNotifications.length;index++)this.allNotifications[index].consumed&&consumedCount++;return consumedCount},MenuNotificationsRepository.prototype.getTotalCount=function(types){return this.allNotifications.filter(function(notification){return void 0===types||-1!==types.indexOf(notification.type)}).length},MenuNotificationsRepository.prototype.deleteNotificationById=function(notificationId){this.removeNotificationById(notificationId),this.menuNotificationsClient.deleteNotification(notificationId),this.notificationsChangedListenersManager.callListeners()},MenuNotificationsRepository.prototype.deleteNotificationsByIdsLocally=function(notificationIds){this.removeNotificationsByIds(notificationIds),this.notificationsChangedListenersManager.callListeners()},MenuNotificationsRepository.prototype.has=function(notificationId){for(var index=0;index<this.allNotifications.length;index++)if(this.allNotifications[index].id==notificationId)return!0;return!1},MenuNotificationsRepository.prototype.clearNotificationsRepositoryLocally=function(){this.allNotifications.length=0,this.notificationsChangedListenersManager.callListeners()},MenuNotificationsRepository.prototype.removeNotification=function(removedBy,id){switch(removedBy){case"id":this.removeNotificationById(id);break;case"unique_key":this.removeNotificationByUniqueKey(id)}this.notificationsChangedListenersManager.callListeners()},MenuNotificationsRepository.prototype.removeNotificationsByIds=function(notificationIds){for(var _i=0,notificationIds_1=notificationIds;_i<notificationIds_1.length;_i++){var notificationId=notificationIds_1[_i];this.removeNotificationById(notificationId)}},MenuNotificationsRepository.prototype.removeNotificationById=function(notificationId){for(var index=0;index<this.allNotifications.length;index++)if(this.allNotifications[index].id==notificationId)return void this.allNotifications.splice(index,1)},MenuNotificationsRepository.prototype.removeNotificationByUniqueKey=function(uniqueKey){var userId;switch(uniqueKey.split("-")[0]){case"chat_message":userId=uniqueKey.split("-")[1],this.removeSimilarNotificationsFromUser(userId,"new_chat_message");break;case"ni":userId=uniqueKey.split("-")[2],this.removeSimilarNotificationsFromUser(userId,"new_invite");break;case"game_invite":userId=uniqueKey.split("-")[1],this.removeSimilarNotificationsFromUser(userId,"new_game_invite");break;case"af":var activityId=uniqueKey.split("-")[1];this.removeFeedNotificationByActivityId(activityId)}},MenuNotificationsRepository.prototype.removeNotificationByUserId=function(userId){for(var index=0;index<this.allNotifications.length;index++)if(this.allNotifications[index].userId==userId)return this.allNotifications.splice(index,1),!0;return!1},MenuNotificationsRepository.prototype.removeNotificationByType=function(type){for(var index=0;index<this.allNotifications.length;index++)if(this.allNotifications[index].type==type)return this.allNotifications.splice(index,1),!0;return!1},MenuNotificationsRepository.prototype.markAsConsumedNotification=function(id){for(var index=0;index<this.allNotifications.length;index++)if(this.allNotifications[index].id==id)return this.allNotifications[index].consumed=!0,void this.notificationsChangedListenersManager.callListeners()},MenuNotificationsRepository.prototype.countSimilarNotificationsFromUser=function(userId,notificationType){for(var index=0;index<this.allNotifications.length;index++)if(this.allNotifications[index].userId==userId&&this.allNotifications[index].type==notificationType)return this.allNotifications[index].counter;return 0},MenuNotificationsRepository.prototype.countSimilarNotifications=function(notificationType){for(var index=0;index<this.allNotifications.length;index++)if(this.allNotifications[index].type==notificationType)return this.allNotifications[index].counter;return 0},MenuNotificationsRepository.prototype.countSimilarNotificationsFromForumThread=function(threadTitle,notificationType){for(var index=0;index<this.allNotifications.length;index++)if(this.allNotifications[index].type==notificationType&&this.allNotifications[index].threadTitle==threadTitle)return this.allNotifications[index].counter;return 0},MenuNotificationsRepository.prototype.removeSimilarNotificationsFromUser=function(userId,notificationType){var allNotificationsCopy=this.allNotifications.slice();return this.allNotifications=allNotificationsCopy.filter(function(notification){return notification.userId!=userId||notification.type!=notificationType}),!1},MenuNotificationsRepository.prototype.removeFeedNotificationByActivityId=function(activityId){var allNotificationsCopy=this.allNotifications.slice();return this.allNotifications=allNotificationsCopy.filter(function(notification){return notification.acitivtyPayload.id!==activityId}),!1},MenuNotificationsRepository.prototype.removeSimilarNotificationsFromForumThread=function(threadTitle,notificationType){for(var index=0;index<this.allNotifications.length;index++)if(this.allNotifications[index].type==notificationType&&this.allNotifications[index].threadTitle==threadTitle)return this.allNotifications.splice(index,1),!0;return!1},MenuNotificationsRepository.prototype.addWishlistNotification=function(id,discountedProducts,consumed,creationTimestamp,expirationTimestamp,updateTimestamp){this.has(id)||(this.allNotifications.unshift(this.menuNotificationFactory.getWishlistItemDiscountedNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,discountedProducts)),this.notificationsChangedListenersManager.callListeners())},MenuNotificationsRepository.prototype.addForumNotification=function(id,forumNotification,consumed,counter,creationTimestamp,expirationTimestamp,updateTimestamp){if(!this.has(id)){var newForumReplyNotification=this.menuNotificationFactory.getForumReplyNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,forumNotification.userAvatarUrls,forumNotification.userName,forumNotification.userId,forumNotification.threadTitle,forumNotification.threadLink,counter,forumNotification.forumSlug,forumNotification.topicSlug),forumNotificationsFromSameThread=this.countSimilarNotificationsFromForumThread(newForumReplyNotification.threadTitle,newForumReplyNotification.type);this.removeSimilarNotificationsFromForumThread(newForumReplyNotification.threadTitle,newForumReplyNotification.type),0==newForumReplyNotification.counter&&(newForumReplyNotification.counter=1),newForumReplyNotification.counter=forumNotificationsFromSameThread?forumNotificationsFromSameThread+1:newForumReplyNotification.counter,this.allNotifications.unshift(newForumReplyNotification),this.notificationsChangedListenersManager.callListeners()}},MenuNotificationsRepository.prototype.addGogAnnouncementNotification=function(id,gogAnnouncementNotification,consumed,creationTimestamp,expirationTimestamp,updateTimestamp){this.has(id)||(this.allNotifications.unshift(this.menuNotificationFactory.getGogAnnouncementNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,gogAnnouncementNotification.announcement,gogAnnouncementNotification.background)),this.notificationsChangedListenersManager.callListeners())},MenuNotificationsRepository.prototype.addProductReleaseNotification=function(id,productReleaseNotification,consumed,creationTimestamp,expirationTimestamp,updateTimestamp){this.has(id)||(this.allNotifications.unshift(this.menuNotificationFactory.getProductReleaseNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,productReleaseNotification.link,productReleaseNotification.productTitle,productReleaseNotification.productId,productReleaseNotification.productIcon.full)),this.notificationsChangedListenersManager.callListeners())},MenuNotificationsRepository.prototype.addActivityFeedNotification=function(id,activityFeedNotification,consumed,creationTimestamp,expirationTimestamp,updateTimestamp){if(!this.has(id)){var newNotification=this.menuNotificationFactory.getActivityFeedNotification(id,activityFeedNotification,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,0);this.allNotifications.unshift(newNotification),this.notificationsChangedListenersManager.callListeners()}},MenuNotificationsRepository.prototype.addChatNotification=function(id,chatNotification,consumed,counter,creationTimestamp,expirationTimestamp,updateTimestamp){if(!this.has(id)){var newNotification=this.menuNotificationFactory.getChatNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,chatNotification.userAvatar,chatNotification.userName,chatNotification.userId,chatNotification.message,counter),chatNotificationsFromSameUser=this.countSimilarNotificationsFromUser(chatNotification.userId,newNotification.type);this.removeSimilarNotificationsFromUser(chatNotification.userId,newNotification.type),0==newNotification.counter&&(newNotification.counter=1),newNotification.counter=chatNotificationsFromSameUser?chatNotificationsFromSameUser+1:newNotification.counter,this.allNotifications.unshift(newNotification),this.menuChat.shouldShowChatNotificationForUser(chatNotification.userId)&&this.notificationsChangedListenersManager.callListeners()}},MenuNotificationsRepository.prototype.addGameInviteNotification=function(id,gameInviteNotification,consumed,creationTimestamp,expirationTimestamp,updateTimestamp){this.has(id)||(this.allNotifications.unshift(this.menuNotificationFactory.getGameInviteNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,gameInviteNotification.userName,gameInviteNotification.userId,gameInviteNotification.productName,gameInviteNotification.productImages)),this.notificationsChangedListenersManager.callListeners())},MenuNotificationsRepository.prototype.addNewFriendNotification=function(id,friendNotification,consumed,creationTimestamp,expirationTimestamp,updateTimestamp){this.has(id)||(this.removeSimilarNotificationsFromUser(friendNotification.userId,"new_invite"),this.removeSimilarNotificationsFromUser(friendNotification.userId,"new_friend"),this.allNotifications.unshift(this.menuNotificationFactory.getNewFriendNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,friendNotification.userAvatar,friendNotification.userName,friendNotification.userId)),this.notificationsChangedListenersManager.callListeners())},MenuNotificationsRepository.prototype.addFriendInviteNotification=function(id,friendNotification,consumed,creationTimestamp,expirationTimestamp,updateTimestamp){this.has(id)||(this.allNotifications.unshift(this.menuNotificationFactory.getNewFriendInviteNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,friendNotification.userAvatar,friendNotification.userName,friendNotification.userId,friendNotification.eventTimestamp)),this.notificationsChangedListenersManager.callListeners())},MenuNotificationsRepository.$inject=["menuChatTopicParser","menuFriendsTopicParser","menuCustomTopicParser","menuNotificationFactory","menuNotificationsClient","activityFeedTopicParser","$timeout","menuChat","listenersManager"],MenuNotificationsRepository}();exports.MenuNotificationsRepository=MenuNotificationsRepository,angular.module("menuNotificationsRepositoryComponent").service("menuNotificationsRepository",MenuNotificationsRepository)},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),__webpack_require__(54),__webpack_require__(55)},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),__webpack_require__(0).module("menuNotificationFactoryComponent",[])},function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var angular=__webpack_require__(0);function MenuNotificationFactory(){var Notification=function(){return function(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp){this.id=id,this.consumed=consumed,this.creationTimestamp=creationTimestamp,this.expirationTimestamp=expirationTimestamp,this.updateTimestamp=updateTimestamp,this.icon="default",this.imageType="avatar",this.counter=0,this.creationTimestampMs=creationTimestamp+"000"}}(),NewFriendInviteNotification=function(_super){function NewFriendInviteNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,userAvatar,userName,userId,eventTimestamp){var _this=_super.call(this,id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp)||this;return _this.userAvatar=userAvatar,_this.userName=userName,_this.userId=userId,_this.eventTimestamp=eventTimestamp,_this.description="",_this.title="",_this.username="",_this.image="",_this.link="",_this.type="new_invite",_this.icon="#icon-notification-question",_this.link="account/friends",_this.title=_this.userName,_this.image=_this.userAvatar,_this}return __extends(NewFriendInviteNotification,_super),NewFriendInviteNotification}(Notification),NewFriendNotification=function(_super){function NewFriendNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,userAvatar,userName,userId){var _this=_super.call(this,id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp)||this;return _this.userAvatar=userAvatar,_this.userName=userName,_this.userId=userId,_this.description="",_this.title="",_this.username="",_this.image="",_this.link="",_this.type="new_friend",_this.icon="#icon-notification-friend",_this.link="u/"+_this.userName+"/chat",_this.title=_this.userName,_this.image=_this.userAvatar,_this}return __extends(NewFriendNotification,_super),NewFriendNotification}(Notification),ChatNotification=function(_super){function ChatNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,userAvatar,userName,userId,chatMessage,counter){var _this=_super.call(this,id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp)||this;return _this.userAvatar=userAvatar,_this.userName=userName,_this.userId=userId,_this.chatMessage=chatMessage,_this.counter=counter,_this.description="",_this.title="",_this.image="",_this.link="",_this.type="new_chat_message",_this.icon="#icon-notification-chat",_this.link="u/"+_this.userName+"/chat",_this.description=_this.chatMessage,_this.title=_this.userName,_this.image=_this.userAvatar,_this}return __extends(ChatNotification,_super),ChatNotification}(Notification),GameInviteNotification=function(_super){function GameInviteNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,userName,userId,productName,productImages){var _this=_super.call(this,id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp)||this;return _this.userName=userName,_this.userId=userId,_this.productName=productName,_this.productImages=productImages,_this.description="",_this.title="",_this.image="https://images.gog-statics.com/7e240f90c5fae6cfed0030d7e7d0f079d239225338cb42755e0074eb8bf4a5b3.png",_this.link="",_this.type="new_game_invite",_this.icon="#icon-notification-question",_this.imageType="gameIcon",_this.link="u/"+_this.userName+"/chat",_this.title=_this.productName,_this.description=_this.userName,null!==_this.productImages.menu_notification_av&&(_this.image="https:"+_this.productImages.menu_notification_av.split("_")[0]+".png"),_this}return __extends(GameInviteNotification,_super),GameInviteNotification}(Notification),ActivityFeedNotification=function(_super){function ActivityFeedNotification(id,acitivtyPayload,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,counter){var _this=_super.call(this,id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp)||this;return _this.acitivtyPayload=acitivtyPayload,_this.counter=counter,_this.description="",_this.title="",_this.image="https://images.gog-statics.com/7e240f90c5fae6cfed0030d7e7d0f079d239225338cb42755e0074eb8bf4a5b3.png",_this.link="",_this.unseenActivitiesCount=0,_this.type="unseen_activities",_this.icon="#icon-notification-question",_this.imageType="gogLogo",_this.link="feed",_this.title="GOG.com",_this.unseenActivitiesCount=_this.counter,_this}return __extends(ActivityFeedNotification,_super),ActivityFeedNotification}(Notification),WishlistItemDiscountedNotification=function(_super){function WishlistItemDiscountedNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,discountedProducts){var _this=_super.call(this,id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp)||this;return _this.discountedProducts=discountedProducts,_this.title="",_this.link="",_this.image="https://images.gog-statics.com/7e240f90c5fae6cfed0030d7e7d0f079d239225338cb42755e0074eb8bf4a5b3.png",_this.productsDiscountedCount=0,_this.type="wishlisted_products_discounted",_this.icon="#icon-notification-percentage",_this.imageType="gogLogo",_this.link="account/wishlist",_this.productsDiscountedCount=_this.discountedProducts.length,_this.title="GOG.com",_this}return __extends(WishlistItemDiscountedNotification,_super),WishlistItemDiscountedNotification}(Notification),GogAnnoucementNotification=function(_super){function GogAnnoucementNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,announcement,background){var _this=_super.call(this,id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp)||this;return _this.announcement=announcement,_this.background=background,_this.title="",_this.link="",_this.image="https://images.gog-statics.com/7e240f90c5fae6cfed0030d7e7d0f079d239225338cb42755e0074eb8bf4a5b3.png",_this.productsDiscountedCount=0,_this.description="",_this.hasBackground=!0,_this.isSpecial=!0,_this.type="new_gog_announcement",_this.icon="#icon-notification-percentage",_this.imageType="gogLogo",_this.link="account/wishlist",_this.title="GOG.com annouces",_this.description=_this.announcement,_this}return __extends(GogAnnoucementNotification,_super),GogAnnoucementNotification}(Notification),ForumReplyNotification=function(_super){function ForumReplyNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,userAvatar,userName,userId,threadTitle,link,counter,forumSlug,topicSlug){var _this=_super.call(this,id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp)||this;return _this.userAvatar=userAvatar,_this.userName=userName,_this.userId=userId,_this.threadTitle=threadTitle,_this.link=link,_this.counter=counter,_this.forumSlug=forumSlug,_this.topicSlug=topicSlug,_this.description="",_this.title="",_this.image="https://images.gog-statics.com/7e240f90c5fae6cfed0030d7e7d0f079d239225338cb42755e0074eb8bf4a5b3.png",_this.type="new_forum_reply",_this.icon="#icon-notification-chat",_this.imageType="gogLogo",_this.description=_this.threadTitle,_this.title=_this.userName,_this}return __extends(ForumReplyNotification,_super),ForumReplyNotification}(Notification),ProductReleaseNotification=function(_super){function ProductReleaseNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,link,productTitle,productId,productIcon){var _this=_super.call(this,id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp)||this;return _this.link=link,_this.productId=productId,_this.title="",_this.image="",_this.description="",_this.type="product_release",_this.icon="#icon-notification-checkmark",_this.imageType="gameIcon",_this.title=productTitle,0===productIcon.indexOf("//")?_this.image="https:"+productIcon:_this.image=productIcon,_this}return __extends(ProductReleaseNotification,_super),ProductReleaseNotification}(Notification);return{getChatNotification:function(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,userAvatar,userName,userId,chatMessage,counter){return new ChatNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,userAvatar,userName,userId,chatMessage,counter)},getActivityFeedNotification:function(id,acitivtyPayload,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,counter){return new ActivityFeedNotification(id,acitivtyPayload,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,counter)},getGameInviteNotification:function(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,userName,userId,productName,productImages){return new GameInviteNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,userName,userId,productName,productImages)},getWishlistItemDiscountedNotification:function(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,discountedProducts){return new WishlistItemDiscountedNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,discountedProducts)},getGogAnnouncementNotification:function(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,announcement,background){return new GogAnnoucementNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,announcement,background)},getProductReleaseNotification:function(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,link,productTitle,productId,productIcon){return new ProductReleaseNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,link,productTitle,productId,productIcon)},getForumReplyNotification:function(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,userAvatar,userName,userId,threadTitle,threadLink,counter,forumSlug,topicSlug){return new ForumReplyNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,userAvatar,userName,userId,threadTitle,threadLink,counter,forumSlug,topicSlug)},getNewFriendInviteNotification:function(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,userAvatar,userName,userId,eventTimestamp){return new NewFriendInviteNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,userAvatar,userName,userId,eventTimestamp)},getNewFriendNotification:function(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,userAvatar,userName,userId){return new NewFriendNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,userAvatar,userName,userId)}}}exports.MenuNotificationFactory=MenuNotificationFactory,angular.module("menuNotificationFactoryComponent").factory("menuNotificationFactory",MenuNotificationFactory)},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),__webpack_require__(57),__webpack_require__(58)},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),__webpack_require__(0).module("menuPendingNotificationsComponent",[])},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var angular=__webpack_require__(0),MenuPendingNotifications=function(){function MenuPendingNotifications(menuNotificationsRepository,$filter){this.menuNotificationsRepository=menuNotificationsRepository,this.$filter=$filter,this.pendingNotifications={},this.menuNotificationsRepository.registerNotificationsChangedListener(this.updatePendingNotifications.bind(this))}return MenuPendingNotifications.prototype.hasPendingNotificationsOfType=function(type){return!!this.pendingNotifications.hasOwnProperty(type)},MenuPendingNotifications.prototype.updatePendingNotifications=function(){var allNotifications=this.menuNotificationsRepository.getNotifications();this.pendingNotifications={};for(var index=0;index<allNotifications.length;index++)this.pendingNotifications[allNotifications[index].type]=!0},MenuPendingNotifications.$inject=["menuNotificationsRepository","$filter"],MenuPendingNotifications}();exports.MenuPendingNotifications=MenuPendingNotifications,angular.module("menuPendingNotificationsComponent").directive("menuPendingNotifications",function(){return{restrict:"A",controller:MenuPendingNotifications,controllerAs:"menuPendingNotifications"}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),__webpack_require__(60),__webpack_require__(61)},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),__webpack_require__(0).module("menuAccordionComponent",[])},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var angular=__webpack_require__(0),GogMenuAccordion=function(){function GogMenuAccordion(){this.expandedSections={}}return GogMenuAccordion.prototype.toggle=function(sectionName){this.expandedSections[sectionName]=!this.expandedSections[sectionName],this.closeOthers(sectionName)},GogMenuAccordion.prototype.closeOthers=function(exceptSectionName){for(var section in this.expandedSections)section!==exceptSectionName&&(this.expandedSections[section]=!1)},GogMenuAccordion}();angular.module("menuAccordionComponent").directive("gogMenuAccordion",function(){return{restrict:"A",controller:GogMenuAccordion,controllerAs:"accordion",scope:!0}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),__webpack_require__(63)},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var NOTIFICATION_TYPES,angular=__webpack_require__(0);!function(NOTIFICATION_TYPES){NOTIFICATION_TYPES.NewInvite="new_invite",NOTIFICATION_TYPES.NewFriend="new_friend",NOTIFICATION_TYPES.NewChatMessage="new_chat_message",NOTIFICATION_TYPES.NewGameInvite="new_game_invite",NOTIFICATION_TYPES.NewGogAnnouncement="new_gog_announcement",NOTIFICATION_TYPES.NewForumReply="new_forum_reply",NOTIFICATION_TYPES.ProductRelease="product_release",NOTIFICATION_TYPES.WishlistedProductsDiscounted="wishlisted_products_discounted"}(NOTIFICATION_TYPES||(NOTIFICATION_TYPES={}));var MenuBellNotifications=function(){function MenuBellNotifications(menuNotificationsRepository,listenersManager){this.menuNotificationsRepository=menuNotificationsRepository,this.unconsumedCount=0,this.handledNotifications=[],this.totalCount=0,window.gogMicroservices&&window.gogMicroservices.hasOwnProperty("menu")&&window.gogMicroservices.menu.hasOwnProperty("features")&&window.gogMicroservices.menu.features.hasOwnProperty("notifications_v3")&&window.gogMicroservices.menu.features.notifications_v3?this.handledNotifications.push(NOTIFICATION_TYPES.NewInvite,NOTIFICATION_TYPES.NewFriend,NOTIFICATION_TYPES.NewChatMessage,NOTIFICATION_TYPES.NewGameInvite,NOTIFICATION_TYPES.NewGogAnnouncement,NOTIFICATION_TYPES.ProductRelease,NOTIFICATION_TYPES.WishlistedProductsDiscounted):this.handledNotifications.push(NOTIFICATION_TYPES.NewInvite,NOTIFICATION_TYPES.NewFriend,NOTIFICATION_TYPES.NewChatMessage,NOTIFICATION_TYPES.NewGameInvite,NOTIFICATION_TYPES.NewGogAnnouncement,NOTIFICATION_TYPES.ProductRelease,NOTIFICATION_TYPES.NewForumReply,NOTIFICATION_TYPES.WishlistedProductsDiscounted),this.countersListenersManager=listenersManager.getManager(),this.menuNotificationsRepository.registerNotificationsChangedListener(this.updateCounters.bind(this))}return MenuBellNotifications.prototype.registerCountersListeners=function(listener){return this.countersListenersManager.addListener(listener)},MenuBellNotifications.prototype.getUnconsumedCount=function(){return this.unconsumedCount},MenuBellNotifications.prototype.getTotalCount=function(){return this.totalCount},MenuBellNotifications.prototype.isHandlingNotificationType=function(notificationType){return-1!==this.handledNotifications.indexOf(notificationType)},MenuBellNotifications.prototype.updateCounters=function(){this.unconsumedCount=this.menuNotificationsRepository.getUnconsumedCount(this.handledNotifications),this.totalCount=this.menuNotificationsRepository.getTotalCount(this.handledNotifications),this.countersListenersManager.callListeners()},MenuBellNotifications.$inject=["menuNotificationsRepository","listenersManager"],MenuBellNotifications}();exports.MenuBellNotifications=MenuBellNotifications,angular.module("menuBellNotificationsComponent",[]).service("menuBellNotifications",MenuBellNotifications)},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),__webpack_require__(65),__webpack_require__(66)},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),__webpack_require__(0).module("menuAnalyticsComponent",[])},function(module,exports){window.gogEventBus.subscribe("menuProduct","goToProductCart",function(data){var product=data.product,position=data.position;window.Analytics.sendEvent({event:"productClick",ecommerce:{click:{products:[{name:product.slug,id:product.id,price:product.price.finalAmount,category:product.originalCategory||product.category,position:position}]}}})})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuChatTopicParser_1=__webpack_require__(68);exports.MenuChatTopicParser=MenuChatTopicParser_1.MenuChatTopicParser;var MenuChatTopicMediator_1=__webpack_require__(69);exports.MenuChatTopicMediator=MenuChatTopicMediator_1.MenuChatTopicMediator;var MenuFriendsTopicParser_1=__webpack_require__(70);exports.MenuFriendsTopicParser=MenuFriendsTopicParser_1.MenuFriendsTopicParser;var MenuFriendsTopicMediator_1=__webpack_require__(71);exports.MenuFriendsTopicMediator=MenuFriendsTopicMediator_1.MenuFriendsTopicMediator;var MenuNotificationsCtrl_1=__webpack_require__(72);exports.MenuNotificationsCtrl=MenuNotificationsCtrl_1.MenuNotificationsCtrl;var MenuNotificationsRepository_1=__webpack_require__(73);exports.MenuNotificationsRepository=MenuNotificationsRepository_1.MenuNotificationsRepository;var MenuNotificationFactory_1=__webpack_require__(74);exports.MenuNotificationFactory=MenuNotificationFactory_1.MenuNotificationFactory;var MenuCustomTopicMediator_1=__webpack_require__(75);exports.MenuCustomTopicMediator=MenuCustomTopicMediator_1.MenuCustomTopicMediator;var MenuNotificationsClient_1=__webpack_require__(76);exports.MenuNotificationsClient=MenuNotificationsClient_1.MenuNotificationsClient;var MenuNotificationExpiration_1=__webpack_require__(77);exports.MenuNotificationExpiration=MenuNotificationExpiration_1.MenuNotificationExpiration;var MenuNotificationListLoad_1=__webpack_require__(78);exports.MenuNotificationListLoad=MenuNotificationListLoad_1.MenuNotificationListLoad;var MenuNotificationRelatedPageEnter_1=__webpack_require__(79);exports.MenuNotificationRelatedPageEnter=MenuNotificationRelatedPageEnter_1.MenuNotificationRelatedPageEnter;var MenuNotificationActionProvider_1=__webpack_require__(80);exports.MenuNotificationActionProvider=MenuNotificationActionProvider_1.MenuNotificationActionProvider;var MenuChatProvider_1=__webpack_require__(83);exports.MenuChatProvider=MenuChatProvider_1.MenuChatProvider;var MenuNotificationSafeDate_1=__webpack_require__(84);exports.MenuNotificationSafeDate=MenuNotificationSafeDate_1.MenuNotificationSafeDate},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuChatTopicParser=function(){function MenuChatTopicParser(listenersManager,menuNotificationSafeDate){this.menuNotificationSafeDate=menuNotificationSafeDate,this.newChatMessageListenersManager=listenersManager.getManager(),this.newGameInviteListenersManager=listenersManager.getManager(),this.chatMessageRemovedListenersManager=listenersManager.getManager(),this.chatMessageConsumedListenersManager=listenersManager.getManager()}return MenuChatTopicParser.prototype.parseTopicMessage=function(message,isDownloaded){void 0===isDownloaded&&(isDownloaded=!1);var messageContent=JSON.parse(message.content),consumed=!1,counter=0;message.hasOwnProperty("consumed")&&(consumed=message.consumed),message.hasOwnProperty("counter")&&(counter=message.counter);var updateTimestamp=null;void 0!==message.date_updated&&(updateTimestamp=Math.floor(this.menuNotificationSafeDate(message.date_updated)/1e3));var creationTimestamp=null;void 0!==messageContent.data.publish_date&&(creationTimestamp=Math.floor(this.menuNotificationSafeDate(messageContent.data.publish_date)/1e3));var expirationTimestamp=null;void 0!==message.date_expiration?expirationTimestamp=Math.floor(this.menuNotificationSafeDate(message.date_expiration)):"gameInvitation"==messageContent.key&&(expirationTimestamp=Date.now()+MenuChatTopicParser.GAME_INVITE_EXPIRATION,expirationTimestamp=new Date(expirationTimestamp).getTime()),"newChatMessage"==messageContent.key?this.newChatMessageListenersManager.callListeners(message.id,this.formatMessageData(messageContent.data),consumed,counter,creationTimestamp,expirationTimestamp,updateTimestamp,isDownloaded):"gameInvitation"==messageContent.key&&this.newGameInviteListenersManager.callListeners(message.id,this.formatGameInvitationMessageData(messageContent.data),consumed,creationTimestamp,expirationTimestamp,updateTimestamp,isDownloaded)},MenuChatTopicParser.prototype.parseRemovedTopicMessage=function(message){var messageContent=JSON.parse(message.content);this.chatMessageRemovedListenersManager.callListeners(messageContent.removed_by,messageContent[messageContent.removed_by])},MenuChatTopicParser.prototype.parseConsumedTopicMessage=function(message){var messageContent=JSON.parse(message.content);this.chatMessageConsumedListenersManager.callListeners(messageContent.id)},MenuChatTopicParser.prototype.registerNewChatMessageListener=function(listener){this.newChatMessageListenersManager.addListener(listener)},MenuChatTopicParser.prototype.registerNewGameInviteListener=function(listener){this.newGameInviteListenersManager.addListener(listener)},MenuChatTopicParser.prototype.registerChatMessageRemovedListener=function(listener){this.chatMessageRemovedListenersManager.addListener(listener)},MenuChatTopicParser.prototype.registerChatMessageConsumedListener=function(listener){this.chatMessageConsumedListenersManager.addListener(listener)},MenuChatTopicParser.prototype.formatMessageData=function(messageData){return{userName:messageData.sender_username,userAvatar:this.remomveFormatFromAvatarUrl(messageData.images.medium),userId:messageData.sender_id,message:messageData.message_content}},MenuChatTopicParser.prototype.formatGameInvitationMessageData=function(messageData){return{productName:messageData.product_name,productImages:messageData.product_images,userName:messageData.sender_username,userId:messageData.sender_id}},MenuChatTopicParser.prototype.remomveFormatFromAvatarUrl=function(imageUrl){return imageUrl.split("_")[0]},MenuChatTopicParser.$inject=["listenersManager","menuNotificationSafeDate"],MenuChatTopicParser.GAME_INVITE_EXPIRATION=9e5,MenuChatTopicParser}();exports.MenuChatTopicParser=MenuChatTopicParser},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuChatTopicMediator=function(){function MenuChatTopicMediator(pusherInterface,menuNotificationListLoad,menuChatTopicParser){this.menuChatTopicParser=menuChatTopicParser,pusherInterface.registerTopicConsumer("chat",this.parseTopicMessage.bind(this)),pusherInterface.registerTopicConsumer("chat:consumed",this.parseConsumedTopicMessage.bind(this)),pusherInterface.registerTopicConsumer("chat:removed",this.parseRemovedTopicMessage.bind(this)),menuNotificationListLoad.registerFullListBackendDataListener(this.filterMessagesFromBackendData.bind(this))}return MenuChatTopicMediator.prototype.filterMessagesFromBackendData=function(messages){for(var index=0;index<messages.length;index++)"chat"==messages[index].type&&this.parseTopicMessage({id:messages[index].id,content:messages[index].payload,consumed:messages[index].consumed,counter:messages[index].counter,date_expiration:messages[index].date_expiration,date_updated:messages[index].date_updated})},MenuChatTopicMediator.prototype.parseTopicMessage=function(message){this.menuChatTopicParser.parseTopicMessage(message)},MenuChatTopicMediator.prototype.parseRemovedTopicMessage=function(message){this.menuChatTopicParser.parseRemovedTopicMessage(message)},MenuChatTopicMediator.prototype.parseConsumedTopicMessage=function(message){this.menuChatTopicParser.parseConsumedTopicMessage(message)},MenuChatTopicMediator.$inject=["pusherInterface","menuNotificationListLoad","menuChatTopicParser"],MenuChatTopicMediator}();exports.MenuChatTopicMediator=MenuChatTopicMediator},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuFriendsTopicParser=function(){function MenuFriendsTopicParser(listenersManager,menuNotificationSafeDate){this.menuNotificationSafeDate=menuNotificationSafeDate,this.newFriendInviteListenersManager=listenersManager.getManager(),this.friendAcceptedYourInviteListenersManager=listenersManager.getManager(),this.notificationConsumedListenersManager=listenersManager.getManager(),this.notificationRemovedListenersManager=listenersManager.getManager()}return MenuFriendsTopicParser.prototype.parseTopicMessage=function(message,isDownloaded){void 0===isDownloaded&&(isDownloaded=!1);var messageContent=JSON.parse(message.content),consumed=!1;message.hasOwnProperty("consumed")&&(consumed=message.consumed);var updateTimestamp=null;void 0!==message.date_updated&&(updateTimestamp=Math.floor(this.menuNotificationSafeDate(message.date_updated)/1e3));var creationTimestamp=null;creationTimestamp=void 0!==message.date_created?Math.floor(this.menuNotificationSafeDate(message.date_created)/1e3):Math.floor(Date.now()/1e3);var expirationTimestamp=null;if(void 0!==message.date_expiration&&(expirationTimestamp=this.menuNotificationSafeDate(message.date_expiration)),"new_invite"===messageContent.key&&"invited"===messageContent.data.status)this.newFriendInviteListenersManager.callListeners(message.id,this.formatMessageData(messageContent.data),consumed,creationTimestamp,expirationTimestamp,updateTimestamp,isDownloaded);else if("new_friend"===messageContent.key){if("boolean"!=typeof messageContent.data.is_sender)throw new Error('Pusher notification "new_friend" should have "is_sender" in data. message content: '+message.content);!1===messageContent.data.is_sender&&this.friendAcceptedYourInviteListenersManager.callListeners(message.id,this.formatMessageData(messageContent.data),consumed,creationTimestamp,expirationTimestamp,updateTimestamp,isDownloaded)}},MenuFriendsTopicParser.prototype.parseRemovedTopicMessage=function(message){var messageContent=JSON.parse(message.content);this.notificationRemovedListenersManager.callListeners(messageContent.removed_by,messageContent[messageContent.removed_by])},MenuFriendsTopicParser.prototype.parseConsumedTopicMessage=function(message){var messageContent=JSON.parse(message.content);this.notificationConsumedListenersManager.callListeners(messageContent.id)},MenuFriendsTopicParser.prototype.registerRemovedTopicMessageListener=function(listener){return this.notificationRemovedListenersManager.addListener(listener)},MenuFriendsTopicParser.prototype.registerNewInviteListener=function(listener){return this.newFriendInviteListenersManager.addListener(listener)},MenuFriendsTopicParser.prototype.registerFriendAcceptedYourInviteListener=function(listener){return this.friendAcceptedYourInviteListenersManager.addListener(listener)},MenuFriendsTopicParser.prototype.registerNotificationConsumedListener=function(listener){return this.notificationConsumedListenersManager.addListener(listener)},MenuFriendsTopicParser.prototype.formatMessageData=function(messageData){return{userName:messageData.user.username,userAvatar:this.remomveFormatFromAvatarUrl(messageData.user.avatar.medium),userId:messageData.user.id,eventTimestamp:Math.floor(this.menuNotificationSafeDate(messageData.event_date)/1e3)}},MenuFriendsTopicParser.prototype.remomveFormatFromAvatarUrl=function(imageUrl){return imageUrl.split("_")[0]},MenuFriendsTopicParser.$inject=["listenersManager","menuNotificationSafeDate"],MenuFriendsTopicParser}();exports.MenuFriendsTopicParser=MenuFriendsTopicParser},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuFriendsTopicMediator=function(){function MenuFriendsTopicMediator(pusherInterface,menuNotificationListLoad,menuFriendsTopicParser){this.menuFriendsTopicParser=menuFriendsTopicParser,pusherInterface.registerTopicConsumer("friends",this.parseTopicMessage.bind(this)),pusherInterface.registerTopicConsumer("friends:consumed",this.parseConsumedTopicMessage.bind(this)),pusherInterface.registerTopicConsumer("friends:removed",this.parseRemovedTopicMessage.bind(this)),menuNotificationListLoad.registerFullListBackendDataListener(this.filterMessagesFromBackendData.bind(this))}return MenuFriendsTopicMediator.prototype.filterMessagesFromBackendData=function(messages){for(var index=0;index<messages.length;index++)"friends"==messages[index].type&&this.parseTopicMessage({id:messages[index].id,content:messages[index].payload,consumed:messages[index].consumed,counter:messages[index].counter,date_created:messages[index].date_created,date_expiration:messages[index].date_expiration,date_updated:messages[index].date_updated},!0)},MenuFriendsTopicMediator.prototype.parseTopicMessage=function(message,isDownloaded){void 0===isDownloaded&&(isDownloaded=!1),this.menuFriendsTopicParser.parseTopicMessage(message,isDownloaded)},MenuFriendsTopicMediator.prototype.parseRemovedTopicMessage=function(message){this.menuFriendsTopicParser.parseRemovedTopicMessage(message)},MenuFriendsTopicMediator.prototype.parseConsumedTopicMessage=function(message){this.menuFriendsTopicParser.parseConsumedTopicMessage(message)},MenuFriendsTopicMediator.$inject=["pusherInterface","menuNotificationListLoad","menuFriendsTopicParser"],MenuFriendsTopicMediator}();exports.MenuFriendsTopicMediator=MenuFriendsTopicMediator},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuNotificationsCtrl=function(){function MenuNotificationsCtrl(menuBasicUserData,menuNotificationsRepository,menuDropdown,$timeout,$window,menuNotificationAction,menuConfig,$filter){this.menuBasicUserData=menuBasicUserData,this.menuNotificationsRepository=menuNotificationsRepository,this.menuDropdown=menuDropdown,this.$timeout=$timeout,this.$window=$window,this.menuNotificationAction=menuNotificationAction,this.menuConfig=menuConfig,this.$filter=$filter,this.list=[],this.haveNewNotifications=!1,this.notificationsCount=0,this.notificationsCountLabel="0",this.lastUnconsumedNotificationsCount=0,this.newNotificationAnimation=!1,this.isVisible=!1,this.showEmptyNotificationsMessage=!0,this.unconsumedNotificationsCount=0,this.titleChangeTimeoutId=null,this.isBlinkingTitle=!1,this.originalDocumentTitle=this.$window.document.title,this.menuDropdown.registerVisibilityChangedListener(this.removeHighlight.bind(this)),this.menuDropdown.registerVisibilityChangedListener(this.consumeNotificationsIfExpanded.bind(this)),this.menuNotificationsRepository.registerNotificationsChangedListener(this.updateView.bind(this)),this.$window.addEventListener("focus",this.stopDocumentTitleBlinking.bind(this)),this.checkUserStatus(),this.menuBasicUserData.registerUserDataListener(this.checkUserStatus.bind(this))}return MenuNotificationsCtrl.prototype.parseLink=function(link){var hostRegEx=/\/\/[^\/]+\/([^\.]+)/;return hostRegEx.test(link)&&(link=link.match(hostRegEx)[1]),"/"==link[0]&&(link=link.substr(1)),this.menuConfig.gogWebsiteHostname+"/"+link},MenuNotificationsCtrl.prototype.deleteAllNotifications=function(){this.menuNotificationsRepository.deleteAllNotifications(),this.notificationsCount=0,this.resetDocumentTitle()},MenuNotificationsCtrl.prototype.consumeAllNotifications=function(){this.menuNotificationsRepository.consumeAllNotifications()},MenuNotificationsCtrl.prototype.executeActionForNotification=function(notificationId,$event){if("touchend"==$event.type){var redirectTo=this.parseLink(this.menuNotificationsRepository.getNotificationById(notificationId).link);this.menuNotificationAction.executeNotificationAction(notificationId,redirectTo)}else this.menuNotificationAction.executeNotificationAction(notificationId)},MenuNotificationsCtrl.prototype.consumeNotificationsIfExpanded=function(menuName,isExpanded){"notifications"==menuName&&isExpanded&&this.consumeAllNotifications()},MenuNotificationsCtrl.prototype.checkUserStatus=function(){this.menuBasicUserData.isUserLoggedIn()?this.isVisible=!0:this.isVisible=!1},MenuNotificationsCtrl.prototype.sortNotificationsList=function(notificationsList){return this.$filter("orderBy")(notificationsList,["-creationTimestamp"])},MenuNotificationsCtrl.prototype.playAnimation=function(){var _this=this;this.newNotificationAnimation=!0;this.$timeout(function(){_this.newNotificationAnimation=!1},2e3)},MenuNotificationsCtrl.prototype.removeHighlight=function(menuName,isExpanded){"notifications"==menuName&&isExpanded&&(this.haveNewNotifications=!1)},MenuNotificationsCtrl.prototype.stopDocumentTitleBlinking=function(){clearTimeout(this.titleChangeTimeoutId),this.titleChangeTimeoutId=null,this.isBlinkingTitle=!1,this.unconsumedNotificationsCount?this.updateDocumentTitle():this.resetDocumentTitle()},MenuNotificationsCtrl.prototype.resetDocumentTitle=function(){this.$window.document.title=this.originalDocumentTitle},MenuNotificationsCtrl.prototype.blinkDocumentTitle=function(){this.isBlinkingTitle=!0,null===this.titleChangeTimeoutId&&this.tickDocumentTitle()},MenuNotificationsCtrl.prototype.tickDocumentTitle=function(){this.$window.document.title===this.originalDocumentTitle?(this.updateDocumentTitle(),this.titleChangeTimeoutId=setTimeout(this.tickDocumentTitle.bind(this),7e3)):(this.resetDocumentTitle(),this.titleChangeTimeoutId=setTimeout(this.tickDocumentTitle.bind(this),2e3))},MenuNotificationsCtrl.prototype.updateDocumentTitle=function(){this.$window.document.title="["+this.notificationsCount+"] "+this.originalDocumentTitle},MenuNotificationsCtrl.prototype.setDocumentTitle=function(){!this.$window.document.hasFocus()&&this.unconsumedNotificationsCount?this.isBlinkingTitle?this.updateDocumentTitle():this.blinkDocumentTitle():this.unconsumedNotificationsCount?this.updateDocumentTitle():this.stopDocumentTitleBlinking()},MenuNotificationsCtrl.prototype.updateView=function(){this.list=this.sortNotificationsList(this.menuNotificationsRepository.getNotifications()),this.updateNotificationCounts(),this.showEmptyNotificationsMessage=!this.notificationsCount,this.unconsumedNotificationsCount=this.menuNotificationsRepository.getUnconsumedCount(),this.menuDropdown.isExpanded("notifications")||(this.notificationsCount>0?(this.haveNewNotifications=this.unconsumedNotificationsCount&&this.lastUnconsumedNotificationsCount<=this.unconsumedNotificationsCount,this.haveNewNotifications&&this.playAnimation()):this.haveNewNotifications=!1),this.setDocumentTitle(),this.lastUnconsumedNotificationsCount=this.unconsumedNotificationsCount},MenuNotificationsCtrl.prototype.updateNotificationCounts=function(){this.notificationsCount=this.menuNotificationsRepository.getTotalCount(),this.notificationsCount>99?this.notificationsCountLabel="99+":this.notificationsCountLabel=String(this.notificationsCount)},MenuNotificationsCtrl.$inject=["menuBasicUserData","menuNotificationsRepository","menuDropdown","$timeout","$window","menuNotificationAction","menuConfig","$filter"],MenuNotificationsCtrl}();exports.MenuNotificationsCtrl=MenuNotificationsCtrl},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuNotificationsRepository=function(){function MenuNotificationsRepository(menuChatTopicParser,menuFriendsTopicParser,menuCustomTopicParser,menuNotificationFactory,menuNotificationsClient,$timeout,menuChat,listenersManager){this.menuChatTopicParser=menuChatTopicParser,this.menuFriendsTopicParser=menuFriendsTopicParser,this.menuCustomTopicParser=menuCustomTopicParser,this.menuNotificationFactory=menuNotificationFactory,this.menuNotificationsClient=menuNotificationsClient,this.$timeout=$timeout,this.menuChat=menuChat,this.allNotifications=[],this.notificationsChangedListenersManager=listenersManager.getManager(),this.menuChatTopicParser.registerNewChatMessageListener(this.addChatNotification.bind(this)),this.menuChatTopicParser.registerChatMessageRemovedListener(this.removeNotification.bind(this)),this.menuChatTopicParser.registerChatMessageConsumedListener(this.markAsConsumedNotification.bind(this)),this.menuChatTopicParser.registerNewGameInviteListener(this.addGameInviteNotification.bind(this)),this.menuCustomTopicParser.registerNewWishlistNotificationListener(this.addWishlistNotification.bind(this)),this.menuCustomTopicParser.registerNewForumNotificationListener(this.addForumNotification.bind(this)),this.menuCustomTopicParser.registerNewGogAnnouncementNotificationListener(this.addGogAnnouncementNotification.bind(this)),this.menuCustomTopicParser.registerProductReleaseNotificationListener(this.addProductReleaseNotification.bind(this)),this.menuCustomTopicParser.registerNotificationRemovedListener(this.removeNotification.bind(this)),this.menuCustomTopicParser.registerNotificationConsumedListener(this.markAsConsumedNotification.bind(this)),this.menuFriendsTopicParser.registerNewInviteListener(this.addFriendInviteNotification.bind(this)),this.menuFriendsTopicParser.registerFriendAcceptedYourInviteListener(this.addNewFriendNotification.bind(this)),this.menuFriendsTopicParser.registerRemovedTopicMessageListener(this.removeNotification.bind(this)),this.menuFriendsTopicParser.registerNotificationConsumedListener(this.markAsConsumedNotification.bind(this))}return MenuNotificationsRepository.prototype.registerNotificationsChangedListener=function(listener){return this.notificationsChangedListenersManager.addListener(listener)},MenuNotificationsRepository.prototype.getNotifications=function(){return this.allNotifications},MenuNotificationsRepository.prototype.getNotificationById=function(notificationId){for(var index=0;index<this.allNotifications.length;index++)if(this.allNotifications[index].id==notificationId)return this.allNotifications[index]},MenuNotificationsRepository.prototype.deleteAllNotifications=function(){for(var index=0;index<this.allNotifications.length;index++)this.menuNotificationsClient.deleteNotification(this.allNotifications[index].id);this.allNotifications.length=0,this.notificationsChangedListenersManager.callListeners()},MenuNotificationsRepository.prototype.consumeAllNotifications=function(){for(var index=0;index<this.allNotifications.length;index++)this.allNotifications[index].consumed||(this.menuNotificationsClient.consumeNotification(this.allNotifications[index].id),this.allNotifications[index].consumed=!0);this.notificationsChangedListenersManager.callListeners()},MenuNotificationsRepository.prototype.getUnconsumedCount=function(){for(var unconsumedCount=0,index=0;index<this.allNotifications.length;index++)this.allNotifications[index].consumed||unconsumedCount++;return unconsumedCount},MenuNotificationsRepository.prototype.getConsumedCount=function(){for(var consumedCount=0,index=0;index<this.allNotifications.length;index++)this.allNotifications[index].consumed&&consumedCount++;return consumedCount},MenuNotificationsRepository.prototype.getTotalCount=function(){return this.allNotifications.length},MenuNotificationsRepository.prototype.deleteNotificationById=function(notificationId){this.removeNotificationById(notificationId),this.menuNotificationsClient.deleteNotification(notificationId),this.notificationsChangedListenersManager.callListeners()},MenuNotificationsRepository.prototype.deleteNotificationsByIdsLocally=function(notificationIds){this.removeNotificationsByIds(notificationIds),this.notificationsChangedListenersManager.callListeners()},MenuNotificationsRepository.prototype.has=function(notificationId){for(var index=0;index<this.allNotifications.length;index++)if(this.allNotifications[index].id==notificationId)return!0;return!1},MenuNotificationsRepository.prototype.clearNotificationsRepositoryLocally=function(){this.allNotifications.length=0,this.notificationsChangedListenersManager.callListeners()},MenuNotificationsRepository.prototype.removeNotification=function(removedBy,id){switch(removedBy){case"id":this.removeNotificationById(id);break;case"unique_key":this.removeNotificationByUniqueKey(id)}this.notificationsChangedListenersManager.callListeners()},MenuNotificationsRepository.prototype.removeNotificationsByIds=function(notificationIds){for(var _i=0,notificationIds_1=notificationIds;_i<notificationIds_1.length;_i++){var notificationId=notificationIds_1[_i];this.removeNotificationById(notificationId)}},MenuNotificationsRepository.prototype.removeNotificationById=function(notificationId){for(var index=0;index<this.allNotifications.length;index++)if(this.allNotifications[index].id==notificationId)return void this.allNotifications.splice(index,1)},MenuNotificationsRepository.prototype.removeNotificationByUniqueKey=function(uniqueKey){var userId;switch(uniqueKey.split("-")[0]){case"chat_message":userId=uniqueKey.split("-")[1],this.removeSimilarNotificationsFromUser(userId,"new_chat_message");break;case"ni":userId=uniqueKey.split("-")[2],this.removeSimilarNotificationsFromUser(userId,"new_invite");break;case"game_invite":userId=uniqueKey.split("-")[1],this.removeSimilarNotificationsFromUser(userId,"new_game_invite")}},MenuNotificationsRepository.prototype.removeNotificationByUserId=function(userId){for(var index=0;index<this.allNotifications.length;index++)if(this.allNotifications[index].userId==userId)return this.allNotifications.splice(index,1),!0;return!1},MenuNotificationsRepository.prototype.markAsConsumedNotification=function(id){for(var index=0;index<this.allNotifications.length;index++)if(this.allNotifications[index].id==id)return this.allNotifications[index].consumed=!0,void this.notificationsChangedListenersManager.callListeners()},MenuNotificationsRepository.prototype.countSimilarNotificationsFromUser=function(userId,notificationType){for(var index=0;index<this.allNotifications.length;index++)if(this.allNotifications[index].userId==userId&&this.allNotifications[index].type==notificationType)return this.allNotifications[index].counter;return 0},MenuNotificationsRepository.prototype.countSimilarNotificationsFromForumThread=function(threadTitle,notificationType){for(var index=0;index<this.allNotifications.length;index++)if(this.allNotifications[index].type==notificationType&&this.allNotifications[index].threadTitle==threadTitle)return this.allNotifications[index].counter;return 0},MenuNotificationsRepository.prototype.removeSimilarNotificationsFromUser=function(userId,notificationType){var allNotificationsCopy=this.allNotifications.slice();return this.allNotifications=allNotificationsCopy.filter(function(notification){return notification.userId!=userId||notification.type!=notificationType}),!1},MenuNotificationsRepository.prototype.removeSimilarNotificationsFromForumThread=function(threadTitle,notificationType){for(var index=0;index<this.allNotifications.length;index++)if(this.allNotifications[index].type==notificationType&&this.allNotifications[index].threadTitle==threadTitle)return this.allNotifications.splice(index,1),!0;return!1},MenuNotificationsRepository.prototype.addWishlistNotification=function(id,discountedProducts,consumed,creationTimestamp,expirationTimestamp,updateTimestamp){this.has(id)||(this.allNotifications.unshift(this.menuNotificationFactory.getWishlistItemDiscountedNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,discountedProducts)),this.notificationsChangedListenersManager.callListeners())},MenuNotificationsRepository.prototype.addForumNotification=function(id,forumNotification,consumed,counter,creationTimestamp,expirationTimestamp,updateTimestamp){if(!this.has(id)){var newForumReplyNotification=this.menuNotificationFactory.getForumReplyNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,forumNotification.userAvatarUrls,forumNotification.userName,forumNotification.userId,forumNotification.threadTitle,forumNotification.threadLink,counter,forumNotification.forumSlug,forumNotification.topicSlug),forumNotificationsFromSameThread=this.countSimilarNotificationsFromForumThread(newForumReplyNotification.threadTitle,newForumReplyNotification.type);this.removeSimilarNotificationsFromForumThread(newForumReplyNotification.threadTitle,newForumReplyNotification.type),0==newForumReplyNotification.counter&&(newForumReplyNotification.counter=1),newForumReplyNotification.counter=forumNotificationsFromSameThread?forumNotificationsFromSameThread+1:newForumReplyNotification.counter,this.allNotifications.unshift(newForumReplyNotification),this.notificationsChangedListenersManager.callListeners()}},MenuNotificationsRepository.prototype.addGogAnnouncementNotification=function(id,gogAnnouncementNotification,consumed,creationTimestamp,expirationTimestamp,updateTimestamp){this.has(id)||(this.allNotifications.unshift(this.menuNotificationFactory.getGogAnnouncementNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,gogAnnouncementNotification.announcement,gogAnnouncementNotification.background)),this.notificationsChangedListenersManager.callListeners())},MenuNotificationsRepository.prototype.addProductReleaseNotification=function(id,productReleaseNotification,consumed,creationTimestamp,expirationTimestamp,updateTimestamp){this.has(id)||(this.allNotifications.unshift(this.menuNotificationFactory.getProductReleaseNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,productReleaseNotification.link,productReleaseNotification.productTitle,productReleaseNotification.productId,productReleaseNotification.productIcon.full)),this.notificationsChangedListenersManager.callListeners())},MenuNotificationsRepository.prototype.addChatNotification=function(id,chatNotification,consumed,counter,creationTimestamp,expirationTimestamp,updateTimestamp){if(!this.has(id)){var newNotification=this.menuNotificationFactory.getChatNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,chatNotification.userAvatar,chatNotification.userName,chatNotification.userId,chatNotification.message,counter),chatNotificationsFromSameUser=this.countSimilarNotificationsFromUser(chatNotification.userId,newNotification.type);this.removeSimilarNotificationsFromUser(chatNotification.userId,newNotification.type),0==newNotification.counter&&(newNotification.counter=1),newNotification.counter=chatNotificationsFromSameUser?chatNotificationsFromSameUser+1:newNotification.counter,this.allNotifications.unshift(newNotification),this.menuChat.shouldShowChatNotificationForUser(chatNotification.userId)&&this.notificationsChangedListenersManager.callListeners()}},MenuNotificationsRepository.prototype.addGameInviteNotification=function(id,gameInviteNotification,consumed,creationTimestamp,expirationTimestamp,updateTimestamp){this.has(id)||(this.allNotifications.unshift(this.menuNotificationFactory.getGameInviteNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,gameInviteNotification.userName,gameInviteNotification.userId,gameInviteNotification.productName,gameInviteNotification.productImages)),this.notificationsChangedListenersManager.callListeners())},MenuNotificationsRepository.prototype.addNewFriendNotification=function(id,friendNotification,consumed,creationTimestamp,expirationTimestamp,updateTimestamp){this.has(id)||(this.removeSimilarNotificationsFromUser(friendNotification.userId,"new_invite"),this.removeSimilarNotificationsFromUser(friendNotification.userId,"new_friend"),this.allNotifications.unshift(this.menuNotificationFactory.getNewFriendNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,friendNotification.userAvatar,friendNotification.userName,friendNotification.userId)),this.notificationsChangedListenersManager.callListeners())},MenuNotificationsRepository.prototype.addFriendInviteNotification=function(id,friendNotification,consumed,creationTimestamp,expirationTimestamp,updateTimestamp){this.has(id)||(this.allNotifications.unshift(this.menuNotificationFactory.getNewFriendInviteNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,friendNotification.userAvatar,friendNotification.userName,friendNotification.userId,friendNotification.eventTimestamp)),this.notificationsChangedListenersManager.callListeners())},MenuNotificationsRepository.$inject=["menuChatTopicParser","menuFriendsTopicParser","menuCustomTopicParser","menuNotificationFactory","menuNotificationsClient","$timeout","menuChat","listenersManager"],MenuNotificationsRepository}();exports.MenuNotificationsRepository=MenuNotificationsRepository},function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0}),exports.MenuNotificationFactory=function(){var Notification=function(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp){this.id=id,this.consumed=consumed,this.creationTimestamp=creationTimestamp,this.expirationTimestamp=expirationTimestamp,this.updateTimestamp=updateTimestamp,this.icon="default",this.imageType="avatar",this.counter=0,this.creationTimestampMs=creationTimestamp+"000"},NewFriendInviteNotification=function(_super){function NewFriendInviteNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,userAvatar,userName,userId,eventTimestamp){var _this=_super.call(this,id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp)||this;return _this.userAvatar=userAvatar,_this.userName=userName,_this.userId=userId,_this.eventTimestamp=eventTimestamp,_this.description="",_this.title="",_this.username="",_this.image="",_this.link="",_this.type="new_invite",_this.icon="#icon-notification-question",_this.link="account/friends",_this.title=_this.userName,_this.image=_this.userAvatar,_this}return __extends(NewFriendInviteNotification,_super),NewFriendInviteNotification}(Notification),NewFriendNotification=function(_super){function NewFriendNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,userAvatar,userName,userId){var _this=_super.call(this,id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp)||this;return _this.userAvatar=userAvatar,_this.userName=userName,_this.userId=userId,_this.description="",_this.title="",_this.username="",_this.image="",_this.link="",_this.type="new_friend",_this.icon="#icon-notification-friend",_this.link="u/"+_this.userName+"/chat",_this.title=_this.userName,_this.image=_this.userAvatar,_this}return __extends(NewFriendNotification,_super),NewFriendNotification}(Notification),ChatNotification=function(_super){function ChatNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,userAvatar,userName,userId,chatMessage,counter){var _this=_super.call(this,id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp)||this;return _this.userAvatar=userAvatar,_this.userName=userName,_this.userId=userId,_this.chatMessage=chatMessage,_this.counter=counter,_this.description="",_this.title="",_this.image="",_this.link="",_this.type="new_chat_message",_this.icon="#icon-notification-chat",_this.link="u/"+_this.userName+"/chat",_this.description=_this.chatMessage,_this.title=_this.userName,_this.image=_this.userAvatar,_this}return __extends(ChatNotification,_super),ChatNotification}(Notification),GameInviteNotification=function(_super){function GameInviteNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,userName,userId,productName,productImages){var _this=_super.call(this,id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp)||this;return _this.userName=userName,_this.userId=userId,_this.productName=productName,_this.productImages=productImages,_this.description="",_this.title="",_this.image="https://images.gog-statics.com/7e240f90c5fae6cfed0030d7e7d0f079d239225338cb42755e0074eb8bf4a5b3.png",_this.link="",_this.type="new_game_invite",_this.icon="#icon-notification-question",_this.imageType="gameIcon",_this.link="u/"+_this.userName+"/chat",_this.title=_this.productName,_this.description=_this.userName,null!==_this.productImages.menu_notification_av&&(_this.image="https:"+_this.productImages.menu_notification_av.split("_")[0]+".png"),_this}return __extends(GameInviteNotification,_super),GameInviteNotification}(Notification),WishlistItemDiscountedNotification=function(_super){function WishlistItemDiscountedNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,discountedProducts){var _this=_super.call(this,id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp)||this;return _this.discountedProducts=discountedProducts,_this.title="",_this.link="",_this.image="https://images.gog-statics.com/7e240f90c5fae6cfed0030d7e7d0f079d239225338cb42755e0074eb8bf4a5b3.png",_this.productsDiscountedCount=0,_this.type="wishlisted_products_discounted",_this.icon="#icon-notification-percentage",_this.imageType="gogLogo",_this.link="account/wishlist",_this.productsDiscountedCount=_this.discountedProducts.length,_this.title="GOG.com",_this}return __extends(WishlistItemDiscountedNotification,_super),WishlistItemDiscountedNotification}(Notification),GogAnnoucementNotification=function(_super){function GogAnnoucementNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,announcement,background){var _this=_super.call(this,id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp)||this;return _this.announcement=announcement,_this.background=background,_this.title="",_this.link="",_this.image="https://images.gog-statics.com/7e240f90c5fae6cfed0030d7e7d0f079d239225338cb42755e0074eb8bf4a5b3.png",_this.productsDiscountedCount=0,_this.description="",_this.hasBackground=!0,_this.isSpecial=!0,_this.type="new_gog_announcement",_this.icon="#icon-notification-percentage",_this.imageType="gogLogo",_this.link="account/wishlist",_this.title="GOG.com annouces",_this.description=_this.announcement,_this}return __extends(GogAnnoucementNotification,_super),GogAnnoucementNotification}(Notification),ForumReplyNotification=function(_super){function ForumReplyNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,userAvatar,userName,userId,threadTitle,link,counter,forumSlug,topicSlug){var _this=_super.call(this,id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp)||this;return _this.userAvatar=userAvatar,_this.userName=userName,_this.userId=userId,_this.threadTitle=threadTitle,_this.link=link,_this.counter=counter,_this.forumSlug=forumSlug,_this.topicSlug=topicSlug,_this.description="",_this.title="",_this.image="https://images.gog-statics.com/7e240f90c5fae6cfed0030d7e7d0f079d239225338cb42755e0074eb8bf4a5b3.png",_this.type="new_forum_reply",_this.icon="#icon-notification-chat",_this.imageType="gogLogo",_this.description=_this.threadTitle,_this.title=_this.userName,_this}return __extends(ForumReplyNotification,_super),ForumReplyNotification}(Notification),ProductReleaseNotification=function(_super){function ProductReleaseNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,link,productTitle,productId,productIcon){var _this=_super.call(this,id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp)||this;return _this.link=link,_this.productId=productId,_this.title="",_this.image="",_this.description="",_this.type="product_release",_this.icon="#icon-notification-checkmark",_this.imageType="gameIcon",_this.title=productTitle,0===productIcon.indexOf("//")?_this.image="https:"+productIcon:_this.image=productIcon,_this}return __extends(ProductReleaseNotification,_super),ProductReleaseNotification}(Notification);return{getChatNotification:function(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,userAvatar,userName,userId,chatMessage,counter){return new ChatNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,userAvatar,userName,userId,chatMessage,counter)},getGameInviteNotification:function(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,userName,userId,productName,productImages){return new GameInviteNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,userName,userId,productName,productImages)},getWishlistItemDiscountedNotification:function(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,discountedProducts){return new WishlistItemDiscountedNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,discountedProducts)},getGogAnnouncementNotification:function(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,announcement,background){return new GogAnnoucementNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,announcement,background)},getProductReleaseNotification:function(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,link,productTitle,productId,productIcon){return new ProductReleaseNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,link,productTitle,productId,productIcon)},getForumReplyNotification:function(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,userAvatar,userName,userId,threadTitle,threadLink,counter,forumSlug,topicSlug){return new ForumReplyNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,userAvatar,userName,userId,threadTitle,threadLink,counter,forumSlug,topicSlug)},getNewFriendInviteNotification:function(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,userAvatar,userName,userId,eventTimestamp){return new NewFriendInviteNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,userAvatar,userName,userId,eventTimestamp)},getNewFriendNotification:function(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,userAvatar,userName,userId){return new NewFriendNotification(id,consumed,creationTimestamp,expirationTimestamp,updateTimestamp,userAvatar,userName,userId)}}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuCustomTopicMediator=function(){function MenuCustomTopicMediator(pusherInterface,menuNotificationListLoad,menuCustomTopicParser){this.menuCustomTopicParser=menuCustomTopicParser,pusherInterface.registerTopicConsumer("user_notification",this.parseTopicMessage.bind(this)),pusherInterface.registerTopicConsumer("user_notification:consumed",this.parseConsumedTopicMessage.bind(this)),pusherInterface.registerTopicConsumer("user_notification:removed",this.parseRemovedTopicMessage.bind(this)),menuNotificationListLoad.registerFullListBackendDataListener(this.filterMessagesFromBackendData.bind(this))}return MenuCustomTopicMediator.prototype.filterMessagesFromBackendData=function(messages){for(var index=0;index<messages.length;index++)"user_notification"==messages[index].type&&this.parseTopicMessage({id:messages[index].id,content:messages[index].payload,consumed:messages[index].consumed,date_created:messages[index].date_created,date_expiration:messages[index].date_expiration,date_updated:messages[index].date_updated,counter:messages[index].counter},!0)},MenuCustomTopicMediator.prototype.parseTopicMessage=function(message,isDownloaded){void 0===isDownloaded&&(isDownloaded=!1),this.menuCustomTopicParser.parseTopicMessage(message,isDownloaded)},MenuCustomTopicMediator.prototype.parseRemovedTopicMessage=function(message){this.menuCustomTopicParser.parseRemovedTopicMessage(message)},MenuCustomTopicMediator.prototype.parseConsumedTopicMessage=function(message){this.menuCustomTopicParser.parseConsumedTopicMessage(message)},MenuCustomTopicMediator.$inject=["pusherInterface","menuNotificationListLoad","menuCustomTopicParser"],MenuCustomTopicMediator}();exports.MenuCustomTopicMediator=MenuCustomTopicMediator},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuNotificationsClient=function(){function MenuNotificationsClient(menuConfig,menuBasicUserData,$http,menuAccessToken,menuContainerAppClientId){this.menuConfig=menuConfig,this.menuBasicUserData=menuBasicUserData,this.$http=$http,this.menuAccessToken=menuAccessToken,this.menuContainerAppClientId=menuContainerAppClientId}return MenuNotificationsClient.prototype.fetchNewNotificationsList=function(clientId,userId,accessToken){var notificationsUrl=this.menuConfig.urls.notifications.getNotifications(clientId,userId,this.menuConfig.observedTopics,accessToken);return void 0!==this.currentFetchOfNewListData&&void 0!==this.currentFetchOfNewListData.promise&&this.currentFetchOfNewListData.forUrl===notificationsUrl?this.currentFetchOfNewListData.promise:(this.currentFetchOfNewListData={promise:this.$http.get(notificationsUrl),forUrl:notificationsUrl},this.currentFetchOfNewListData.promise.finally(this.onFetchNotificationsFinish.bind(this)),this.currentFetchOfNewListData.promise)},MenuNotificationsClient.prototype.deleteNotification=function(notificationId){var accessToken=this.menuAccessToken.getAccessToken(),clientId=this.menuContainerAppClientId.getClientId();if(!accessToken)throw new Error("Something went wrong with accessToken! Deleting notification aborted.");if(!this.menuBasicUserData.isUserLoggedIn())throw new Error("User is not logged in when trying to delete a user's notification. Something is clearly wrong!");this.$http.delete(this.menuConfig.urls.notifications.deleteNotification(notificationId,clientId,this.menuBasicUserData.getUserData().id,accessToken),{data:{}}).catch(this.deleteNotificationError.bind(this))},MenuNotificationsClient.prototype.consumeNotification=function(notificationId){var accessToken=this.menuAccessToken.getAccessToken(),clientId=this.menuContainerAppClientId.getClientId();if(!accessToken)throw new Error("Something went wrong with accessToken! Consuming notification aborted.");if(!this.menuBasicUserData.isUserLoggedIn())throw new Error("User is not logged in when trying to consume a user's notification. Something is clearly wrong!");this.$http.put(this.menuConfig.urls.notifications.consumeNotification(notificationId,clientId,this.menuBasicUserData.getUserData().id,accessToken),{consumed:!0}).catch(this.consumeNotificationError.bind(this))},MenuNotificationsClient.prototype.deleteNotificationError=function(response){throw new Error("Couldn't delete notification. Response: "+JSON.stringify(response))},MenuNotificationsClient.prototype.consumeNotificationError=function(response){throw new Error("Couldn't consume notification. Response: "+JSON.stringify(response))},MenuNotificationsClient.prototype.onFetchNotificationsFinish=function(){delete this.currentFetchOfNewListData},MenuNotificationsClient.$inject=["menuConfig","menuBasicUserData","$http","menuAccessToken","menuContainerAppClientId"],MenuNotificationsClient}();exports.MenuNotificationsClient=MenuNotificationsClient},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuNotificationExpiration=function(){function MenuNotificationExpiration(listenersManager,menuNotificationsRepository,$timeout){this.menuNotificationsRepository=menuNotificationsRepository,this.$timeout=$timeout,this.expirationTimeouts=[],this.menuNotificationsRepository.registerNotificationsChangedListener(this.notificationsUpdated.bind(this))}return MenuNotificationExpiration.prototype.setNotificationExpiration=function(notificationId,expirationTimestamp){if(!this.hasExpirationSetForNotification(notificationId)&&null!=expirationTimestamp){var expiresIn=expirationTimestamp-Date.now();if(!(expiresIn>MenuNotificationExpiration.MAX_TIMEOUT)){var timeoutId=this.$timeout(this.removeExpiredNotification.bind(this,notificationId),expiresIn);this.expirationTimeouts.push({notificationId:notificationId,timeoutId:timeoutId})}}},MenuNotificationExpiration.prototype.notificationsUpdated=function(){for(var allNotifications=this.menuNotificationsRepository.getNotifications(),index=0;index<allNotifications.length;index++)if(allNotifications[index].hasOwnProperty("expirationTimestamp")){var notification=allNotifications[index];this.setNotificationExpiration(notification.id,notification.expirationTimestamp)}},MenuNotificationExpiration.prototype.hasExpirationSetForNotification=function(notificationId){for(var index=0;index<this.expirationTimeouts.length;index++)if(this.expirationTimeouts[index].notificationId==notificationId)return!0;return!1},MenuNotificationExpiration.prototype.removeExpiredNotification=function(notificationId){this.menuNotificationsRepository.deleteNotificationsByIdsLocally([notificationId])},MenuNotificationExpiration.$inject=["listenersManager","menuNotificationsRepository","$timeout"],MenuNotificationExpiration.MAX_TIMEOUT=2147483647,MenuNotificationExpiration}();exports.MenuNotificationExpiration=MenuNotificationExpiration},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuNotificationListLoad=function(){function MenuNotificationListLoad(menuNotificationsClient,menuNotificationsRepository,pusherInterface,menuInternetConnectivityState,menuBasicUserData,menuContainerAppClientId,menuAccessToken,$q,listenersManager){this.menuNotificationsClient=menuNotificationsClient,this.menuNotificationsRepository=menuNotificationsRepository,this.pusherInterface=pusherInterface,this.menuInternetConnectivityState=menuInternetConnectivityState,this.menuBasicUserData=menuBasicUserData,this.menuContainerAppClientId=menuContainerAppClientId,this.menuAccessToken=menuAccessToken,this.$q=$q,this.notificationIdsWhenCalling=[],this.fullListBackendDataListenersManager=listenersManager.getManager(),this.lastPusherConnectionState=pusherInterface.getConnectionStatus(),this.lastUserId=this.getUserId(),this.lastAccessToken=menuAccessToken.getAccessToken();var clientIdIsDefined=null!==this.menuContainerAppClientId.getClientId();pusherInterface.registerConnectionStatusListener(this.onPusherConnectionChange.bind(this)),menuInternetConnectivityState.registerConnectivityChangeListener(this.onInternetConnectivityChange.bind(this)),menuBasicUserData.registerUserDataListener(this.onUserDataChange.bind(this)),menuAccessToken.registerAccessTokenListener(this.onAccessTokenChange.bind(this)),clientIdIsDefined||(this.clientIdListenerCanceller=menuContainerAppClientId.registerClientIdListener(this.onClientIdSet.bind(this))),this.reloadNotificationListIfPossibleNow()}return MenuNotificationListLoad.prototype.registerFullListBackendDataListener=function(listener){return this.fullListBackendDataListenersManager.addListener(listener)},MenuNotificationListLoad.prototype.getIsNotificationListFilledPromise=function(){return this.isNotificationListFilledDeferred.promise},MenuNotificationListLoad.prototype.onPusherConnectionChange=function(pusherConnectionState){var previousPusherConnectionState=this.lastPusherConnectionState;this.lastPusherConnectionState=pusherConnectionState,null===previousPusherConnectionState?"boolean"==typeof pusherConnectionState&&this.reloadNotificationListIfPossibleNow():!1===previousPusherConnectionState&&!0===pusherConnectionState&&this.reloadNotificationListIfPossibleNow()},MenuNotificationListLoad.prototype.onInternetConnectivityChange=function(isConnected){!0===isConnected&&this.reloadNotificationListIfPossibleNow()},MenuNotificationListLoad.prototype.onUserDataChange=function(){var newUserId=this.getUserId();newUserId!==this.lastUserId&&(this.lastUserId=newUserId,this.menuNotificationsRepository.clearNotificationsRepositoryLocally(),this.reloadNotificationListIfPossibleNow())},MenuNotificationListLoad.prototype.onClientIdSet=function(clientId){this.clientIdListenerCanceller(),delete this.clientIdListenerCanceller,this.reloadNotificationListIfPossibleNow()},MenuNotificationListLoad.prototype.onAccessTokenChange=function(){var newAccessToken=this.menuAccessToken.getAccessToken(),previousAccessToken=this.lastAccessToken;this.lastAccessToken=newAccessToken,null===previousAccessToken&&"string"==typeof newAccessToken&&this.reloadNotificationListIfPossibleNow()},MenuNotificationListLoad.prototype.getUserId=function(){return this.menuBasicUserData.isUserLoggedIn()?this.menuBasicUserData.getUserData().id:null},MenuNotificationListLoad.prototype.reloadNotificationListIfPossibleNow=function(){var accessToken=this.menuAccessToken.getAccessToken(),clientId=this.menuContainerAppClientId.getClientId(),userId=this.getUserId();if(void 0===this.isNotificationListFilledDeferred&&(this.isNotificationListFilledDeferred=this.$q.defer()),null!==this.pusherInterface.getConnectionStatus()&&"string"==typeof clientId&&"string"==typeof accessToken&&!0===this.menuInternetConnectivityState.isConnected()&&"string"==typeof userId){this.notificationIdsWhenCalling=[];for(var _i=0,notificationListWhenCalling_1=this.menuNotificationsRepository.getNotifications();_i<notificationListWhenCalling_1.length;_i++){var notification=notificationListWhenCalling_1[_i];this.notificationIdsWhenCalling.push(notification.id)}this.menuNotificationsClient.fetchNewNotificationsList(clientId,userId,accessToken).then(this.onListFromBackendSuccess.bind(this),this.onListFromBackendError.bind(this))}},MenuNotificationListLoad.prototype.onListFromBackendSuccess=function(response){this.menuNotificationsRepository.deleteNotificationsByIdsLocally(this.notificationIdsWhenCalling),this.fullListBackendDataListenersManager.callListeners(response.data.items),this.isNotificationListFilledDeferred.resolve()},MenuNotificationListLoad.prototype.onListFromBackendError=function(response){delete this.notificationIdsWhenCalling,this.isNotificationListFilledDeferred.reject("Couldn't fetch notification list from backend: "+JSON.stringify(response))},MenuNotificationListLoad.$inject=["menuNotificationsClient","menuNotificationsRepository","pusherInterface","menuInternetConnectivityState","menuBasicUserData","menuContainerAppClientId","menuAccessToken","$q","listenersManager"],MenuNotificationListLoad}();exports.MenuNotificationListLoad=MenuNotificationListLoad},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuNotificationRelatedPageEnter=function(){function MenuNotificationRelatedPageEnter(menuNotificationListLoad,menuNotificationsRepository,menuNotificationsClient,$window){this.menuNotificationListLoad=menuNotificationListLoad,this.menuNotificationsRepository=menuNotificationsRepository,this.menuNotificationsClient=menuNotificationsClient,$window.gogEventBus.subscribe("feed","displayed",this.onProfilesFeedEntered.bind(this))}return MenuNotificationRelatedPageEnter.prototype.onWebsiteWishlistEntered=function(){this.menuNotificationListLoad.getIsNotificationListFilledPromise().then(this.deleteWishlistNotifications.bind(this),this.onNotificationListFilledPromiseError.bind(this))},MenuNotificationRelatedPageEnter.prototype.onWebsiteForumTopicEntered=function(forumSlug,topicSlug){this.menuNotificationListLoad.getIsNotificationListFilledPromise().then(this.deleteForumReplyNotification.bind(this,forumSlug,topicSlug),this.onNotificationListFilledPromiseError.bind(this))},MenuNotificationRelatedPageEnter.prototype.onWebsiteGameCardEntered=function(productId){this.menuNotificationListLoad.getIsNotificationListFilledPromise().then(this.deleteProductReleaseNotification.bind(this,productId),this.onNotificationListFilledPromiseError.bind(this))},MenuNotificationRelatedPageEnter.prototype.onProfilesFeedEntered=function(){this.menuNotificationListLoad.getIsNotificationListFilledPromise().then(this.deleteActivityFeedNotifications.bind(this),this.onNotificationListFilledPromiseError.bind(this))},MenuNotificationRelatedPageEnter.prototype.deleteActivityFeedNotifications=function(){for(var allNotifications=this.menuNotificationsRepository.getNotifications(),index=0;index<allNotifications.length;index++){var notification=allNotifications[index];"unseen_activities"===notification.type&&this.menuNotificationsClient.deleteNotification(notification.id)}},MenuNotificationRelatedPageEnter.prototype.deleteWishlistNotifications=function(){for(var allNotifications=this.menuNotificationsRepository.getNotifications(),index=0;index<allNotifications.length;index++)"wishlisted_products_discounted"==allNotifications[index].type&&this.menuNotificationsClient.deleteNotification(allNotifications[index].id)},MenuNotificationRelatedPageEnter.prototype.deleteForumReplyNotification=function(forumSlug,topicSlug){for(var allNotifications=this.menuNotificationsRepository.getNotifications(),index=0;index<allNotifications.length;index++){var notification=allNotifications[index];"new_forum_reply"===notification.type&&notification.forumSlug==forumSlug&&notification.topicSlug==topicSlug&&this.menuNotificationsClient.deleteNotification(notification.id)}},MenuNotificationRelatedPageEnter.prototype.deleteProductReleaseNotification=function(productId){for(var allNotifications=this.menuNotificationsRepository.getNotifications(),index=0;index<allNotifications.length;index++){var notification=allNotifications[index];"product_release"===notification.type&&notification.productId===productId&&this.menuNotificationsClient.deleteNotification(notification.id)}},MenuNotificationRelatedPageEnter.prototype.onNotificationListFilledPromiseError=function(errorMessage){console.error(errorMessage)},MenuNotificationRelatedPageEnter.$inject=["menuNotificationListLoad","menuNotificationsRepository","menuNotificationsClient","$window"],MenuNotificationRelatedPageEnter}();exports.MenuNotificationRelatedPageEnter=MenuNotificationRelatedPageEnter},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuNotificationWebsiteAction_1=__webpack_require__(81),MenuNotificationGalaxyAction_1=__webpack_require__(82),MenuNotificationActionProvider=function(){function MenuNotificationActionProvider(){this.$get=function(){throw new Error("MenuNotificationAction needs to have actions collection name specified")}}return MenuNotificationActionProvider.prototype.setActionsCollectionAsGalaxy=function(){this.$get=["menuNotificationsRepository","$window","menuGalaxyActions","menuConfig",function(menuNotificationsRepository,$window,menuGalaxyActions,menuConfig){return new MenuNotificationGalaxyAction_1.MenuNotificationGalaxyAction(menuNotificationsRepository,$window,menuGalaxyActions,menuConfig)}]},MenuNotificationActionProvider.prototype.setActionsCollectionAsWebsite=function(){this.$get=["menuNotificationsRepository","$window","menuConfig",function(menuNotificationsRepository,$window,menuConfig){return new MenuNotificationWebsiteAction_1.MenuNotificationWebsiteAction(menuNotificationsRepository,$window,menuConfig)}]},MenuNotificationActionProvider}();exports.MenuNotificationActionProvider=MenuNotificationActionProvider},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuNotificationWebsiteAction=function(){function MenuNotificationWebsiteAction(menuNotificationsRepository,$window,menuConfig){this.menuNotificationsRepository=menuNotificationsRepository,this.$window=$window,this.menuConfig=menuConfig}return MenuNotificationWebsiteAction.prototype.executeNotificationAction=function(notificationId,redirectTo){void 0===redirectTo&&(redirectTo="");var notification=this.menuNotificationsRepository.getNotificationById(notificationId);-1!==MenuNotificationWebsiteAction.REMOVED_AFTER_CLICK_NOTIFICATIONS.indexOf(notification.type)&&this.menuNotificationsRepository.deleteNotificationById(notificationId),""!=redirectTo&&(this.$window.document.location.href=redirectTo)},MenuNotificationWebsiteAction.REMOVED_AFTER_CLICK_NOTIFICATIONS=["new_friend"],MenuNotificationWebsiteAction}();exports.MenuNotificationWebsiteAction=MenuNotificationWebsiteAction},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuNotificationGalaxyAction=function(){function MenuNotificationGalaxyAction(menuNotificationsRepository,$window,menuGalaxyActions,menuConfig){this.menuNotificationsRepository=menuNotificationsRepository,this.$window=$window,this.menuGalaxyActions=menuGalaxyActions,this.menuConfig=menuConfig}return MenuNotificationGalaxyAction.prototype.parseLink=function(link){var hostRegEx=/\/\/[^\/]+\/([^\.]+)/;return hostRegEx.test(link)&&(link=link.match(hostRegEx)[1]),"/"==link[0]&&(link=link.substr(1)),this.menuConfig.gogWebsiteHostname+"/"+link},MenuNotificationGalaxyAction.prototype.executeNotificationAction=function(notificationId,redirectTo){void 0===redirectTo&&(redirectTo="");var notification=this.menuNotificationsRepository.getNotificationById(notificationId);switch(notification.type){case"new_chat_message":case"new_game_invite":this.menuGalaxyActions.showChatForUser(notification.userName,notification.userId);break;case"new_friend":this.menuNotificationsRepository.deleteNotificationById(notificationId),this.menuGalaxyActions.showChatForUser(notification.userName,notification.userId);break;case"new_invite":this.menuGalaxyActions.showFriends();break;case"new_forum_reply":case"wishlisted_products_discounted":var wishlistedUrl=this.parseLink(notification.link);this.menuGalaxyActions.showInStoreFrame(wishlistedUrl);break;case"new_gog_announcement":console.warn("gogAnnouncementNotification is not yet implemented! No action in Galaxy to execute.");case"product_release":var releasedUrl=this.parseLink(notification.link);this.menuGalaxyActions.showInStoreFrame(releasedUrl);break;default:throw new Error("Unknown notification type to make action upon! "+notification.type)}},MenuNotificationGalaxyAction}();exports.MenuNotificationGalaxyAction=MenuNotificationGalaxyAction},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MenuChatProvider=function(){function MenuChatProvider(){this.chatServiceName="",this.$get=function(){throw new Error("MenuChatProvider needs to have chat service and predicateMethod provided")}}return MenuChatProvider.prototype.setChatServiceName=function(chatServiceName){this.chatServiceName=chatServiceName},MenuChatProvider.prototype.setDisplayPredicateMethod=function(displayPredicateMethodName){this.$get=[this.chatServiceName,function(chatService){var menuChatService=new MenuChat(chatService);return menuChatService.setDisplayPredicateMethod(displayPredicateMethodName),menuChatService}]},MenuChatProvider}();exports.MenuChatProvider=MenuChatProvider;var MenuChat=function(){function MenuChat(chatService){this.chatService=chatService}return MenuChat.prototype.setDisplayPredicateMethod=function(methodName){this.displayPredicateMethodName=methodName},MenuChat.prototype.shouldShowChatNotificationForUser=function(userId){return this.chatService[this.displayPredicateMethodName](userId)},MenuChat}();exports.MenuChat=MenuChat},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MenuNotificationSafeDate=function(){return function(isoDate){var dateParts=isoDate.match(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})/);return Date.UTC(parseInt(dateParts[1],10),parseInt(dateParts[2],10)-1,parseInt(dateParts[3],10),parseInt(dateParts[4],10),parseInt(dateParts[5],10),parseInt(dateParts[6],10))}}}]);